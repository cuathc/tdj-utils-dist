import{d as ut,h as N,a as Vt,i as Q,O as It,Z as At,$ as $t,_ as dt,o as B,c as $,b as s,n as H,j as yt,p as D,W as ct,w as J,G as M,T as se,y as Gt,z as Rt,g as Ct,D as pt,m as Y,f as tt,r as ne,a0 as Et,v as lt,l as R,k as X,e as b,F as at,s as rt,x as le,V as ae}from"./index.js";import{_ as Z}from"./lodash.js";import{u as re,D as ye}from"./useHeroes.js";const Bt=(o,a,f)=>{let m=0,n=0,y=0;o%=360;const l=Math.floor(o/60),h=o/60-l,_=f*(1-a),S=f*(1-a*h),F=f*(1-a*(1-h));switch(l){case 0:m=f,n=F,y=_;break;case 1:m=S,n=f,y=_;break;case 2:m=_,n=f,y=F;break;case 3:m=_,n=S,y=f;break;case 4:m=F,n=_,y=f;break;case 5:m=f,n=_,y=S;break}m=Math.floor(m*255),n=Math.floor(n*255),y=Math.floor(y*255);const V=("00"+m.toString(16)).slice(-2),G=("00"+n.toString(16)).slice(-2),A=("00"+y.toString(16)).slice(-2);return[o,a,f,m,n,y,"#"+V+G+A]},Dt=o=>{let a=0,f=0,m=0,n=0,y=0,l=0;if(/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i.test(o))a=window.parseInt(RegExp.$1,16),f=window.parseInt(RegExp.$2,16),m=window.parseInt(RegExp.$3,16);else if(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i.test(o))a=window.parseInt(RegExp.$1,10),f=window.parseInt(RegExp.$2,10),m=window.parseInt(RegExp.$3,10);else return[0,0,0,0,0,0,"#000000"];n=a/255,y=f/255,l=m/255;let h=n;y>h&&(h=y),l>h&&(h=l);let _=n;y<_&&(_=y),l<_&&(_=l);let S=0,F=0,V=0;h===_?S=0:h===n&&y>=l?S=60*(y-l)/(h-_)+0:h===n&&y<l?S=60*(y-l)/(h-_)+360:h===y?S=60*(l-n)/(h-_)+120:h===l&&(S=60*(n-y)/(h-_)+240),h===0?F=0:F=1-_/h,V=h;const G=("00"+a.toString(16)).slice(-2),A=("00"+f.toString(16)).slice(-2),U=("00"+m.toString(16)).slice(-2);return[Math.floor(S),F,V,a,f,m,"#"+G+A+U]},ce=ut({name:"ColorPicker",emits:["update:modelValue"],props:{modelValue:{type:String,required:!0}},setup(o,{emit:a}){const f=N(!1),m=Vt({set:d=>{a("update:modelValue",d)},get:()=>o.modelValue}),n=Q({h:0,s:0,v:0,r:0,g:0,b:0}),y=Q({rect_down:!1,rect_left:0,rect_bottom:0,ver_down:!1,ver_bottom:0}),l={rect:{left:0,bottom:0,x:0,y:0},ver:{bottom:0,y:0}},h=N(!1),_=()=>{h.value=!0},S=Z.debounce(()=>{h.value=!1},300),F=()=>{_();const d=Bt(n.h,n.s,n.v);n.r=d[3],n.g=d[4],n.b=d[5],m.value=d[6],y.ver_bottom=n.h,y.rect_left=n.s*360,y.rect_bottom=n.v*360,S()},V=()=>{_();const d=Dt(`${n.r},${n.g},${n.b}`);n.h=d[0],n.s=d[1],n.v=d[2],m.value=d[6],y.ver_bottom=n.h,y.rect_left=n.s*360,y.rect_bottom=n.v*360,S()},G=d=>{d=d||"#000000";const I=Dt(d);n.h=I[0],n.s=I[1],n.v=I[2],n.r=I[3],n.g=I[4],n.b=I[5],y.ver_bottom=n.h,y.rect_left=n.s*360,y.rect_bottom=n.v*360},A=()=>{const d=Bt(y.ver_bottom,y.rect_left/360,y.rect_bottom/360);n.h=d[0],n.s=d[1],n.v=d[2],n.r=d[3],n.g=d[4],n.b=d[5],m.value=d[6]},U=d=>{y.rect_down=!0,l.rect.x=d.clientX,l.rect.y=d.clientY;const I=d.currentTarget,q=I.getBoundingClientRect().left,it=I.getBoundingClientRect().top;l.rect.left=y.rect_left=d.clientX-q,l.rect.bottom=y.rect_bottom=360-(d.clientY-it),A()},p=d=>{if(!y.rect_down)return;const I=d.clientX-l.rect.x,q=d.clientY-l.rect.y;y.rect_left=Math.max(0,Math.min(360,l.rect.left+I)),y.rect_bottom=Math.max(0,Math.min(360,l.rect.bottom-q)),A()},L=()=>{!y.rect_down||(y.rect_down=!1)},z=d=>{y.ver_down=!0,l.ver.y=d.clientY;const q=d.currentTarget.getBoundingClientRect().top;l.ver.bottom=y.ver_bottom=360-(d.clientY-q),A()},et=d=>{if(!y.ver_down)return;const I=d.clientY-l.ver.y;y.ver_bottom=Math.max(0,Math.min(360,l.ver.bottom-I)),A()},ot=()=>{!y.ver_down||(y.ver_down=!1)},j=()=>{f.value=!0},st=()=>{f.value=!1};return It(()=>o.modelValue,d=>{y.ver_down||y.rect_down||h.value||G(d)}),G(o.modelValue),At(()=>{window.addEventListener("mousemove",p,!1),window.addEventListener("mouseup",L,!1),window.addEventListener("mousemove",et,!1),window.addEventListener("mouseup",ot,!1)}),$t(()=>{window.removeEventListener("mousemove",p,!1),window.removeEventListener("mouseup",L,!1),window.removeEventListener("mousemove",et,!1),window.removeEventListener("mouseup",ot,!1)}),{show:f,color:m,vars:n,state:y,colorRectPointerStart:U,colorVerPointerStart:z,updateHSV:F,updateRGB:V,updateHex:G,onOpen:j,onComfirm:st}}});const xt=o=>(Gt("data-v-27cd0415"),o=o(),Rt(),o),ie={class:"color-control"},ue={class:"color-picker-layer"},de={class:"color-picker-view"},pe=xt(()=>s("div",{class:"color-picker-view__label"},"HSV",-1)),xe=xt(()=>s("div",{class:"color-picker-view__label"},"RGB",-1)),fe=xt(()=>s("div",{class:"color-picker-view__label"},"Hex",-1));function ve(o,a,f,m,n,y){return B(),$("div",ie,[s("div",{class:"color-preview",style:H({backgroundColor:o.color}),onClick:a[0]||(a[0]=(...l)=>o.onOpen&&o.onOpen(...l))},null,4),(B(),yt(se,{to:"body"},[D(s("div",{class:"color-picker-mask",onWheel:a[1]||(a[1]=J(()=>{},["prevent"])),onTouchstart:a[2]||(a[2]=J(()=>{},["prevent"])),onClick:a[3]||(a[3]=(...l)=>o.onComfirm&&o.onComfirm(...l))},null,544),[[ct,o.show]]),D(s("div",ue,[s("div",{class:"color-picker-rect",style:H(`background-color: hsl(${o.vars.h}deg, 100%, 50%)`),onMousedown:a[4]||(a[4]=J((...l)=>o.colorRectPointerStart&&o.colorRectPointerStart(...l),["prevent","stop"]))},[s("div",{class:"color-picker-rect-cur",style:H({left:`${o.state.rect_left}px`,bottom:`${o.state.rect_bottom}px`})},null,4)],36),s("div",{class:"color-picker-hue",onMousedown:a[5]||(a[5]=J((...l)=>o.colorVerPointerStart&&o.colorVerPointerStart(...l),["prevent","stop"]))},[s("div",{class:"color-picker-hue-cur",style:H({bottom:`${o.state.ver_bottom}px`})},null,4)],32),s("div",de,[s("div",{class:"color-picker-view-color",style:H({background:o.color})},null,4),pe,D(s("input",{type:"number",max:"360",min:"0",step:"1","onUpdate:modelValue":a[6]||(a[6]=l=>o.vars.h=l),class:"color-picker-view__input",onInput:a[7]||(a[7]=(...l)=>o.updateHSV&&o.updateHSV(...l))},null,544),[[M,o.vars.h]]),D(s("input",{type:"number",max:"1",min:"0",step:"0.01","onUpdate:modelValue":a[8]||(a[8]=l=>o.vars.s=l),class:"color-picker-view__input",onInput:a[9]||(a[9]=(...l)=>o.updateHSV&&o.updateHSV(...l))},null,544),[[M,o.vars.s]]),D(s("input",{type:"number",max:"1",min:"0",step:"0.01","onUpdate:modelValue":a[10]||(a[10]=l=>o.vars.v=l),class:"color-picker-view__input",onInput:a[11]||(a[11]=(...l)=>o.updateHSV&&o.updateHSV(...l))},null,544),[[M,o.vars.v]]),xe,D(s("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":a[12]||(a[12]=l=>o.vars.r=l),class:"color-picker-view__input",onInput:a[13]||(a[13]=(...l)=>o.updateRGB&&o.updateRGB(...l))},null,544),[[M,o.vars.r]]),D(s("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":a[14]||(a[14]=l=>o.vars.g=l),class:"color-picker-view__input",onInput:a[15]||(a[15]=(...l)=>o.updateRGB&&o.updateRGB(...l))},null,544),[[M,o.vars.g]]),D(s("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":a[16]||(a[16]=l=>o.vars.b=l),class:"color-picker-view__input",onInput:a[17]||(a[17]=(...l)=>o.updateRGB&&o.updateRGB(...l))},null,544),[[M,o.vars.b]]),fe,D(s("input",{type:"text","onUpdate:modelValue":a[18]||(a[18]=l=>o.color=l),class:"color-picker-view__input"},null,512),[[M,o.color]]),s("div",{class:"color-picker-view__enter",onClick:a[19]||(a[19]=(...l)=>o.onComfirm&&o.onComfirm(...l))},"\u786E\u8BA4")])],512),[[ct,o.show]])]))])}const O=dt(ce,[["render",ve],["__scopeId","data-v-27cd0415"]]);O.install=function(o){o.component(O.name,O)};const me={draggable:!0,class:"grid-item"},be={key:0,class:"tg lt"},he={key:1,class:"tg rt"},ge={key:2,class:"tg rb"},_e={class:"overlay-dot"},we={class:"overlay-selected"},ke=ut({__name:"GridItem",props:{disabled:{type:Boolean},selected:{type:Boolean},dot:{type:Boolean},item:null},setup(o){return(a,f)=>(B(),$("div",me,[o.item?(B(),$("div",{key:0,class:Ct(["color-unit",{disabled:o.disabled}]),style:H({fontSize:`${o.item.data.size}px`,color:o.item.style.color,backgroundColor:o.item.style.bgcolor,backgroundImage:o.item.style.image?`url(${o.item.style.image})`:"",opacity:o.item.style.opacity})},[pt(Y(o.item.data.txt)+" ",1),o.item.data.actorId?(B(),$("i",be,Y(o.item.data.actorId),1)):tt("",!0),o.item.data.sup?(B(),$("i",he,Y(o.item.data.sup),1)):tt("",!0),o.item.data.sub?(B(),$("i",ge,Y(o.item.data.sub),1)):tt("",!0)],6)):(B(),$("div",{key:1,class:Ct(["color-unit",{disabled:o.disabled}])},[ne(a.$slots,"default",{},void 0,!0)],2)),D(s("div",_e,null,512),[[ct,o.dot]]),D(s("div",we,null,512),[[ct,o.selected]])]))}});const K=dt(ke,[["__scopeId","data-v-6c3c6c6f"]]);var v=(o=>(o[o.NONE=0]="NONE",o[o.GUARD=1]="GUARD",o[o.SHEEP=2]="SHEEP",o[o.ATTACKER=3]="ATTACKER",o[o.FLY=4]="FLY",o[o.BLOCKED=5]="BLOCKED",o[o.CLIFF=6]="CLIFF",o))(v||{});function Ce(){const o=N(0),a=N([]),f=N([]),m=[{color:"#202020",bgcolor:"#f5fff0"},{color:"#f9f9fa",bgcolor:"#ff3333"},{color:"#f9f9fa",bgcolor:"#00d659"},{color:"#f9f9fa",bgcolor:"#369af7"},{color:"#f9f9fa",bgcolor:"#fec02f"},{color:"#f9f9fa",bgcolor:"#a865e7"}],n=()=>({actorId:0,actorType:v.NONE,size:14,txt:"",disabled:!1}),y=()=>({color:m[0].color,bgcolor:m[0].bgcolor,image:"",opacity:1}),l=()=>({d:0,d1:0,d2:0,q:0}),h=()=>({x:0,y:0,data:n(),style:y(),state:l()});function _(V){V.data=n(),V.style=y(),V.state=l()}function S(){o.value=0,a.value.forEach(V=>{_(V)}),f.value=[]}function F(V,G){const A=[];for(let U=0;U<V;U++)for(let p=0;p<G;p++){const L=h();L.x=p,L.y=V-U-1,A.push(L)}a.value=A}return{actorId:o,grids:a,selects:f,gridColors:m,defGridData:n,defGridStyle:y,defGridState:l,defGrid:h,cleanGrid:_,cleanGrids:S,generateGrids:F}}const St=""+new URL("../assets/cliff.svg",import.meta.url).href,Ft=""+new URL("../assets/block.svg",import.meta.url).href,Ee=[{name:"\u7A7A\u767D\u573A\u666F",width:15,height:15,data:[]},{name:"\u5316\u8352\u5E7B\u5883",width:17,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:14,y:10,type:5},{x:15,y:10,type:5},{x:16,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:15,y:9,type:5},{x:16,y:9,type:5},{x:0,y:8,type:5},{x:7,y:8,type:6},{x:8,y:8,type:6},{x:9,y:8,type:6},{x:16,y:8,type:5},{x:6,y:7,type:6},{x:7,y:7,type:6},{x:8,y:7,type:6},{x:9,y:7,type:6},{x:10,y:7,type:6},{x:5,y:6,type:6},{x:6,y:6,type:6},{x:10,y:6,type:6},{x:11,y:6,type:6},{x:5,y:4,type:6},{x:6,y:4,type:6},{x:10,y:4,type:6},{x:11,y:4,type:6},{x:6,y:3,type:6},{x:7,y:3,type:6},{x:8,y:3,type:6},{x:9,y:3,type:6},{x:10,y:3,type:6},{x:0,y:2,type:5},{x:7,y:2,type:6},{x:8,y:2,type:6},{x:9,y:2,type:6},{x:16,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:15,y:1,type:5},{x:16,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:14,y:0,type:5},{x:15,y:0,type:5},{x:16,y:0,type:5}]},{name:"\u96EA\u5CAD\u5E7B\u5883",width:15,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:5,y:10,type:6},{x:6,y:10,type:6},{x:7,y:10,type:6},{x:8,y:10,type:6},{x:9,y:10,type:6},{x:12,y:10,type:5},{x:13,y:10,type:5},{x:14,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:2,y:9,type:5},{x:3,y:9,type:6},{x:4,y:9,type:6},{x:5,y:9,type:6},{x:6,y:9,type:6},{x:7,y:9,type:6},{x:8,y:9,type:6},{x:9,y:9,type:6},{x:10,y:9,type:6},{x:11,y:9,type:6},{x:12,y:9,type:5},{x:13,y:9,type:5},{x:14,y:9,type:5},{x:0,y:8,type:5},{x:1,y:8,type:5},{x:2,y:8,type:5},{x:3,y:8,type:6},{x:11,y:8,type:6},{x:12,y:8,type:5},{x:13,y:8,type:5},{x:14,y:8,type:5},{x:6,y:6,type:6},{x:7,y:6,type:6},{x:8,y:6,type:6},{x:3,y:5,type:6},{x:11,y:5,type:6},{x:6,y:4,type:6},{x:7,y:4,type:6},{x:8,y:4,type:6},{x:0,y:2,type:5},{x:1,y:2,type:5},{x:2,y:2,type:5},{x:3,y:2,type:6},{x:11,y:2,type:6},{x:12,y:2,type:5},{x:13,y:2,type:5},{x:14,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:2,y:1,type:5},{x:3,y:1,type:6},{x:4,y:1,type:6},{x:5,y:1,type:6},{x:6,y:1,type:6},{x:7,y:1,type:6},{x:8,y:1,type:6},{x:9,y:1,type:6},{x:10,y:1,type:6},{x:11,y:1,type:6},{x:12,y:1,type:5},{x:13,y:1,type:5},{x:14,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:6},{x:6,y:0,type:6},{x:7,y:0,type:6},{x:8,y:0,type:6},{x:9,y:0,type:6},{x:12,y:0,type:5},{x:13,y:0,type:5},{x:14,y:0,type:5}]},{name:"\u5730\u754C\u5E7B\u5883",width:17,height:13,data:[{x:0,y:12,type:5},{x:1,y:12,type:5},{x:2,y:12,type:5},{x:5,y:12,type:6},{x:6,y:12,type:6},{x:7,y:12,type:6},{x:8,y:12,type:6},{x:9,y:12,type:6},{x:10,y:12,type:6},{x:11,y:12,type:6},{x:14,y:12,type:5},{x:15,y:12,type:5},{x:16,y:12,type:5},{x:0,y:11,type:5},{x:1,y:11,type:5},{x:2,y:11,type:5},{x:6,y:11,type:6},{x:10,y:11,type:6},{x:14,y:11,type:5},{x:15,y:11,type:5},{x:16,y:11,type:5},{x:0,y:10,type:5},{x:1,y:10,type:5},{x:6,y:10,type:6},{x:10,y:10,type:6},{x:15,y:10,type:5},{x:16,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:6,y:9,type:6},{x:7,y:9,type:6},{x:8,y:9,type:6},{x:9,y:9,type:6},{x:10,y:9,type:6},{x:15,y:9,type:5},{x:16,y:9,type:5},{x:7,y:8,type:6},{x:8,y:8,type:6},{x:9,y:8,type:6},{x:7,y:4,type:6},{x:8,y:4,type:6},{x:9,y:4,type:6},{x:0,y:3,type:5},{x:1,y:3,type:5},{x:6,y:3,type:6},{x:7,y:3,type:6},{x:8,y:3,type:6},{x:9,y:3,type:6},{x:10,y:3,type:6},{x:15,y:3,type:5},{x:16,y:3,type:5},{x:0,y:2,type:5},{x:1,y:2,type:5},{x:6,y:2,type:6},{x:10,y:2,type:6},{x:15,y:2,type:5},{x:16,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:2,y:1,type:5},{x:6,y:1,type:6},{x:10,y:1,type:6},{x:14,y:1,type:5},{x:15,y:1,type:5},{x:16,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:6},{x:6,y:0,type:6},{x:7,y:0,type:6},{x:8,y:0,type:6},{x:9,y:0,type:6},{x:10,y:0,type:6},{x:11,y:0,type:6},{x:14,y:0,type:5},{x:15,y:0,type:5},{x:16,y:0,type:5}]},{name:"\u7ED3\u754C\u5E7B\u5883",width:11,height:11,data:[{x:5,y:8,type:5},{x:2,y:5,type:5},{x:5,y:5,type:5},{x:8,y:5,type:5},{x:5,y:2,type:5}]},{name:"\u57CE\u9685\u5E7B\u5883",width:15,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:5,y:10,type:5},{x:6,y:10,type:5},{x:7,y:10,type:5},{x:8,y:10,type:5},{x:9,y:10,type:5},{x:12,y:10,type:5},{x:13,y:10,type:5},{x:14,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:6,y:9,type:5},{x:8,y:9,type:5},{x:13,y:9,type:5},{x:14,y:9,type:5},{x:0,y:8,type:5},{x:14,y:8,type:5},{x:10,y:6,type:5},{x:5,y:5,type:5},{x:9,y:5,type:5},{x:4,y:4,type:5},{x:0,y:2,type:5},{x:14,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:6,y:1,type:5},{x:8,y:1,type:5},{x:13,y:1,type:5},{x:14,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:5},{x:6,y:0,type:5},{x:7,y:0,type:5},{x:8,y:0,type:5},{x:9,y:0,type:5},{x:12,y:0,type:5},{x:13,y:0,type:5},{x:14,y:0,type:5}]},{name:"\u6D1E\u7A74\u5E7B\u5883",width:11,height:11,data:[{x:10,y:10,type:5},{x:10,y:9,type:5},{x:6,y:8,type:6},{x:7,y:8,type:6},{x:10,y:8,type:5},{x:6,y:7,type:6},{x:7,y:7,type:6},{x:8,y:7,type:6},{x:2,y:3,type:6},{x:3,y:3,type:6},{x:4,y:3,type:6},{x:0,y:2,type:5},{x:3,y:2,type:6},{x:4,y:2,type:6},{x:0,y:1,type:5},{x:0,y:0,type:5}]},{name:"\u5996\u5C71\u5E7B\u5883",width:17,height:11,data:[]}],g=o=>(Gt("data-v-261a5316"),o=o(),Rt(),o),Be={class:"wrapper"},De={class:"toolbar"},Se={class:"setting"},Fe={class:"label-control"},Ve=g(()=>s("span",null,"\u7F16\u8F91\u6A21\u5F0F\xA0",-1)),Ie=g(()=>s("option",{value:1},"\u7F16\u8F91\u7F51\u683C",-1)),Ae=g(()=>s("option",{value:2},"\u7F51\u683C\u4E0A\u8272",-1)),$e=g(()=>s("option",{value:3},"\u9009\u62E9\u5F62\u72B6",-1)),Ge=g(()=>s("option",{value:4},"\u62A4\u536B\u8BA1\u7B97",-1)),Re=[Ie,Ae,$e,Ge],Le={class:"label-control"},Me=g(()=>s("span",null,"\u8303\u56F4\xA0",-1)),Ue={class:"label-control"},He=g(()=>s("span",null,"\u5F62\u72B6\xA0",-1)),Te=g(()=>s("option",{value:1},"\u83F1\u5F62",-1)),Ne=g(()=>s("option",{value:2},"\u5708\u6570",-1)),Ke=[Te,Ne],qe={class:"label-control"},Oe=g(()=>s("span",null,"\u6392\u5E8F\xA0",-1)),ze=g(()=>s("option",{value:1},"\u8DDD\u79BBX",-1)),Pe=g(()=>s("option",{value:2},"\u8DDD\u79BBY",-1)),Xe=g(()=>s("option",{value:3},"X\u4F18\u5148",-1)),Je=g(()=>s("option",{value:4},"Y\u4F18\u5148",-1)),je=[ze,Pe,Xe,Je],We=g(()=>s("button",{class:"btn"},"\u9884\u8BBE\u573A\u666F",-1)),Ye=["onClick"],Ze=["onClick"],Qe={class:"color-container"},to={class:"label-control"},eo=g(()=>s("span",null,"\u9884\u89C8\xA0",-1)),oo=pt(" E "),so={class:"label-control"},no=g(()=>s("span",null,"\u6587\u5B57\xA0",-1)),lo={class:"label-control"},ao=g(()=>s("span",null,"\u80CC\u666F\xA0",-1)),ro=g(()=>s("label",{class:"label-control"},[s("span",null,"\u9884\u8BBE\xA0")],-1)),yo={class:"color-tpls"},co=pt(" E "),io={width:"32",height:"32",viewBox:"0 0 24 24",fill:"#a9a9a9",style:{"pointer-events":"none"}},uo=g(()=>s("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"},null,-1)),po=[uo],xo={class:"props-container"},fo={key:0,class:"props-content"},vo={class:"label-control"},mo=g(()=>s("span",null,"\u9884\u89C8\xA0",-1)),bo={class:"label-control"},ho=g(()=>s("span",null,"\u6587\u5B57\xA0",-1)),go={class:"label-control"},_o=g(()=>s("span",null,"\u80CC\u666F\xA0",-1)),wo={class:"label-control"},ko=g(()=>s("span",null,"\u5927\u5C0F\xA0",-1)),Co={class:"label-control"},Eo=g(()=>s("span",null,"Id\xA0",-1)),Bo={class:"label-control"},Do=g(()=>s("span",null,"\u7C7B\u578B\xA0",-1)),So=["value"],Fo=["value"],Vo=["value"],Io=["value"],Ao=["value"],$o=["value"],Go=["value"],Ro={class:"label-control"},Lo=g(()=>s("span",null,"\u5185\u5BB9\xA0",-1)),Mo={class:"content"},Uo={class:"heroes"},Ho=ut({__name:"Grids",setup(o){const a=N(15),f=N(15),{actorId:m,grids:n,selects:y,gridColors:l,defGridData:h,defGridStyle:_,defGridState:S,defGrid:F,cleanGrid:V,cleanGrids:G,generateGrids:A}=Ce(),U=N(),p=Q({editor:1,selectRange:5,shape:1,sortType:1,color:l[0].color,bgcolor:l[0].bgcolor}),L=F();L.style.image=Ft,L.data.actorType=v.BLOCKED;const z=F();z.style.image=St,z.data.actorType=v.CLIFF;function et(e){p.color=e.color,p.bgcolor=e.bgcolor}const ot=Vt(()=>`--rows:${f.value};--cols:${a.value}`),{heroes:j}=re(),st=Et(F()),d=Et(j.value.map(e=>{const t=F();return t.style.image=`https://media.zlongame.com/media/news/cn/tdj/info/data/heroicon/${e.hero_icon}.png`,t}));It(j,()=>{d.value=j.value.map(e=>{const t=F();return t.style.image=`https://media.zlongame.com/media/news/cn/tdj/info/data/heroicon/${e.hero_icon}.png`,t})});function I(e,t,u,x){const r=[];return n.value.forEach(i=>{i.state=S()}),n.value.forEach(i=>{const c=Math.abs(e-i.x),E=Math.abs(t-i.y),C=c+E,T=Math.max(c,E),kt=c>1?c-1:c+E>1?E-1:E;switch(x){case 1:C<=u&&(i.state.d=C,i.state.q=T,i.state.d1=kt,r.push(i));break;case 2:Math.abs(c)<=u&&Math.abs(E)<=u&&(i.state.d=C,i.state.q=T,i.state.d1=kt,r.push(i));break}}),r}function q(e,t,u,x,r,i,c){const E=I(e,t,u,x);switch(E.forEach(C=>{C.style.color=i,C.style.bgcolor=c}),y.value=E,r){case 1:x===1?y.value.sort(it):x===2&&y.value.sort(Mt);break;case 2:x===1?y.value.sort(Lt):x===2&&y.value.sort(ft);break;case 3:y.value.sort(Ut);break;case 4:y.value.sort(Ht);break}for(let C=0;C<y.value.length;C++)y.value[C].data.txt=String(C+1)}function it(e,t){return e.state.d!==t.state.d?e.state.d-t.state.d:e.x!==t.x?e.x-t.x:e.y!==t.y?e.y-t.y:0}function Lt(e,t){return e.state.d!==t.state.d?e.state.d-t.state.d:e.y!==t.y?e.y-t.y:e.x!==t.x?e.x-t.x:0}function Mt(e,t){return e.state.q!==t.state.q?e.state.q-t.state.q:e.state.d!==t.state.d?e.state.d-t.state.d:e.x!==t.x?e.x-t.x:e.y!==t.y?e.y-t.y:0}function ft(e,t){return e.state.q!==t.state.q?e.state.q-t.state.q:e.state.d!==t.state.d?e.state.d-t.state.d:e.y!==t.y?e.y-t.y:e.x!==t.x?e.x-t.x:0}function Ut(e,t){return e.x!==t.x?e.x-t.x:e.y!==t.y?e.y-t.y:0}function Ht(e,t){return e.y!==t.y?e.y-t.y:e.x!==t.x?e.x-t.x:0}const w=Q({enabled:!1});function Tt(){G()}function vt(){w.enabled=!1}function Nt(e,t){var u;switch(p.editor){case 1:case 4:w.current=t,(u=U.value)==null||u.focus();break;case 3:G(),q(t.x,t.y,p.selectRange,p.shape,p.sortType,p.color,p.bgcolor);break}}function Kt(e,t){if(e.button===0)switch(p.editor){case 2:{w.enabled=!0,t.style.color=p.color,t.style.bgcolor=p.bgcolor;break}}}function qt(e,t){e.button===0&&w.enabled&&(t.style.color=p.color,t.style.bgcolor=p.bgcolor)}function Ot(){w.current=void 0}const P=N({width:15,height:15});function zt(){try{const e=localStorage.getItem("grids");if(!e)return;const t=JSON.parse(e);Array.isArray(t)?P.value={width:15,height:15,data:t}:P.value=t}catch{}}function mt(){P.value={width:a.value,height:f.value,data:n.value.map(e=>Z.cloneDeep(e))},localStorage.setItem("grids",JSON.stringify(P))}function Pt(){const e=P.value;!e.data||(a.value=e.width,f.value=e.height,A(f.value,a.value),n.value=Z.cloneDeep(e.data))}function Xt(e){a.value=e.width,f.value=e.height,A(f.value,a.value),e.data.forEach(t=>{const u=n.value[nt(t.x,t.y)];if(!!u)switch(t.type){case v.CLIFF:u.style.image=St,u.data.actorType=v.CLIFF;break;case v.BLOCKED:u.style.image=Ft,u.data.actorType=v.BLOCKED;break}})}function Jt(){const e=w.current;if(!e)return;P.value||mt();let t,u,x=[];for(t=e.x-2;t<=e.x+2;t++)for(u=e.y-2;u<=e.y+2;u++){const c=n.value[nt(t,u)];if(c.x===e.x&&c.y===e.y){const E=x[0];E&&(x.push(E),x[0]=c)}else x.push(c)}x=x.filter(c=>c.data.actorId>0&&c.data.actorType!==v.BLOCKED&&c.data.actorType!==v.CLIFF&&!(c.x===e.x&&c.y===e.y));const r=x.map(c=>({data:c.data,style:c.style}));x.forEach(c=>{V(c)}),console.log(JSON.parse(JSON.stringify(r)));const i=I(e.x,e.y,4,2).filter(c=>c.data.actorType!==v.BLOCKED&&!(c.x===e.x&&c.y===e.y)).sort(ft).map(c=>[c.x,c.y]);for(const c of r)for(const[E,C]of i){const T=n.value[nt(E,C)];if(!!T&&!(T.data.actorId>0)&&T.data.actorType!==v.BLOCKED&&!(T.data.actorType===v.CLIFF&&c.data.actorType!==v.FLY)){T.data=c.data,T.style=c.style;break}}}const k=Q({}),bt=["#ffffff00","#FF3C4132","#0EBEFF32","#48CF7432","#FCD00032","#80008032"],jt=(e,t)=>{switch(p.editor){case 2:e.preventDefault();break;default:k.grid=t,k.action="swap",e.dataTransfer&&(e.dataTransfer.effectAllowed="move")}},Wt=(e,t)=>{const u=F();u.style.color=t.color,u.style.bgcolor=t.bgcolor,u.data.txt="E",k.grid=u,k.action="color"},ht=(e,t)=>{k.grid=Z.cloneDeep(t),k.action="other"},gt=(e,t)=>{k.grid=Z.cloneDeep(t),k.action="image"},Yt=(e,t)=>{if(e.preventDefault(),!k.grid)return;const u=k.grid.data,x=k.grid.style;switch(k.action){case"color":t.data.actorId||(t.data.actorId=++m.value),t.style.color=x.color,t.style.bgcolor=x.bgcolor;break;case"image":t.data.actorId||(t.data.actorId=++m.value),t.style.image=x.image;break;case"swap":k.grid.data=t.data,k.grid.style=t.style,t.data=u,t.style=x;break;case"other":t.style=x,t.data=u;break}k.grid=void 0,k.action=void 0,p.editor===4&&W()};function Zt(e,t){let u=e[0].state[t];for(let x=1;x<e.length;x++)e[x].state[t]<u&&(u=e[x].state[t]);return u}function _t(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function wt(e,t,u){e.sort((c,E)=>+c.data.actorId-+E.data.actorId),e.forEach(c=>{c.state.d1=_t(c,u),c.state.d2=_t(c,t),c.data.guard=!1});const x=Zt(e,"d1");if(e=e.filter(c=>c.state.d1===x),e.length===1)return e[0];let r=e[0],i=e.length;for(;i--;)if(e[i].state.d2<r.state.d2){r=e[i];break}return r}function nt(e,t){return(f.value-t-1)*a.value+e}function Qt(){G(),m.value=0;const e=[{x:7,y:9,txt:"",type:v.GUARD,bg:"#0ebeff"},{x:9,y:7,txt:"",type:v.GUARD,bg:"#0ebeff"},{x:7,y:5,txt:"",type:v.GUARD,bg:"#0ebeff"},{x:5,y:7,txt:"",type:v.GUARD,bg:"#0ebeff"},{x:8,y:6,txt:"",type:v.ATTACKER,bg:"#ff3c41"},{x:7,y:7,txt:"",type:v.SHEEP,bg:"#fcd000"}];for(const t of e){const u=n.value[nt(t.x,t.y)];u.data.actorId=++m.value,u.data.actorType=t.type,u.data.txt=t.txt,u.data.disabled=!1,u.style.bgcolor=t.bg}p.editor=4}const W=()=>{n.value.forEach(i=>i.style.opacity=1);const e=n.value.filter(i=>!i.data.disabled),t=e.filter(i=>i.data.actorType===v.ATTACKER)[0],u=e.filter(i=>i.data.actorType===v.SHEEP)[0],x=e.filter(i=>i.data.actorType===v.GUARD);if(!u||x.length===0){alert("\u7F3A\u5C11\u89D2\u8272\uFF0C\u5C06\u81EA\u52A8\u751F\u6210"),Qt(),W();return}const r=n.value.filter(i=>!i.data.disabled).filter(i=>i.data.actorType===v.NONE);for(const i of r){const c=wt(x,i,u);i.style.image=c.style.image,i.style.bgcolor=bt[c.data.actorId]||bt[0],c.style.image?i.data.sup="":i.data.sup=String(c.data.actorId),i.style.opacity=.6}if(t){const i=wt(x,t,u);i.data.guard=!0}},te=e=>{if(e.data.disabled=!e.data.disabled,p.editor===4){switch(e.data.actorType){case v.ATTACKER:case v.SHEEP:e.data.disabled=!1;break}W()}},ee=e=>{!k.grid||!e.dataTransfer||k.action==="swap"&&(p.editor===4&&k.grid.data.actorType===v.SHEEP||e.preventDefault())},oe=e=>{if(!!k.grid&&!!e)switch(k.action){case"swap":e.data=h(),e.style=_(),e.state=S(),k.grid=void 0,k.action=void 0,p.editor===4&&W()}};return A(f.value,a.value),At(()=>{zt(),window.addEventListener("mouseup",vt,!1)}),$t(()=>{window.removeEventListener("mouseup",vt,!1)}),(e,t)=>{const u=le("c-space"),x=ae("autofocus");return B(),$("div",Be,[s("div",De,[s("div",Se,[s("label",Fe,[Ve,D(s("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>p.editor=r)},Re,512),[[lt,p.editor,void 0,{number:!0}]])]),s("label",Le,[Me,D(s("input",{type:"number",min:"0","onUpdate:modelValue":t[1]||(t[1]=r=>p.selectRange=r),style:{width:"5em"}},null,512),[[M,p.selectRange]])]),s("label",Ue,[He,D(s("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>p.shape=r)},Ke,512),[[lt,p.shape]])]),s("label",qe,[Oe,D(s("select",{"onUpdate:modelValue":t[3]||(t[3]=r=>p.sortType=r)},je,512),[[lt,p.sortType]])]),s("button",{class:"btn",onClick:Tt},"\u6E05\u7A7A"),s("button",{class:"btn",onClick:W},"\u8BA1\u7B97\u62A4\u536B"),s("button",{class:"btn btn-success",onClick:mt},"\u4FDD\u5B58\u5E03\u5C40"),s("button",{class:"btn btn-success",onClick:Pt},"\u8FD8\u539F\u5E03\u5C40"),tt("",!0),R(b(ye),null,{popover:X(({onClose:r})=>[s("div",{class:"list",onClick:i=>r()},[(B(!0),$(at,null,rt(b(Ee),(i,c)=>(B(),$("div",{class:"list-item",key:c,onClick:E=>Xt(i)},Y(i.name),9,Ze))),128))],8,Ye)]),default:X(()=>[We]),_:1})]),s("div",Qe,[R(u,null,{default:X(()=>[s("label",to,[eo,R(b(K),{draggable:!1,style:H([`--color:${p.color};--bgcolor:${p.bgcolor}`])},{default:X(()=>[oo]),_:1},8,["style"])]),s("label",so,[no,R(b(O),{modelValue:p.color,"onUpdate:modelValue":t[4]||(t[4]=r=>p.color=r)},null,8,["modelValue"])]),s("label",lo,[ao,R(b(O),{modelValue:p.bgcolor,"onUpdate:modelValue":t[5]||(t[5]=r=>p.bgcolor=r)},null,8,["modelValue"])]),ro,s("div",yo,[(B(!0),$(at,null,rt(b(l),(r,i)=>(B(),yt(b(K),{key:i,selected:p.bgcolor===r.bgcolor,style:H([`--color:${r.color};--bgcolor:${r.bgcolor}`]),onClick:c=>et(r),onDragstart:c=>Wt(c,r)},{default:X(()=>[co]),_:2},1032,["selected","style","onClick","onDragstart"]))),128)),R(b(K),{item:b(z),onDragstart:t[6]||(t[6]=r=>ht(r,b(z)))},null,8,["item"]),R(b(K),{item:b(L),onDragstart:t[7]||(t[7]=r=>ht(r,b(L)))},null,8,["item"])]),s("div",{class:"trush",onDragover:ee,onDrop:t[8]||(t[8]=r=>oe(k.grid))},[(B(),$("svg",io,po))],32)]),_:1})]),s("div",xo,[w.current?(B(),$("div",fo,[R(u,null,{default:X(()=>[s("label",vo,[mo,R(b(K),{draggable:!1,style:H([`--color:${w.current.style.color};--bgcolor:${w.current.style.bgcolor}`]),item:w.current},null,8,["style","item"])]),s("label",bo,[ho,R(b(O),{modelValue:w.current.style.color,"onUpdate:modelValue":t[9]||(t[9]=r=>w.current.style.color=r)},null,8,["modelValue"])]),s("label",go,[_o,R(b(O),{modelValue:w.current.style.bgcolor,"onUpdate:modelValue":t[10]||(t[10]=r=>w.current.style.bgcolor=r)},null,8,["modelValue"])]),s("label",wo,[ko,D(s("input",{type:"number",style:{width:"4em"},min:"12",step:"1","onUpdate:modelValue":t[11]||(t[11]=r=>w.current.data.size=r)},null,512),[[M,w.current.data.size]])]),s("label",Co,[Eo,D(s("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=r=>w.current.data.actorId=r),style:{width:"4em"}},null,512),[[M,w.current.data.actorId]])]),s("label",Bo,[Do,D(s("select",{"onUpdate:modelValue":t[13]||(t[13]=r=>w.current.data.actorType=r)},[s("option",{value:b(v).NONE},"\u65E0",8,So),s("option",{value:b(v).GUARD},"\u62A4\u536B",8,Fo),s("option",{value:b(v).SHEEP},"\u9776\u5B50",8,Vo),s("option",{value:b(v).ATTACKER},"\u653B\u51FB\u8005",8,Io),s("option",{value:b(v).FLY},"\u98DE\u884C",8,Ao),s("option",{value:b(v).BLOCKED},"\u969C\u788D",8,$o),s("option",{value:b(v).CLIFF},"\u60AC\u5D16",8,Go)],512),[[lt,w.current.data.actorType]])]),s("label",Ro,[Lo,D(s("input",{type:"text",ref_key:"txtInput",ref:U,"onUpdate:modelValue":t[14]||(t[14]=r=>w.current.data.txt=r)},null,512),[[x],[M,w.current.data.txt]])]),s("button",{class:"btn",onClick:Ot},"\u5B8C\u6210"),s("button",{class:"btn btn-success",onClick:Jt},"\u602A\u529B\u4E71\u795E")]),_:1})])):tt("",!0)])]),s("div",Mo,[s("div",{class:"grids",style:H(b(ot))},[(B(!0),$(at,null,rt(b(n),(r,i)=>{var c,E;return B(),yt(b(K),{key:i,draggable:!0,selected:r.x===((c=w.current)==null?void 0:c.x)&&r.y===((E=w.current)==null?void 0:E.y),disabled:r.data.disabled,dot:r.data.guard,item:r,onDragstart:C=>jt(C,r),onDragover:t[15]||(t[15]=J(()=>{},["prevent"])),onDrop:C=>Yt(C,r),onContextmenu:J(C=>te(r),["prevent"]),onClick:C=>Nt(C,r),onMousedown:C=>Kt(C,r),onMouseenter:C=>qt(C,r)},null,8,["selected","disabled","dot","item","onDragstart","onDrop","onContextmenu","onClick","onMousedown","onMouseenter"])}),128))],4),s("div",Uo,[R(b(K),{item:b(st),onDragstart:t[16]||(t[16]=r=>gt(r,b(st)))},null,8,["item"]),(B(!0),$(at,null,rt(b(d),(r,i)=>(B(),yt(b(K),{key:i,item:r,onDragstart:c=>gt(c,r)},null,8,["item","onDragstart"]))),128))])])])}}});const qo=dt(Ho,[["__scopeId","data-v-261a5316"]]);export{qo as default};
