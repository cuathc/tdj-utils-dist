import{d as W,_ as X,o as m,c as b,t as at,a as Z,b as it,e as t,f as $,g as r,w as F,v as z,F as I,r as j,h as A,n as ct,i as dt,T as rt,j as _t,k as V,p as tt,l as et,m as pt,q as Q,s as E,u as v,x as ht,y as N,z as y,A as vt,I as mt,B as ft,C as H,D as $t}from"./index.js";import{u as bt,a as Ct,i as yt,b as Et,d as Ft}from"./shared.js";import{_ as Y}from"./lodash.js";const wt=W({props:{type:String},setup(){return{}}});const Bt={key:0,class:"c-sort-desc"},Dt={key:1,class:"c-sort-asc"},gt={key:2,class:"c-sort-none"};function kt(n,l,c,U,g,B){return n.type==="DESC"?(m(),b("span",Bt)):n.type==="ASC"?(m(),b("span",Dt)):(m(),b("span",gt))}const S=X(wt,[["render",kt]]),xt=W({props:{record:Object,width:String,height:String},emits:["update:record","save"],setup(n,{emit:l}){const c=[["qixue","\u6C14\u8840"],["patt","\u7269\u653B"],["pdef","\u7269\u9632"],["matt","\u6CD5\u653B"],["mdef","\u6CD5\u9632"],["huixin","\u4F1A\u5FC3"]],U=at(n,"record"),g=Z(()=>{const f=n.width||600,i=n.height||400;return{width:Number(f)?`${f}px`:f,height:Number(i)?`${i}px`:i}});return{names:c,model:U,dialogStyle:g,onEditorSave:f=>{!f||(l("save",f),l("update:record",void 0))},onEditorCanel:()=>{l("update:record",void 0)},prefixNames:(f,i)=>c.map(([k,D])=>[f.replace("$&",k),i.replace("$&",D)])}}});const _=n=>(tt("data-v-ad8a9a61"),n=n(),et(),n),St={key:0,class:_t(["modal active"])},At={class:"modal-body"},It={class:"models-container"},Vt={class:"models"},Ut={class:"model-item"},Nt=_(()=>t("label",null,"ID",-1)),qt={class:"input"},Tt={class:"model-item"},Ht=_(()=>t("label",null,"\u540D\u79F0",-1)),zt={class:"model-item"},jt=_(()=>t("label",null,"\u5C5E\u76F8",-1)),Ot=_(()=>t("option",{value:"\u708E"},"\u708E",-1)),Mt=_(()=>t("option",{value:"\u96F7"},"\u96F7",-1)),Rt=_(()=>t("option",{value:"\u51B0"},"\u51B0",-1)),Jt=_(()=>t("option",{value:"\u5149"},"\u5149",-1)),Pt=_(()=>t("option",{value:"\u6697"},"\u6697",-1)),Lt=[Ot,Mt,Rt,Jt,Pt],Gt={class:"model-item"},Kt=_(()=>t("label",null,"\u804C\u4E1A",-1)),Qt=_(()=>t("option",{value:"\u94C1\u536B"},"\u94C1\u536B",-1)),Wt=_(()=>t("option",{value:"\u4FA0\u5BA2"},"\u4FA0\u5BA2",-1)),Xt=_(()=>t("option",{value:"\u5492\u5E08"},"\u5492\u5E08",-1)),Yt=_(()=>t("option",{value:"\u795D\u7531"},"\u795D\u7531",-1)),Zt=_(()=>t("option",{value:"\u5FA1\u98CE"},"\u5FA1\u98CE",-1)),te=_(()=>t("option",{value:"\u7FBD\u58EB"},"\u7FBD\u58EB",-1)),ee=[Qt,Wt,Xt,Yt,Zt,te],oe={class:"modal-footer"};function se(n,l,c,U,g,B){const q=V("c-input-text"),T=V("c-input-number"),f=V("c-space");return m(),it(rt,{to:"body"},[n.model?(m(),b("div",St,[t("div",{class:"modal-mask",onClick:l[0]||(l[0]=(...i)=>n.onEditorCanel&&n.onEditorCanel(...i))}),t("div",{class:"modal-dialog",style:ct(n.dialogStyle)},[t("div",At,[t("div",It,[t("div",Vt,[t("div",Ut,[Nt,t("div",qt,$(n.model.id),1)]),t("div",Tt,[Ht,r(q,{value:n.model.name,"onUpdate:value":l[1]||(l[1]=i=>n.model.name=i)},null,8,["value"])]),t("div",zt,[jt,F(t("select",{class:"input","onUpdate:modelValue":l[2]||(l[2]=i=>n.model.prop=i)},Lt,512),[[z,n.model.prop]])]),t("div",Gt,[Kt,F(t("select",{class:"input","onUpdate:modelValue":l[3]||(l[3]=i=>n.model.career=i)},ee,512),[[z,n.model.career]])])]),(m(),b(I,null,j([["$&","0\u7EA7$&"],["$&_cz","$&\u6210\u957F"],["wp_$&","\u5175\u5203$&"],["eq1_$&","\u5934\u90E8$&"],["eq2_$&","\u8EAB\u4F53$&"],["eq3_$&","\u8170\u90E8$&"],["eq4_$&","\u624B\u90E8$&"],["wn0_$&","\u4E3B\u7EBF$&"],["wn1_$&","\u4E0A\u7EBF$&"],["wn2_$&","\u4E0B\u7EBF$&"],["hz_$&","\u5316\u81FB$&"],["hz_$&p","\u5316\u81FB$&%"],["xh_$&","\u661F\u8F89$&"],["xh_$&p","\u661F\u8F89$&%"]],([i,k])=>t("div",{class:"models",key:i},[(m(!0),b(I,null,j(n.prefixNames(i,k),([D,O])=>(m(),b("div",{class:"model-item",key:D},[t("label",null,$(O),1),r(T,{value:n.model[D],"onUpdate:value":M=>n.model[D]=M},null,8,["value","onUpdate:value"])]))),128))])),64))])]),t("div",oe,[r(f,null,{default:A(()=>[t("button",{class:"btn btn-sm btn-primary-outline",onClick:l[4]||(l[4]=i=>n.onEditorSave(n.model))},"\u4FDD\u5B58"),t("button",{class:"btn btn-sm btn-danger-outline",onClick:l[5]||(l[5]=i=>n.onEditorCanel())},"\u53D6\u6D88")]),_:1})])],4)])):dt("",!0)])}const ne=X(xt,[["render",se],["__scopeId","data-v-ad8a9a61"]]),a=n=>(tt("data-v-adc1c686"),n=n(),et(),n),le={class:"toolbar"},ue=a(()=>t("span",{class:"title"},"\u4EBA\u7269\u5217\u8868",-1)),ae={class:"label-control-inline"},ie=a(()=>t("span",null,"\u540D\u5B57",-1)),ce={class:"label-control-inline"},de=a(()=>t("span",null,"\u5C5E\u6027",-1)),re=a(()=>t("option",{value:""},"\u5168\u90E8",-1)),_e=a(()=>t("option",{value:"\u708E"},"\u708E",-1)),pe=a(()=>t("option",{value:"\u96F7"},"\u96F7",-1)),he=a(()=>t("option",{value:"\u51B0"},"\u51B0",-1)),ve=a(()=>t("option",{value:"\u5149"},"\u5149",-1)),me=a(()=>t("option",{value:"\u6697"},"\u6697",-1)),fe=[re,_e,pe,he,ve,me],$e={class:"label-control-inline"},be=a(()=>t("span",null,"\u804C\u4E1A",-1)),Ce=a(()=>t("option",{value:""},"\u5168\u90E8",-1)),ye=a(()=>t("option",{value:"\u94C1\u536B"},"\u94C1\u536B",-1)),Ee=a(()=>t("option",{value:"\u4FA0\u5BA2"},"\u4FA0\u5BA2",-1)),Fe=a(()=>t("option",{value:"\u5492\u5E08"},"\u5492\u5E08",-1)),we=a(()=>t("option",{value:"\u795D\u7531"},"\u795D\u7531",-1)),Be=a(()=>t("option",{value:"\u5FA1\u98CE"},"\u5FA1\u98CE",-1)),De=a(()=>t("option",{value:"\u7FBD\u58EB"},"\u7FBD\u58EB",-1)),ge=[Ce,ye,Ee,Fe,we,Be,De],ke={class:"c-label"},xe=y(" \u661F\u8000 "),Se={class:"c-label"},Ae=y(" \u5316\u81FB "),Ie={class:"c-label"},Ve=y(" \u661F\u9B42 "),Ue={class:"c-label"},Ne=y(" \u661F\u8F89 "),qe={class:"c-upload"},Te=a(()=>t("button",{class:"btn btn-success"},"\u5BFC\u5165",-1)),He={class:"content"},ze={class:"table-wrap"},je={class:"table table-bordered",style:{"min-width":"100%"}},Oe=a(()=>t("colgroup",null,[t("col",{width:"60"}),t("col",{width:"80"}),t("col",{width:"80"}),t("col",{width:"80"}),t("col",{width:"80"}),t("col",{width:"80"}),t("col",{width:"80"}),t("col",{width:"80"}),t("col",{width:"80"}),t("col",{width:"80"}),t("col",{width:"100"})],-1)),Me={style:{position:"sticky",top:"100px"}},Re=a(()=>t("th",null,"#",-1)),Je=a(()=>t("th",null,"\u540D\u5B57",-1)),Pe=y(" \u6C14\u8840 "),Le=y(" \u7269\u653B "),Ge=y(" \u7269\u9632 "),Ke=y(" \u6CD5\u653B "),Qe=y(" \u6CD5\u9632 "),We=y(" \u4F1A\u5FC3 "),Xe=a(()=>t("th",null,"\u5C5E\u6027",-1)),Ye=a(()=>t("th",null,"\u804C\u4E1A",-1)),Ze=a(()=>t("th",null,"\u64CD\u4F5C",-1)),to={class:"cell-static text-center"},eo={class:"cell-static text-center"},oo={class:"cell-static text-center"},so={class:"cell-static text-center"},no={class:"cell-static text-center"},lo={class:"cell-static text-center"},uo={class:"cell-static text-center"},ao={class:"cell-static text-center"},io={class:"cell-static text-center"},co={class:"cell-static text-center"},ro={class:"cell-static"},_o=["onClick"],po=["onClick"],ho=W({__name:"Heroes",setup(n){const l=mt(),c=pt({name:"",prop:"",career:""}),U=Z(()=>nt(E.value)),g=Q(-1),{editor:B,defaultHeroState:q}=bt(),T=s=>{const e=E.value.find(u=>u.id===s);!e||(g.value=s,B.value=Y.cloneDeep(e))},f=async s=>{g.value=-1;const e=E.value.find(u=>u.id===s.id);if(!!e){Object.assign(e,s);try{if(!l)return;await l.connect(),await l.put("heroes",Y.cloneDeep(e))}catch(u){console.log(u)}}};function i(s){if(s instanceof Error)switch(s.name){case"ConstraintError":alert("\u6570\u636E\u5DF2\u7ECF\u5B58\u5728");break;default:alert(s.message)}else alert(s)}async function k(){try{await vt()}catch(s){i(s)}}async function D(){try{if(!l)return;const s=q();await l.connect(),delete s.id;const e=await l.add("heroes",s),u=await l.get("heroes",e);if(!u)return;E.value.push(u)}catch(s){i(s)}}async function O(s){try{if(!l||!s.id||!confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F"))return;await l.connect(),await l.delete("heroes",s.id),E.value=E.value.filter(e=>e.id!==s.id)}catch(e){i(e)}}function M(s){return new Promise((e,u)=>{const d=new FileReader;d.onload=()=>{e(JSON.parse(d.result))},d.onerror=()=>{u(d.error)},d.readAsText(s)})}async function ot(s){try{const e=s.currentTarget,u=e.files;if(!u||!l)return;await l.connect(),console.log("\u6570\u636E\u5BFC\u5165\u5F00\u59CB");for(let d=0;d<u.length;d++){const C=await M(u[d]);let o=[];if(yt(C))o=C;else if(Et(C)&&C.type==="heroes")o=C.data;else{alert("\u5BFC\u5165\u7684\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E");return}for(const K of o)await l.put("heroes",K);console.log("\u6570\u636E\u5BFC\u5165\u7ED3\u675F")}e.value="",k()}catch(e){i(e)}}function st(){const s=new Blob([JSON.stringify({type:"heroes",data:E.value})]);Ft(s,"heroes.json")}const p=Q("name"),h=Q("");function x(s){if(p.value===s)switch(h.value){case"DESC":h.value="ASC";break;case"ASC":h.value="";break;default:h.value="DESC"}else p.value=s,h.value="DESC"}function nt(s){let e=s.slice();return c.name&&(e=e.filter(u=>u.name.includes(c.name))),c.prop&&(e=e.filter(u=>u.prop===c.prop)),c.career&&(e=e.filter(u=>u.career===c.career)),e.sort((u,d)=>{switch(p.value){case"qixue":case"patt":case"pdef":case"matt":case"mdef":case"huixin":{const C=R(u),o=R(d);return h.value==="DESC"?o[p.value]-C[p.value]:h.value==="ASC"?C[p.value]-o[p.value]:d.weight-u.weight}default:return d.weight-u.weight}}),e}function lt(){$t()}(!E.value||E.value.length===0)&&k();const{translate:R,xingyao:J,huazhen:P,xinghun:L,xinghui:G}=Ct();return(s,e)=>{const u=V("c-col"),d=V("c-space"),C=V("c-row");return m(),b(I,null,[t("div",ht({class:"wrapper"},s.$attrs),[t("div",le,[r(C,{flex:"",middle:"",style:{padding:"4px 16px"}},{default:A(()=>[r(u,{flex:"1 1 0"},{default:A(()=>[ue,t("label",ae,[ie,F(t("input",{class:"input",type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>c.name=o)},null,512),[[ft,c.name]])]),t("label",ce,[de,F(t("select",{class:"select","onUpdate:modelValue":e[1]||(e[1]=o=>c.prop=o)},fe,512),[[z,c.prop]])]),t("label",$e,[be,F(t("select",{class:"select","onUpdate:modelValue":e[2]||(e[2]=o=>c.career=o)},ge,512),[[z,c.career]])])]),_:1}),r(u,{flex:"0 0 auto"},{default:A(()=>[r(d,{size:"8"},{default:A(()=>[t("label",ke,[F(t("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=o=>N(J)?J.value=o:null)},null,512),[[H,v(J)]]),xe]),t("label",Se,[F(t("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=o=>N(P)?P.value=o:null)},null,512),[[H,v(P)]]),Ae]),t("label",Ie,[F(t("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=o=>N(L)?L.value=o:null)},null,512),[[H,v(L)]]),Ve]),t("label",Ue,[F(t("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=o=>N(G)?G.value=o:null)},null,512),[[H,v(G)]]),Ne])]),_:1}),t("div",{class:"c-upload"},[t("button",{class:"btn btn-danger",onClick:lt},"\u8F7D\u5165\u9ED8\u8BA4")]),t("div",qe,[Te,t("input",{type:"file",class:"c-upload-input",accept:"application/json",onInput:e[7]||(e[7]=o=>ot(o))},null,32)]),t("button",{class:"btn btn-success",onClick:st},"\u5BFC\u51FA"),t("button",{class:"btn btn-primary",onClick:e[8]||(e[8]=o=>D())},"\u6DFB\u52A0")]),_:1})]),_:1})]),t("div",He,[t("div",ze,[t("table",je,[Oe,t("thead",Me,[t("tr",null,[Re,Je,t("th",null,[Pe,r(v(S),{type:p.value==="qixue"?h.value:"",onClick:e[9]||(e[9]=o=>x("qixue"))},null,8,["type"])]),t("th",null,[Le,r(v(S),{type:p.value==="patt"?h.value:"",onClick:e[10]||(e[10]=o=>x("patt"))},null,8,["type"])]),t("th",null,[Ge,r(v(S),{type:p.value==="pdef"?h.value:"",onClick:e[11]||(e[11]=o=>x("pdef"))},null,8,["type"])]),t("th",null,[Ke,r(v(S),{type:p.value==="matt"?h.value:"",onClick:e[12]||(e[12]=o=>x("matt"))},null,8,["type"])]),t("th",null,[Qe,r(v(S),{type:p.value==="mdef"?h.value:"",onClick:e[13]||(e[13]=o=>x("mdef"))},null,8,["type"])]),t("th",null,[We,r(v(S),{type:p.value==="huixin"?h.value:"",onClick:e[14]||(e[14]=o=>x("huixin"))},null,8,["type"])]),Xe,Ye,Ze])]),t("tbody",null,[(m(!0),b(I,null,j(v(U),(o,K)=>(m(),b("tr",{key:o.id,class:"c-user-row"},[t("td",to,$(K+1),1),t("td",eo,$(o.name),1),(m(!0),b(I,null,j([v(R)(o)],(w,ut)=>(m(),b(I,{key:ut},[t("td",oo,$(w.qixue),1),t("td",so,$(w.patt),1),t("td",no,$(w.pdef),1),t("td",lo,$(w.matt),1),t("td",uo,$(w.mdef),1),t("td",ao,$(w.huixin),1)],64))),128)),t("td",io,$(o.prop),1),t("td",co,$(o.career),1),t("td",ro,[r(d,null,{default:A(()=>[t("button",{class:"btn btn-sm btn-primary-outline",onClick:w=>T(o.id)}," \u7F16\u8F91 ",8,_o),t("button",{class:"btn btn-sm btn-danger-outline",onClick:w=>O(o)},"\u5220\u9664",8,po)]),_:2},1024)])]))),128))])])])])],16),r(ne,{record:v(B),"onUpdate:record":e[15]||(e[15]=o=>N(B)?B.value=o:null),width:"800",height:"600",onSave:f},null,8,["record"])],64)}}});const $o=X(ho,[["__scopeId","data-v-adc1c686"]]);export{$o as default};
