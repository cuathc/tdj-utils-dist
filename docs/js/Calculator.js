import{_ as et,J as Qt,o as i,c as v,b as t,K as Xt,L as Wt,M as Zt,N as rt,d as ct,h as Q,O as Rt,r as nt,m as w,g as mt,n as It,P as Yt,w as vt,i as ht,t as te,a as tt,l as h,k as F,e as a,f as K,Q as ee,p as O,G as ut,R as Mt,S as se,F as H,s as L,U as ne,D as X,V as gt,W as Gt,y as xt,z as wt,j as lt,T as Nt,I as oe,B as ae,X as ue,x as _t,C as Ct,v as Tt,Y as bt,Z as N,$ as le,q as yt}from"./index.js";import{_ as Dt}from"./lodash.js";import{u as ce}from"./useHeroes.js";import ie from"./InputNumber.js";import{b as Lt,d as Ut,a as de,i as re}from"./shared.js";import{S as J,a as pe}from"./star-crystals.js";import{s as qt}from"./data.js";const _e=["width","height"],fe=t("path",{d:"M16 3 l-14 14 l0 6 l14 -14 l14 14 l0 -6 l-14 -14 z"},null,-1),ve=[fe];function he(e,n,s,o,u,B){return i(),v("svg",{width:e.width,height:e.height,viewBox:"0 0 32 32"},ve,8,_e)}const me=et(Qt,[["render",he]]),be=["width","height"],Fe=t("path",{d:"M16 27 l-14 -14 l0 -6 l14 14 l14 -14 l0 6 l-14 14 z"},null,-1),Be=[Fe];function $e(e,n,s,o,u,B){return i(),v("svg",{width:e.width,height:e.height,viewBox:"0 0 32 32"},Be,8,be)}const ye=et(Xt,[["render",$e]]),Ce=["width","height"],ge=t("path",{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"},null,-1),xe=[ge];function we(e,n,s,o,u,B){return i(),v("svg",{width:e.width,height:e.height,viewBox:"0 0 24 24"},xe,8,Ce)}const jt=et(Wt,[["render",we]]),Ee=["width","height"],ke=t("path",{d:"M18 12.13V10H20V10.3C19.78 10.42 19.57 10.56 19.39 10.74L18 12.13M9.5 11C9.22 11 9 11.22 9 11.5V13H15V11.5C15 11.22 14.78 11 14.5 11H9.5M6 10H4V21H11V19.13L11.13 19H6V10M21 9H3V3H21V9M19 5H5V7H19V5M13 19.96V22H15.04L21.17 15.88L19.13 13.83L13 19.96M22.85 13.47L21.53 12.15C21.33 11.95 21 11.95 20.81 12.15L19.83 13.13L21.87 15.17L22.85 14.19C23.05 14 23.05 13.67 22.85 13.47Z"},null,-1),De=[ke];function Ae(e,n,s,o,u,B){return i(),v("svg",{width:e.width,height:e.height,viewBox:"0 0 24 24"},De,8,Ee)}const Se=et(Zt,[["render",Ae]]);let St=0,Ht=0;const Me=500;function Pt(){const e=Math.floor(new Date().getTime()/1e3);Ht===e?St++:St=0,Ht=e;const n=e.toString(16);return`${(Me<<16|St&255).toString(16)}.${n}`}async function Ue(){try{return await rt.getAll("calculator")}catch{return[]}}async function Ve(e){try{await rt.add("calculator",JSON.parse(JSON.stringify(e)))}catch(n){n instanceof Error?console.log(n.message):console.log(n)}}async function kt(e){try{await rt.put("calculator",JSON.parse(JSON.stringify(e)))}catch(n){n instanceof Error?console.log(n.message):console.log(n)}}async function Ie(e){try{await rt.delete("calculator",e)}catch(n){n instanceof Error?console.log(n.message):console.log(n)}}async function Te(e){try{const o=(await rt.connect()).transaction("calculator","readwrite").objectStore("calculator");for(const u of e)await rt.wrap(o.put(u))}catch(n){n instanceof Error?console.log(n.message):console.log(n)}}async function He(e){try{const o=(await rt.connect()).transaction("calculator","readwrite").objectStore("calculator");for(const u of e)await rt.wrap(o.delete(u))}catch(n){n instanceof Error?console.log(n.message):console.log(n)}}function Pe(){return{w:2438,g:0,a:"403+363",c:20,x:0}}function Re(){return{a:0}}function Ge(){return{att:0}}function Ot(){return{name:"1.5\u6280\u80FD",desc:"",a1:1.5,a2:0,att:"15+10+8",da:"10+10",db:"4+10+20",dc:"0",dx:"0",id:"0",cd:"30",att2:"0",da2:"0",dx2:"0",defGain:"0",kz:0}}function Ne(){return{a1:1.5,a2:0,att:0,id:0,da:0,db:0,dc:0,dx:0,cd:0,att2:0,da2:0,dx2:0,defGain:0}}function Le(){return[Ot()]}function qe(){return{hp:"10000",def:"1872",defExt:"0",defGain:"15+5",ra:"0",rb:"4+10"}}const je=ct({props:{active:Boolean,label:String,dir:String,inline:Boolean,color:String,wait:{type:Number,default:500}},emits:["update:active"],setup(e,{emit:n}){const s=Q(),o=Q({}),u=Q(e.active),B=()=>{const C=s.value.getBoundingClientRect();switch(u.value=!0,n("update:active",u.value),e.dir){case"left":o.value={top:`${C.top+C.height/2}px`,right:`${window.innerWidth-C.left-4}px`,maxWidth:"100%"};break;case"right":o.value={top:`${C.top+C.height/2}px`,left:`${C.right+4}px`,maxWidth:"100%"};break;case"top":o.value={bottom:`${window.innerHeight-C.top-4}px`,left:`${C.left+C.width/2}px`,maxWidth:"100%"};break;default:o.value={top:`${C.bottom+4}px`,left:`${C.left+C.width/2}px`,maxWidth:"100%"}}};let d;const r=()=>{d=window.setTimeout(B,e.wait)},g=()=>{clearTimeout(d),u.value=!1,n("update:active",u.value)};return Rt(()=>e.active,S=>{u.value=S}),{el:s,style:o,tActive:u,onEnter:r,onOut:g}}});const Oe={class:"c-tooltip-label"};function ze(e,n,s,o,u,B){return i(),v("div",{ref:"el",class:mt(["c-tooltip",{active:e.tActive,inline:e.inline}]),onMouseenter:n[0]||(n[0]=(...d)=>e.onEnter&&e.onEnter(...d)),onMouseout:n[1]||(n[1]=(...d)=>e.onOut&&e.onOut(...d))},[nt(e.$slots,"label",{},()=>[t("div",Oe,w(e.label),1)]),t("div",{class:mt(["c-tooltip-inner",e.dir?`c-tooltip-${e.dir}`:"c-tooltip-bottom",e.color?`c-tooltip-${e.color}`:""]),style:It(e.style)},[nt(e.$slots,"default")],6)],34)}const pt=et(je,[["render",ze]]),Ke=["onClick"],Je=ct({__name:"dropdown",props:{pos:{default:"lt"}},setup(e){const n=Q(!1),s=()=>{n.value=!0},o=()=>{n.value=!1};return window.addEventListener("click",o,!1),Yt(()=>{window.removeEventListener("click",o,!1)}),(u,B)=>(i(),v("div",{class:mt(["dropdown",[{active:n.value}]]),onClick:vt(s,["stop"])},[nt(u.$slots,"default",{},void 0,!0),t("div",{class:mt(["dropdown-popover",["dropdown-"+e.pos]]),onClick:B[0]||(B[0]=vt(()=>{},["stop"]))},[nt(u.$slots,"popover",{onClose:o},void 0,!0)],2)],10,Ke))}});const zt=et(Je,[["__scopeId","data-v-e27f2ee9"]]);zt.install=e=>{e.component("dropdown",Kt)};const Kt=zt,ot=e=>(xt("data-v-a6a2fd75"),e=e(),wt(),e),Qe=["onKeypress"],Xe=["onKeypress"],We=ot(()=>t("div",{class:"label"},"\u514B\u5236%",-1)),Ze=X(" \u514B\u523630%"),Ye=ot(()=>t("br",null,null,-1)),ts=X("\u88AB\u514B\u5236-25%"),es=ot(()=>t("br",null,null,-1)),ss=X("\u6FC0\u836150% "),ns=["onClick"],os=["onClick"],as={class:"row"},us={class:"col-item"},ls=ot(()=>t("div",{class:"label"},"\u6280\u80FD\u3001\u666E\u653B",-1)),cs=X(" \u6280\u80FD\u3001\u666E\u653B\u500D\u7387 "),is={class:"input-group"},ds=["step"],rs=ot(()=>t("div",{class:"input-ext"},"\u500D",-1)),ps={class:"label"},_s={class:"input-group"},fs=ot(()=>t("div",{style:{clear:"both"}},null,-1)),vs={class:"col-item"},hs=ot(()=>t("div",{class:"label"},"\u8FDE\u51FB\u3001\u8FFD\u51FB\u3001\u53CD\u51FB",-1)),ms=X(" \u8FDE\u51FB\u3001\u8FFD\u51FB\u3001\u53CD\u51FB\u500D\u7387 "),bs={class:"input-group"},Fs=["step"],Bs=ot(()=>t("div",{class:"input-ext"},"\u500D",-1)),$s={class:"label"},ys={class:"input-group"},Cs={class:"col-item"},gs=ot(()=>t("div",{class:"label"},"\u6700\u7EC8\u653B\u51FB",-1)),xs={class:"static-control text-center"},ws={class:"darkgold"},Es=ot(()=>t("div",{style:{clear:"both"}},null,-1)),ks={class:"label"},Ds={class:"bold darkgold"},As=ot(()=>t("span",{class:"bold red"},"(\u66B4\u51FB)",-1)),Ss={class:"static-control text-center"},Ms={class:"bold darkgold"},Us={class:"bold red"},Vs={class:"label bold"},Is={class:"static-control text-center"},Ts={class:"bold darkgold"},Hs={key:0,class:"bold red"},Ps=ct({__name:"CalcItem",props:{panel:null,state:null,enemyState:null,itemState:null,showUp:{type:Boolean},showDown:{type:Boolean}},emits:["close","up","down","copy","update:itemState"],setup(e,{emit:n}){const s=e,o=ht({editor:!1,name:"",desc:{f:!1,v:""}}),u=ht(Ne()),B=te(s,"itemState"),d=()=>{n("update:itemState",B.value)},r=[{name:"att",label:"\u653B\u51FB%",tip:"\u4F5C\u7528\u4E8E\u6240\u6709\u60C5\u51B5"},{name:"da",label:"A\u7C7B\u589E\u4F24%",tip:"\u9970\u54C1\u3001\u5404\u7C7Bbuff\u3001\u5929\u8D4B"},{name:"db",label:"B\u7C7B\u589E\u4F24%",tip:"\u661F\u8000\u3001\u661F\u76D8\u3001\u8BCD\u6761"},{name:"dx",label:"X\u7C7B\u589E\u4F24%",tip:"\u6700\u7EC8\u4FEE\u6B63\uFF0C\u5982\u4E00\u5B57\u7535\u65A9"},{name:"id",label:"\u7A7F\u900F%",tip:"\u65E0\u89C6\u9632\u5FA1"},{name:"cd",label:"\u66B4\u4F24%",tip:"\u66B4\u51FB\u4F24\u5BB3"}],g=[{name:"dc",label:"C\u7C7B\u589E\u4F24%",tip:"\u8FDE\u51FB\u3001\u8FFD\u51FB\u3001\u53CD\u51FB\u589E\u4F24"},{name:"att2",label:"\u653B\u51FB\u4FEE\u6B63%",tip:"\u6389\u8840\u540E\u653B\u51FB\u4FEE\u6B63\uFF0C\u4E00\u822C\u5728\u8FFD\u51FB\u6216\u53CD\u51FB\u65F6"},{name:"da2",label:"\u4F24\u5BB3\u4FEE\u6B63%",tip:"\u6389\u8840\u540E\u4F24\u5BB3\u4FEE\u6B63\uFF0C\u4E00\u822C\u5728\u8FFD\u51FB\u6216\u53CD\u51FB\u65F6"},{name:"defGain",label:"\u9632\u5FA1\u4FEE\u6B63%",tip:"\u6389\u8840\u540E\u9632\u5FA1\u4FEE\u6B63\uFF0C\u4E00\u822C\u5728\u8FFD\u51FB\u6216\u8FDE\u51FB\u65F6"},{name:"dx2",label:"X\u7C7B\u4FEE\u6B63%",tip:"\u6389\u8840\u540E\u9632\u5FA1\u4FEE\u6B63\uFF0C\u4E00\u822C\u5728\u8FFD\u51FB\u6216\u8FDE\u51FB\u65F6"}],S=tt(()=>{const{state:m}=s,c=(100+u.att)/100;return Math.ceil(m.att*c)}),C=tt(()=>{const{state:m}=s,c=(100+u.att+u.att2)/100;return Math.ceil(m.att*c)}),P=()=>{const{enemyState:m}=s,c=B.value,D=(100+c.kz)/100,b=(100+u.da-m.ra)/100,U=(100+u.da+u.da2-m.ra)/100,st=(100+u.db-m.rb)/100,it=(100+u.dc)/100,T=(100+u.dx)/100,y=(100+u.dx+u.dx2)/100,Y=(100+u.cd)/100,j=(100-u.id)/100,$t=(100+m.defGain)/100,p=(100+m.defGain+u.defGain)/100,$=Math.max(0,Math.max(0,m.def*$t+m.defExt)*j),l=Math.max(0,Math.max(0,m.def*p+m.defExt)*j),A=Math.max(1,S.value*D-$),G=Math.max(1,C.value*D-l),Z=A*c.a1*b*st*T,at=Math.ceil(Z*Y),dt=G*c.a2*U*st*it*y,x=Math.ceil(dt*Y);return{r01:Math.ceil(Z),r01c:at,r02:Math.ceil(dt),r02c:x}},f=tt(()=>P());function _(){confirm(`\u786E\u8BA4\u8981\u5220\u9664\u6280\u80FD\u6A21\u677F"${s.itemState.name}"\u5417\uFF1F`)&&n("close")}function E(){o.editor=!0,o.name=s.itemState.name}function k(){const m=o.name;if(o.editor=!1,o.name="",!m)return;const c=s.itemState;c.name=m,n("update:itemState",c)}function R(){o.desc.f=!0,o.desc.v=s.itemState.desc}function V(){const m=o.desc.v;if(o.desc.f=!1,o.desc.v="",!m)return;const c=s.itemState;c.desc=m,n("update:itemState",c)}function I(){n("up")}function q(){n("down")}function M(){n("copy")}return(m,c)=>{const D=Gt("autofocus");return i(),v(H,null,[h(a(ne),{orientation:"left"},{action:F(()=>[t("span",{onClick:M},[h(a(jt),{class:"close"})]),e.showUp?(i(),v("span",{key:0,onClick:I},[h(a(me),{class:"close"})])):K("",!0),e.showDown?(i(),v("span",{key:1,onClick:q},[h(a(ye),{class:"close"})])):K("",!0),t("span",{onClick:_},[h(a(ee),{class:"close"})])]),default:F(()=>[o.editor?O((i(),v("input",{key:0,class:"input",type:"text","onUpdate:modelValue":c[0]||(c[0]=b=>o.name=b),onKeypress:Mt(k,["enter"]),onBlur:k},null,40,Qe)),[[ut,o.name],[D]]):(i(),v("span",{key:1,class:"calc-item-title",onClick:E},w(a(B).name||"\u6A21\u677F"),1)),o.desc.f?O((i(),v("input",{key:2,class:"input",type:"text","onUpdate:modelValue":c[1]||(c[1]=b=>o.desc.v=b),onKeypress:Mt(V,["enter"]),onBlur:V},null,40,Xe)),[[ut,o.desc.v],[D]]):(i(),v("span",{key:3,class:"calc-item-desc",onClick:R},w(a(B).desc||"\u6CA1\u6709\u63CF\u8FF0"),1)),h(a(se),{style:{width:"120px"}},{default:F(()=>[h(a(pt),{dir:"top"},{label:F(()=>[We]),default:F(()=>[Ze,Ye,ts,es,ss]),_:1}),t("div",null,[h(a(Kt),null,{popover:F(({onClose:b})=>[t("div",{class:"list",onClick:U=>b()},[(i(),v(H,null,L([{label:"\u666E\u901A",value:0},{label:"\u514B\u5236",value:30},{label:"\u88AB\u514B\u5236",value:-25},{label:"\u6FC0\u8361",value:50}],({label:U,value:st})=>t("div",{key:U,class:"list-item",onClick:it=>{a(B).kz=st,d()}},w(U),9,os)),64))],8,ns)]),default:F(()=>[O(t("input",{class:"input",type:"number","onUpdate:modelValue":c[2]||(c[2]=b=>a(B).kz=b)},null,512),[[ut,a(B).kz,void 0,{number:!0}]])]),_:1})])]),_:1})]),_:1}),t("div",as,[t("div",us,[h(a(pt),{dir:"top"},{label:F(()=>[ls]),default:F(()=>[cs]),_:1}),t("div",is,[O(t("input",{type:"number",class:"input",min:"0",step:.1,"onUpdate:modelValue":c[3]||(c[3]=b=>a(B).a1=b),onInput:d},null,40,ds),[[ut,a(B).a1,void 0,{number:!0}]]),rs])]),(i(),v(H,null,L(r,b=>t("div",{class:"col-item",key:b.name},[h(a(pt),{dir:"top"},{label:F(()=>[t("div",ps,w(b.label),1)]),default:F(()=>[X(" "+w(b.tip),1)]),_:2},1024),t("div",_s,[h(a(gt),{class:"input",modelValue:a(B)[b.name],"onUpdate:modelValue":U=>a(B)[b.name]=U,result:u[b.name],"onUpdate:result":[U=>u[b.name]=U,d]},null,8,["modelValue","onUpdate:modelValue","result","onUpdate:result"])])])),64)),fs,t("div",vs,[h(a(pt),{dir:"top"},{label:F(()=>[hs]),default:F(()=>[ms]),_:1}),t("div",bs,[O(t("input",{type:"number",class:"input",min:"0",step:.1,"onUpdate:modelValue":c[4]||(c[4]=b=>a(B).a2=b),onInput:d},null,40,Fs),[[ut,a(B).a2,void 0,{number:!0}]]),Bs])]),(i(),v(H,null,L(g,b=>t("div",{class:"col-item",key:b.name},[h(a(pt),{dir:"top"},{label:F(()=>[t("div",$s,w(b.label),1)]),default:F(()=>[X(" "+w(b.tip),1)]),_:2},1024),t("div",ys,[h(a(gt),{class:"input",modelValue:a(B)[b.name],"onUpdate:modelValue":U=>a(B)[b.name]=U,result:u[b.name],"onUpdate:result":[U=>u[b.name]=U,d]},null,8,["modelValue","onUpdate:modelValue","result","onUpdate:result"])])])),64)),t("div",Cs,[gs,t("div",xs,[t("span",ws,w(a(S)),1)])]),Es,(i(!0),v(H,null,L([a(f)],b=>(i(),v(H,null,[(i(!0),v(H,null,L([{label:"\u4E00\u6BB5\u4F24\u5BB3",v:b.r01,v2:b.r01c},{label:"\u4E8C\u6BB5\u4F24\u5BB3",v:b.r02,v2:b.r02c}],(U,st)=>(i(),v("div",{class:"col-item",key:st},[t("div",ks,[t("span",Ds,w(U.label),1),As]),t("div",Ss,[t("span",Ms,w(U.v),1),t("span",Us,"("+w(U.v2)+")",1)])]))),128)),(i(!0),v(H,null,L([{label:"\u4E0D\u66B4\u51FB",value:b.r01+b.r02},{label:"\u4E00\u6BB5\u66B4\u51FB",value:b.r01c+b.r02},{label:"\u4E8C\u6BB5\u66B4\u51FB",value:b.r01+b.r02c},{label:"\u5168\u66B4\u51FB",value:b.r01c+b.r02c}],(U,st)=>(i(),v("div",{class:"col-item",key:st},[t("div",Vs,w(U.label),1),t("div",Is,[t("span",Ts,w(U.value),1),(+e.enemyState.hp||0)<=U.value?(i(),v("span",Hs," \u51FB\u6740 ")):K("",!0)])]))),128))],64))),256))])],64)}}});const Rs=et(Ps,[["__scopeId","data-v-a6a2fd75"]]),At=e=>(xt("data-v-bd82d11d"),e=e(),wt(),e),Gs=At(()=>t("div",{class:"heading"},[t("div",{class:"heading-title"},"\u57FA\u672C\u53C2\u6570")],-1)),Ns={class:"row"},Ls={class:"label"},qs={class:"input-group"},js=["step","onUpdate:modelValue","onChange"],Os=["value"],zs={class:"col-item"},Ks=At(()=>t("div",{class:"label"},"\u8FDB\u56FE\u653B\u51FB",-1)),Js={class:"static-control text-center"},Qs={class:"darkgold"},Xs=At(()=>t("div",{class:"heading"},[t("div",{class:"heading-title"},"\u654C\u4EBA\u9762\u677F")],-1)),Ws={class:"row"},Zs={class:"label"},Ys={key:1,class:"label"},tn={class:"input-group"},en={key:0,class:"input-ext"},sn=At(()=>t("div",{class:"heading-title"},"\u6280\u80FD\u6A21\u677F",-1)),nn=ct({__name:"Calculator",props:{data:null},emits:["update:data"],setup(e,{emit:n}){const s=e,o=tt(()=>s.data.basic),u=tt(()=>s.data.state),B=tt(()=>s.data.enemyState),d=tt(()=>s.data.items),r=ht(Re()),g=ht({hp:0,def:0,defExt:0,defGain:0,ra:0,rb:0}),S=[{label:"\u9762\u677F\u653B\u51FB",name:"w",step:1,align:"right"},{label:"\u9B42\u77F3\u653B\u51FB",name:"a",step:1},{label:"\u8BCD\u6761\u653B\u51FB%",name:"c",step:1},{label:"\u661F\u4E4B\u6676\u653B\u51FB",name:"x",step:1}],C=[{label:"\u6C14\u8840",name:"hp",step:1},{label:"\u9632\u5FA1",name:"def",step:1},{label:"\u9644\u52A0\u9632\u5FA1",name:"defExt",step:1,tips:"\u4E00\u822C\u4E3A\u653B\u8F6C\u9632\u9644\u52A0\u7684\u56FA\u5B9A\u9632\u5FA1"},{label:"\u9632\u5FA1\u4FEE\u6B63%",name:"defGain",step:1},{label:"A\u7C7B\u514D\u4F24%",name:"ra",step:1},{label:"B\u7C7B\u514D\u4F24%",name:"rb",step:1}],P=()=>{const M=o.value.c/100;o.value.g=Math.ceil(r.a+o.value.w*M+o.value.x),u.value.att=o.value.w+o.value.g},f=async()=>{n("update:data",s.data)},_=(M,m)=>{m==="panel"&&P(),f()},E=(M,m)=>{const c=s.data.items;!c||(c[m]=M,f())},k=()=>{const M=s.data.items;!M||(M.push(Ot()),f())},R=M=>{const m=s.data.items;!m||(m.splice(M,1),f())},V=M=>{const m=s.data.items;if(!m)return;const c=m[M],D=m[M-1];m[M-1]=c,m[M]=D,f()},I=M=>{const m=s.data.items;if(!m)return;const c=m[M],D=m[M+1];m[M+1]=c,m[M]=D,f()},q=M=>{const m=s.data.items;if(!m)return;const c=m[M];m.push(Dt.cloneDeep(c)),f()};return Rt(()=>[s.data.basic.w],()=>{P()}),(M,m)=>(i(),v("div",null,[Gs,t("div",Ns,[(i(),v(H,null,L(S,c=>t("div",{class:"col-item",key:c.name},[t("div",Ls,w(c.label),1),t("div",qs,[c.name in r?(i(),lt(a(gt),{key:0,modelValue:a(o)[c.name],"onUpdate:modelValue":D=>a(o)[c.name]=D,result:r[c.name],"onUpdate:result":D=>r[c.name]=D,onChange:D=>_(c.name,"panel")},null,8,["modelValue","onUpdate:modelValue","result","onUpdate:result","onChange"])):O((i(),v("input",{key:1,type:"number",class:"input",style:It({textAlign:c.align}),min:"0",step:c.step,"onUpdate:modelValue":D=>a(o)[c.name]=D,onChange:D=>_(c.name,"panel")},null,44,js)),[[ut,a(o)[c.name],void 0,{number:!0}]]),c.name==="w"?(i(),v("input",{key:2,class:"input green",readonly:"",style:{textAlign:"left"},value:`+${a(o).g}`},null,8,Os)):K("",!0)])])),64)),t("div",zs,[Ks,t("div",Js,[t("span",Qs,w(a(u).att),1)])])]),Xs,t("div",Ws,[(i(),v(H,null,L(C,c=>t("div",{class:"col-item",key:c.name},[c.tips?(i(),lt(a(pt),{key:0,dir:"top"},{label:F(()=>[t("div",Zs,w(c.label),1)]),default:F(()=>[X(" "+w(c.tips),1)]),_:2},1024)):(i(),v("div",Ys,w(c.label),1)),t("div",tn,[h(a(gt),{modelValue:a(B)[c.name],"onUpdate:modelValue":D=>a(B)[c.name]=D,result:g[c.name],"onUpdate:result":D=>g[c.name]=D,onChange:D=>_(c.name)},null,8,["modelValue","onUpdate:modelValue","result","onUpdate:result","onChange"]),c.precent?(i(),v("div",en,"%")):K("",!0)])])),64))]),t("div",{class:"heading"},[sn,t("div",{class:"heading-actions"},[t("div",{class:"btn btn-primary btn-sm",onClick:k},"\u6DFB\u52A0")])]),(i(!0),v(H,null,L(a(d),(c,D)=>(i(),lt(Rs,{key:c,panel:a(o),state:a(u),enemyState:g,itemState:c,showUp:D>0,showDown:a(d)&&D<a(d).length-1,"onUpdate:itemState":b=>E(b,D),onClose:b=>R(D),onUp:b=>V(D),onDown:b=>I(D),onCopy:b=>q(D)},null,8,["panel","state","enemyState","itemState","showUp","showDown","onUpdate:itemState","onClose","onUp","onDown","onCopy"]))),128))]))}});const on=et(nn,[["__scopeId","data-v-bd82d11d"]]),an=ct({props:{show:Boolean,list:Array,class:String,height:String},emits:["click","close","update:show"],setup(e,{emit:n}){return{wrapClass:tt(()=>["c-action-sheet-wrapper",e.class,{show:e.show}]),onClick:(B,d)=>{n("click",{item:B,index:d}),n("close",!1)},onClose:()=>{n("update:show",!1),n("close",!1)}}}});const un={class:"c-action-sheet-section"},ln={class:"c-action-sheet-extra"},cn={class:"c-action-sheet-list"},dn=["onClick"];function rn(e,n,s,o,u,B){return i(),lt(Nt,{to:"body"},[t("div",{class:mt(e.wrapClass)},[t("div",{class:"c-action-sheet-mask",onClick:n[0]||(n[0]=(...d)=>e.onClose&&e.onClose(...d))}),t("div",un,[t("div",{class:"c-action-sheet-body",style:It({maxHeight:e.height})},[t("div",ln,[nt(e.$slots,"extra")]),t("div",cn,[(i(!0),v(H,null,L(e.list,(d,r)=>(i(),v("div",{class:"c-action-sheet-item",key:r,onClick:g=>e.onClick(d,r)},[nt(e.$slots,"default",{record:d})],8,dn))),128))])],4)])],2)])}const Vt=et(an,[["render",rn]]);Vt.install=e=>{e.component("action-sheet",Vt)};const pn={class:"hero-item"},_n={class:"hero-item__inner"},fn=["src"],vn=["src","alt","title"],hn={class:"hero-item__label"},mn=ct({__name:"HeroSelect",props:{show:{type:Boolean}},emits:["click","update:show"],setup(e,{emit:n}){const{heroes:s,getHeroIcon:o,getHeroIconBg:u}=ce(),B=d=>{n("click",d)};return(d,r)=>(i(),lt(a(Vt),{class:"hero-select",show:e.show,list:a(s),height:"80vh",onClick:B,"onUpdate:show":r[0]||(r[0]=g=>d.$emit("update:show",g))},{extra:F(()=>[nt(d.$slots,"extra")]),default:F(({record:g})=>[t("div",pn,[t("div",_n,[t("img",{src:a(u)(g)},null,8,fn),t("img",{src:a(o)(g),alt:g.name,title:g.name},null,8,vn),t("div",hn,w(g.name),1)])])]),_:3},8,["show","list"]))}});const bn=ct({props:{header:String,activeKey:Boolean},emits:["update:activeKey","toggle"],setup(e,{emit:n}){const s=tt({get:()=>e.activeKey,set:u=>{n("update:activeKey",u)}});return{active:s,toggle:()=>{const u=!s.value;s.value=u,n("toggle",u)}}}});const Fn=e=>(xt("data-v-829ec263"),e=e(),wt(),e),Bn=Fn(()=>t("div",{class:"panel-icon"},[t("svg",{width:"16",height:"16",viewBox:"-16 -16 32 32"},[t("path",{d:"M6 0 l-12 -12 l0 2 l10 10 l-10 10 l0 2 l12 -12z",fill:"currentColor"})])],-1)),$n={class:"panel-title"},yn={class:"panel-body"},Cn={class:"panel-content"};function gn(e,n,s,o,u,B){return i(),v("div",{class:mt(["panel",{active:e.active}])},[t("div",{class:"panel-header",onClick:n[1]||(n[1]=(...d)=>e.toggle&&e.toggle(...d))},[Bn,t("div",$n,[nt(e.$slots,"header",{},()=>[X(w(e.header)+"\xA0",1)],!0)]),t("div",{class:"panel-actions",onClick:n[0]||(n[0]=vt(()=>{},["stop"]))},[nt(e.$slots,"actions",{},void 0,!0)])]),t("div",yn,[t("div",Cn,[nt(e.$slots,"default",{},void 0,!0)])])],2)}const xn=et(bn,[["render",gn],["__scopeId","data-v-829ec263"]]);function wn(){const e="red_team",n=oe(),s=Q([]),o=Q(!1),u=Q(),B=async f=>{const E=(await n.transaction(e,"readwrite")).objectStore(e),k=await n.wrap(E.put(f));return s.value.find(V=>V._id===f._id)||(f._id=k,s.value.push(f)),k},d=async f=>{const E=(await n.transaction(e,"readwrite")).objectStore(e);await n.wrap(E.delete(f._id)),s.value=s.value.filter(k=>k._id!==f._id)},r=async f=>{const _=await n.transaction(e,"readwrite"),E=_.objectStore(e);for(const k of f)await n.wrap(E.put(k));await n.twrap(_),await S()},g=async()=>{const _=(await n.transaction(e,"readwrite")).objectStore(e);await n.wrap(_.clear()),s.value=[]},S=async()=>{const _=(await n.transaction(e,"readonly")).objectStore(e),E=await n.wrap(_.getAll()).catch(()=>[]);E.forEach(k=>{k.scList||(k.scList=[{n:"\u6676\u7CB9\xB7\u9633",pos:J.ATT},{n:"\u6676\u7CB9\xB7\u9633",pos:J.ATT},{n:"\u6676\u7CB9\xB7\u9716",pos:J.XUE},{n:"\u6676\u7CB9\xB7\u9716",pos:J.XUE},{n:"\u6676\u7CB9\xB7\u8679",pos:J.DEF},{n:"\u6676\u7CB9\xB7\u8679",pos:J.DEF}])}),s.value=E},C=async f=>{const _=JSON.parse(await f.text());if(!Lt(_)||_.type!=="red_team"){alert("\u5BFC\u5165\u7684\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E");return}const E=_.data;E.forEach(k=>delete k._id),await r(E)},P=async()=>{const f={type:"red_team",data:s.value},_=new Blob([JSON.stringify(f)],{type:"application/json"});Ut(_,"red_team.json")};return S(),{scShow:o,scSelected:u,put:B,del:d,puts:r,clear:g,all:S,list:s,importData:C,exportData:P}}const Ft=e=>e%1>.5?Math.ceil(e):Math.floor(e);function En(){const e=()=>({name:"",qixue:0,patt:0,pdef:0,matt:0,mdef:0,huixin:0,stoneName:"",hsQixue:0,hsPatt:0,hsPdef:0,hsMatt:0,hsMdef:0,hsHuixin:0,scList:[{n:"\u6676\u7CB9\xB7\u9633",pos:J.ATT},{n:"\u6676\u7CB9\xB7\u9633",pos:J.ATT},{n:"\u6676\u7CB9\xB7\u9716",pos:J.XUE},{n:"\u6676\u7CB9\xB7\u9716",pos:J.XUE},{n:"\u6676\u7CB9\xB7\u8679",pos:J.DEF},{n:"\u6676\u7CB9\xB7\u8679",pos:J.DEF}],cQixue:"40+5+5+5",cPatt:"0",cPdef:"0",cMatt:"0",cMdef:"0",cHuixin:"0",rQixue:0,rPatt:0,rPdef:0,rMatt:0,rMdef:0,rHuixin:0}),n=Q(e()),s=tt(()=>{const d=[0,0,0,0,0,0];return n.value.scList.forEach(r=>{!r.v||(d[0]+=r.v.qixue,d[1]+=r.v.patt,d[2]+=r.v.pdef,d[3]+=r.v.matt,d[4]+=r.v.mdef,d[5]+=r.v.huixin)}),d}),o=tt(()=>{const d=n.value,r={qixue:0,patt:0,pdef:0,matt:0,mdef:0,huixin:0},g=qt.find(P=>d.stoneName===P.name);g&&(r.qixue=g.t[0]+g.d[0]+g.h[0],r.patt=g.t[1]+g.d[1]+g.h[1],r.matt=g.t[2]+g.d[2]+g.h[2],r.pdef=g.t[3]+g.d[3]+g.h[3],r.mdef=g.t[4]+g.d[4]+g.h[4]);const S={qixue:d.hsQixue/100,patt:d.hsPatt/100,pdef:d.hsPdef/100,matt:d.hsMatt/100,mdef:d.hsMdef/100,huixin:d.hsHuixin/100},C=s.value;return{qixue:Ft(d.qixue*S.qixue+r.qixue+C[0]),patt:Ft(d.patt*S.patt+r.patt+C[1]),pdef:Ft(d.pdef*S.pdef+r.pdef+C[2]),matt:Ft(d.matt*S.matt+r.matt+C[3]),mdef:Ft(d.mdef*S.mdef+r.mdef+C[4]),huixin:Ft(d.huixin*S.huixin+r.huixin+C[5])}}),u=tt(()=>{const d=o.value,r={qixue:(100+n.value.rQixue)/100,patt:(100+n.value.rPatt)/100,pdef:(100+n.value.rPdef)/100,matt:(100+n.value.rMatt)/100,mdef:(100+n.value.rMdef)/100,huixin:(100+n.value.rHuixin)/100};return{qixue:Math.round((n.value.qixue+d.qixue)*r.qixue),patt:Math.round((n.value.patt+d.patt)*r.patt),pdef:Math.round((n.value.pdef+d.pdef)*r.pdef),matt:Math.round((n.value.matt+d.matt)*r.matt),mdef:Math.round((n.value.mdef+d.mdef)*r.mdef),huixin:Math.round((n.value.huixin+d.huixin)*r.huixin)}});return{state:n,pValue:o,ckValue:u,scSum:s,reset:()=>{n.value=e()},defState:e}}const kn={},Dn={class:"c-upload"};function An(e,n){return i(),v("div",Dn,[nt(e.$slots,"default",{},void 0,!0),t("input",ae({type:"file",class:"c-upload-input",accept:"application/json"},e.$attrs),null,16)])}const Sn=et(kn,[["render",An],["__scopeId","data-v-b3879154"]]),W=e=>(xt("data-v-fc55a9ed"),e=e(),wt(),e),Mn={class:"transform-tools-popover"},Un={class:"transform-tools-popover-toolbar"},Vn=["value"],In=["value"],Tn=W(()=>t("button",{class:"btn btn-sm btn-success"},"\u5BFC\u5165",-1)),Hn={class:"transform-tools-popover-content"},Pn={class:"grid-group"},Rn={class:"grid-group-item"},Gn={class:"input-group-title"},Nn=W(()=>t("span",null,"\u57FA\u7840",-1)),Ln={class:"grids"},qn={class:"input-label"},jn={class:"input-group"},On={class:"input green"},zn={class:"grid-group-item"},Kn={class:"input-group-title"},Jn=W(()=>t("span",null,"\u9B42\u77F3",-1)),Qn=W(()=>t("option",{value:""},"\u65E0",-1)),Xn=["value"],Wn={class:"grids"},Zn=W(()=>t("label",{class:"input-label"},"\u6C14\u8840%",-1)),Yn=W(()=>t("label",{class:"input-label"},"\u7269\u653B%",-1)),to=W(()=>t("label",{class:"input-label"},"\u7269\u9632%",-1)),eo=W(()=>t("label",{class:"input-label"},"\u6CD5\u653B%",-1)),so=W(()=>t("label",{class:"input-label"},"\u6CD5\u9632%",-1)),no={class:"grid-group-item"},oo={class:"input-group-title"},ao=X(" \u661F\u4E4B\u6676 "),uo=W(()=>t("div",null,"\u6781\u9650\u653B\uFF1A202\u653B\uFF0C198\u8840\uFF0C66\u9632",-1)),lo=W(()=>t("div",null,"\u6781\u9650\u8840\uFF1A456\u8840\uFF0C66\u9632\uFF0C88\u653B",-1)),co=W(()=>t("div",null,"\u6781\u9650\u9632\uFF1A150\u9632\uFF0C198\u8840\uFF0C88\u653B",-1)),io={class:"grids"},ro=["onClick","onContextmenu"],po={key:0},_o={key:1},fo={key:2},vo={key:3},ho={key:4},mo={key:5},bo={key:1},Fo={class:"grid-group-item"},Bo=W(()=>t("div",{class:"input-group-title"},"\u661F\u4E4B\u6676\u5408\u8BA1",-1)),$o={class:"grids"},yo={class:"input-label"},Co={class:"input"},go={class:"grid-group-item"},xo=W(()=>t("div",{class:"input-group-title"},"\u4FEE\u6B63",-1)),wo={class:"grids"},Eo={class:"input-label"},ko={class:"grid-group-item"},Do=W(()=>t("div",{class:"input-group-title"},"\u53C2\u8003",-1)),Ao={class:"grids"},So={class:"input-label"},Mo={class:"input"},Uo=ct({__name:"transform-tools-modal",props:{show:{type:Boolean}},emits:["init","reference","update:show"],setup(e,{emit:n}){const{state:s,pValue:o,ckValue:u,scSum:B,reset:d,defState:r}=En(),{list:g,put:S,del:C,clear:P,importData:f,exportData:_}=wn(),E=[{t:"\u6C14\u8840",n:"qixue"},{t:"\u7269\u653B",n:"patt"},{t:"\u7269\u9632",n:"pdef"},{t:"\u6CD5\u653B",n:"matt"},{t:"\u6CD5\u9632",n:"mdef"},{t:"\u4F1A\u5FC3",n:"huixin"}],k=[{t:"\u6C14\u8840%",c:"cQixue",r:"rQixue"},{t:"\u7269\u653B%",c:"cPatt",r:"rPatt"},{t:"\u7269\u9632%",c:"cPdef",r:"rPdef"},{t:"\u6CD5\u653B%",c:"cMatt",r:"rMatt"},{t:"\u6CD5\u9632%",c:"cMdef",r:"rMdef"},{t:"\u4F1A\u5FC3%",c:"cHuixin",r:"rHuixin"}],R=Q(!1),V=Q(),I=T=>{V.value=T,R.value=!0},q=T=>{!V.value||(V.value.v=T)},M=()=>{const T=Dt.cloneDeep(s.value);S(T).then(y=>{s.value._id=y,alert("\u5DF2\u4FDD\u5B58")}).catch(y=>{console.log(y),alert("\u4FDD\u5B58\u5931\u8D25")})},m=()=>{const T=Dt.cloneDeep(s.value);delete T._id,T.name+=" copy",S(T).then(y=>{T._id=y,s.value=T}).catch(y=>{console.log(y),alert("\u590D\u5236\u5931\u8D25")})},c=()=>{!confirm("\u786E\u8BA4\u8981\u5220\u9664\u5417\uFF1F")||C(s.value).then(()=>{d()}).catch(y=>{console.log(y),alert("\u5220\u9664\u5931\u8D25")})},D=T=>{const y=T.currentTarget;if(!y.files)return;const Y=Array.prototype.slice.call(y.files);y.value="",Y[0]&&f(Y[0])},b=()=>{_()},U=()=>{!confirm("\u662F\u5426\u8981\u6E05\u7A7A\u5168\u90E8\uFF1F")||P().catch(y=>{console.log(y),alert("\u6E05\u7A7A\u5931\u8D25")})},st=(T,y)=>{s.value.name=T,s.value.qixue=y.qixue,s.value.patt=y.patt,s.value.pdef=y.pdef,s.value.matt=y.matt,s.value.mdef=y.mdef,s.value.huixin=y.huixin},it=()=>{n("reference")};return n("init",st),(T,y)=>{const Y=_t("c-col"),j=_t("c-space"),$t=_t("c-row");return O((i(),v("div",Mn,[t("div",Un,[h($t,{flex:"",middle:"",gutter:8},{default:F(()=>[h(Y,null,{default:F(()=>[t("button",{class:"btn btn-sm btn-link",onClick:it},"\u53C2\u8003")]),_:1}),h(Y,null,{default:F(()=>[X("ID: "+w(a(s)._id),1)]),_:1}),h(Y,{flex:"1 1 auto"},{default:F(()=>[h(j,null,{default:F(()=>[O(t("select",{class:"input input-select",placeholder:"\u8BF7\u9009\u62E9\u5DF2\u6709\u6A21\u677F","onUpdate:modelValue":y[0]||(y[0]=p=>Ct(s)?s.value=p:null)},[t("option",{value:a(r)()},"\u7A7A\u6A21\u7248",8,Vn),(i(!0),v(H,null,L(a(g),p=>(i(),v("option",{key:p._id,value:p},w(p.name),9,In))),128))],512),[[Tt,a(s)]]),t("button",{class:"btn btn-sm btn-primary",onClick:M},"\u4FDD\u5B58"),t("button",{class:"btn btn-sm btn-primary",onClick:m},"\u590D\u5236"),a(s)._id?(i(),v("button",{key:0,class:"btn btn-sm btn-danger",onClick:c},"\u5220\u9664")):K("",!0),h(Sn,{onChange:D},{default:F(()=>[Tn]),_:1}),t("button",{class:"btn btn-sm btn-success",onClick:b},"\u5BFC\u51FA"),t("button",{class:"btn btn-sm btn-danger",onClick:U},"\u6E05\u7A7A")]),_:1})]),_:1}),h(Y,null,{default:F(()=>[t("span",{class:"transform-tools-popover-close",onClick:y[1]||(y[1]=p=>n("update:show",!1))}," \xD7 ")]),_:1})]),_:1})]),t("div",Hn,[t("div",Pn,[t("div",Rn,[t("div",Gn,[h(j,null,{default:F(()=>[Nn,O(t("input",{type:"text",class:"input input-text","onUpdate:modelValue":y[2]||(y[2]=p=>a(s).name=p)},null,512),[[ut,a(s).name]])]),_:1})]),t("div",Ln,[(i(),v(H,null,L(E,p=>h(j,{key:p.n},{default:F(()=>[t("label",qn,w(p.t),1),t("div",jn,[h(a(bt),{readonly:"",value:a(s)[p.n]},null,8,["value"]),t("div",On,"+"+w(a(o)[p.n]),1)])]),_:2},1024)),64))])]),t("div",zn,[t("div",Kn,[h(j,null,{default:F(()=>[Jn,O(t("select",{class:"input input-select","onUpdate:modelValue":y[3]||(y[3]=p=>a(s).stoneName=p)},[Qn,(i(!0),v(H,null,L(a(qt),(p,$)=>(i(),v("option",{key:$,value:p.name},w(p.name),9,Xn))),128))],512),[[Tt,a(s).stoneName]])]),_:1})]),t("div",Wn,[h(j,null,{default:F(()=>[Zn,h(a(bt),{value:a(s).hsQixue,"onUpdate:value":y[4]||(y[4]=p=>a(s).hsQixue=p)},null,8,["value"])]),_:1}),h(j,null,{default:F(()=>[Yn,h(a(bt),{value:a(s).hsPatt,"onUpdate:value":y[5]||(y[5]=p=>a(s).hsPatt=p)},null,8,["value"])]),_:1}),h(j,null,{default:F(()=>[to,h(a(bt),{value:a(s).hsPdef,"onUpdate:value":y[6]||(y[6]=p=>a(s).hsPdef=p)},null,8,["value"])]),_:1}),h(j,null,{default:F(()=>[eo,h(a(bt),{value:a(s).hsMatt,"onUpdate:value":y[7]||(y[7]=p=>a(s).hsMatt=p)},null,8,["value"])]),_:1}),h(j,null,{default:F(()=>[so,h(a(bt),{value:a(s).hsMdef,"onUpdate:value":y[8]||(y[8]=p=>a(s).hsMdef=p)},null,8,["value"])]),_:1})])]),t("div",no,[t("div",oo,[ao,h(a(pt),{label:"?",inline:"",dir:"right"},{default:F(()=>[uo,lo,co]),_:1})]),t("div",io,[(i(!0),v(H,null,L(a(s).scList,(p,$)=>(i(),v("div",{key:$,class:mt(["sc-props",{selected:V.value===p,s1:a(J).ATT===p.pos,s2:a(J).XUE===p.pos,s3:a(J).DEF===p.pos}]),onClick:l=>I(p),onContextmenu:vt(l=>p.v=void 0,["prevent"])},[p.v?(i(),v(H,{key:0},[p.v.qixue>0?(i(),v("span",po,"\u6C14\u8840+"+w(p.v.qixue),1)):K("",!0),p.v.patt>0?(i(),v("span",_o,"\u7269\u653B+"+w(p.v.patt),1)):K("",!0),p.v.pdef>0?(i(),v("span",fo,"\u7269\u9632+"+w(p.v.pdef),1)):K("",!0),p.v.matt>0?(i(),v("span",vo,"\u6CD5\u653B+"+w(p.v.matt),1)):K("",!0),p.v.mdef>0?(i(),v("span",ho,"\u6CD5\u9632+"+w(p.v.mdef),1)):K("",!0),p.v.huixin>0?(i(),v("span",mo,"\u4F1A\u5FC3+"+w(p.v.huixin),1)):K("",!0)],64)):(i(),v("span",bo,w(p.n),1))],42,ro))),128))]),(i(),lt(Nt,{to:"body"},[V.value?(i(),lt(a(pe),{key:0,show:R.value,"onUpdate:show":y[9]||(y[9]=p=>R.value=p),position:V.value.pos,dir:"left",overlayStyle:"width:360px",onSelect:q},null,8,["show","position"])):K("",!0)]))]),t("div",Fo,[Bo,t("div",$o,[(i(),v(H,null,L(E,(p,$)=>h(j,{key:$},{default:F(()=>[t("label",yo,w(p.t),1),t("div",Co,"+"+w(a(B)[$]),1)]),_:2},1024)),64))])]),t("div",go,[xo,t("div",wo,[(i(),v(H,null,L(k,(p,$)=>h(j,{key:$},{default:F(()=>[t("label",Eo,w(p.t),1),h(a(gt),{modelValue:a(s)[p.c],"onUpdate:modelValue":l=>a(s)[p.c]=l,result:a(s)[p.r],"onUpdate:result":l=>a(s)[p.r]=l},null,8,["modelValue","onUpdate:modelValue","result","onUpdate:result"])]),_:2},1024)),64))])]),t("div",ko,[Do,t("div",Ao,[(i(),v(H,null,L(E,p=>h(j,{key:p.n},{default:F(()=>[t("label",So,w(p.t),1),t("div",Mo,w(a(u)[p.n]),1)]),_:2},1024)),64))])])])])],512)),[[ue,e.show]])}}});const Vo=et(Uo,[["__scopeId","data-v-fc55a9ed"]]);function ft(e){return(e%1>.5?Math.ceil:Math.floor)(e)}function Jt(e){const{basic:n,enemyState:s}=e,o={w:n.w,a:N(n.a),c:n.c,x:n.x,g:0,att:0};o.g=ft(n.w*n.c/100+o.a+o.x),o.att=n.w+o.g;const u={hp:N(s.hp),ra:N(s.ra),rb:N(s.rb),def:N(s.def),defExt:N(s.defExt),defGain:N(s.defGain)};return{b:o,e:u}}function Io(e,n){const{b:s,e:o}=Jt(e),u={a1:n.a1,a2:n.a2,att:N(n.att),att2:N(n.att2),da:N(n.da),da2:N(n.da2),db:N(n.db),dc:N(n.dc),dx:N(n.dx),dx2:N(n.dx2),id:N(n.id),cd:N(n.cd),defGain:N(n.defGain),kz:n.kz||0},B=s.att*(100+u.att)/100,d=s.att*(100+u.att+u.att2)/100,r=(100+u.kz)/100,g=(100+u.da-o.ra)/100,S=(100+u.da+u.da2-o.ra)/100,C=(100+u.db-o.rb)/100,P=(100+u.dc)/100,f=(100+u.dx)/100,_=(100+u.dx+u.dx2)/100,E=(100+u.cd)/100,k=(100-u.id)/100,R=(100+o.defGain)/100,V=(100+o.defGain+u.defGain)/100,I=Math.max(0,Math.max(0,o.def*R+o.defExt)*k),q=Math.max(0,Math.max(0,o.def*V+o.defExt)*k),M=Math.max(1,B*r-I),m=Math.max(1,d*r-q),c=M*u.a1*g*C*f,D=ft(c*E),b=m*u.a2*S*C*P*_,U=ft(b*E);return{satt:B,satt2:d,r01:ft(c),r01c:D,r02:ft(b),r02c:U}}function To(e){const n=e.items||[],s=document.createElement("canvas");s.width=800,s.height=8+160+n.reduce((_,E)=>{let k=30;return k+=50,E.a1>0&&(k+=30),E.a2>0&&(k+=50),(E.a1>0||E.a2>0)&&(k+=20),E.a1>0&&E.a2>0&&(k+=20),k+=20,_+k},0)+8;const o=s.getContext("2d");if(!o)return;const u=e.basic,B=e.enemyState,{b:d}=Jt(e),r={x:0,y:0},g=(_,E,k)=>{k?(r.x+=_,r.y+=E):(r.x=_,r.y=E)},S=(_=0)=>{r.x=8+_*16},C=(_=0)=>{r.x=8,r.y+=_},P=(_,E="#222222")=>{o.save(),o.fillStyle=E;const{width:k}=o.measureText(_);o.fillText(_,r.x,r.y),r.x+=k+16,o.restore()},f=(_,...E)=>{o.save();const k=typeof _=="string"?_:_[0],R=typeof _=="string"?"#222222":_[1];o.fillStyle=R,o.font="bold 16px sans-serif";const{width:V}=o.measureText(k);o.fillText(k,r.x,r.y),r.x+=V+8,o.restore(),o.save(),o.font="16px sans-serif";for(const I of E){const q=typeof I=="string"?I:I[0],M=typeof I=="string"?"#ff4446":I[1];o.fillStyle=M;const{width:m}=o.measureText(q);o.fillText(q,r.x,r.y),r.x+=m+8}r.x+=8,o.restore()};o.fillStyle="#FBFFF0",o.fillRect(0,0,s.width,s.height),g(8,28),o.textBaseline="bottom",o.font="bold 20px sans-serif",P(e.title),C(40),o.font="bold 18px sans-serif",P("\u653B\u65B9:"),o.font="16px sans-serif",C(30),S(2),f("\u653B\u51FB:",`${u.w}`,[`+${d.g}`,"#55a14f"]),f("\u9B42\u77F3\u653B\u51FB:",`${u.a}`),f("\u9B42\u77F3\u653B\u51FB%:",`${u.c}`),f("\u661F\u4E4B\u6676\u653B\u51FB:",`${u.x}`),C(30),o.font="bold 18px sans-serif",P("\u5B88\u65B9:"),C(30),S(2),f("\u6C14\u8840:",`${B.hp}`),f("\u9632\u5FA1:",`${B.def}`),f("\u9632\u5FA1%:",`${B.defGain}`),f("\u9644\u52A0\u9632\u5FA1:",`${B.defExt}`),C(20),S(2),f("\u514D\u4F24A%:",`${B.ra}`),f("\u514D\u4F24B%:",`${B.rb}`),C(30);for(const _ of n){const{satt:E,satt2:k,r01:R,r01c:V,r02:I,r02c:q}=Io(e,_);o.font="bold 18px sans-serif",P(_.name,"#a30000"),o.font="14px sans-serif",P(_.desc||"\u65E0\u63CF\u8FF0","#a30000"),o.font="16px sans-serif",f("\u514B\u5236:",`${_.kz||0}%`),C(30),S(2),f("\u653B\u51FB%:",`${_.att}`),f("\u7A7F\u900F%:",`${_.id}`),f("\u66B4\u4F24%:",`${_.cd}`),C(20),S(2),f("\u589E\u4F24A%:",`${_.da}`),f("\u589E\u4F24B%:",`${_.db}`),f("\u589E\u4F24X%:",`${_.dx}`),C(30),_.a1>0&&(S(2),f("\u6280\u80FD\u3001\u666E\u653B:",`${_.a1}\u500D`),f("\u653B\u51FB:",[`${ft(E)}`,"#b8860b"]),C(30)),_.a2>0&&(S(2),f("\u8FDE\u51FB\u3001\u8FFD\u51FB\u3001\u53CD\u51FB:",`${_.a2}\u500D`),f("\u653B\u51FB\u4FEE\u6B63%:",_.att2),f("\u9632\u5FA1\u4FEE\u6B63%:",_.defGain),f("\u653B\u51FB:",[`${ft(k)}`,"#b8860b"]),C(20),S(2),f("\u589E\u4F24C%:",_.dc),f("\u589E\u4F24A\u4FEE\u6B63%:",_.da2),f("\u589E\u4F24X\u4FEE\u6B63%:",_.dx2),C(30)),S(2),R>0&&f(["\u6280\u80FD\u3001\u666E\u653B\u4F24\u5BB3","#b8860b"],["\u66B4\u51FB","#ff4446"],[`${R}`,"#b8860b"],[`${V}`,"#ff4446"]),I>0&&f(["\u8FDE\u51FB\u3001\u8FFD\u51FB\u3001\u53CD\u51FB\u4F24\u5BB3","#b8860b"],["\u66B4\u51FB","#ff4446"],[`${I}`,"#b8860b"],[`${q}`,"#ff4446"]),C(20),R>0&&I>0&&(S(2),f(["\u4E0D\u66B4\u51FB","#b8860b"],[`${R+I}`,"#ff4446"]),f(["\u4EC5\u4E00\u6BB5\u66B4\u51FB","#b8860b"],[`${V+I}`,"#ff4446"]),f(["\u4EC5\u4E8C\u6BB5\u66B4\u51FB","#b8860b"],[`${R+q}`,"#ff4446"]),f(["\u5168\u66B4\u51FB","#b8860b"],[`${V+q}`,"#ff4446"]),C(20)),C(20)}s.toBlob(_=>{!_||window.open(URL.createObjectURL(_))})}function Ho(){return{exportImage:To}}const Bt=e=>(xt("data-v-2cc2cbb6"),e=e(),wt(),e),Po={class:"wrapper"},Ro={class:"toolbar"},Go={style:{padding:"6px 16px"}},No=X("\u4F24\u5BB3\u8BA1\u7B97\u5668"),Lo={class:"c-upload"},qo=Bt(()=>t("button",{class:"btn btn-success"},"\u5BFC\u5165",-1)),jo={style:{padding:"6px 16px"}},Oo={class:"input-group"},zo=Bt(()=>t("div",{class:"input-ext"},"=",-1)),Ko={class:"content"},Jo={class:"container"},Qo=["value"],Xo=X(" \u2007 "),Wo=["onKeypress"],Zo={key:1},Yo=["onClick"],ta=["onClick"],ea=["onClick"],sa=X(" \u91CD\u547D\u540D "),na=["onClick"],oa=X(" \u590D\u5236 "),aa=["onClick"],ua=["onClick"],la=["onClick"],ca={style:{"text-align":"center"}},ia=Bt(()=>t("span",null,"\u661F\u8000",-1)),da=Bt(()=>t("span",null,"\u5316\u81FB",-1)),ra=Bt(()=>t("span",null,"\u661F\u9B42",-1)),pa=Bt(()=>t("span",null,"\u661F\u8F89",-1)),_a=ct({__name:"Calculator",setup(e){const{exportImage:n}=Ho(),s=ht({id:"",title:"",selecteds:[],search:""}),o=Q([]),u=tt(()=>o.value.filter($=>$.title.indexOf(s.search)>-1)),B=async()=>{const l={id:Pt(),title:"\u6A21\u677F",basic:Pe(),state:Ge(),enemyState:qe(),items:Le()};await Ve(l),o.value.push(l)},d=async $=>{if(!confirm("\u786E\u8BA4\u8981\u5220\u9664\u5417\uFF1F"))return;const A=o.value.findIndex(G=>G.id===$);A!==-1&&(await Ie(o.value[A].id),o.value.splice(A,1))},r=async $=>{const l=s.title;if(!l){g();return}const A=o.value.findIndex(Z=>Z.id===$);if(A===-1)return;const G=o.value[A];G.title=l,g(),await kt(G)},g=()=>{s.id="",s.title=""},S=$=>{try{n($)}catch{alert("\u5BFC\u51FA\u5931\u8D25\uFF0C\u6570\u636E\u5B58\u5728\u9519\u8BEF")}},C=$=>{const l={type:"calculator",data:[$]},A=new Blob([JSON.stringify(l)],{type:"application/json"});Ut(A,`${$.title}.json`)},P=async $=>{o.value=$},f=$=>new Promise((l,A)=>{const G=new FileReader;G.onload=()=>{l(G.result)},G.onerror=()=>{A(G.error)},G.readAsText($)}),_=async()=>{if(!confirm("\u786E\u8BA4\u8981\u6E05\u7A7A\u6240\u6709\u6570\u636E\u5417\uFF1F"))return;let l=u.value;s.selecteds.length>0&&(l=s.selecteds.map(A=>u.value[A]).filter(A=>A)),await He(l.map(A=>A.id)),p()},E=async $=>{const l=$.currentTarget,A=Array.prototype.slice.call(l.files);if(l.value="",!A||!A[0])return;const G=A[0],Z=await f(G),at=JSON.parse(Z);let dt=[];if(re(at))dt=at;else if(Lt(at)&&at.type==="calculator")dt=at.data;else{alert("\u5BFC\u5165\u7684\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E");return}await Te(dt),p()},k=async()=>{let $="calculator.json",l=u.value;s.selecteds.length>0&&(l=s.selecteds.map(Z=>u.value[Z]).filter(Z=>Z),$="calculator-selected.json");const A={type:"calculator",data:l},G=new Blob([JSON.stringify(A)],{type:"application/json"});Ut(G,$)};async function R($,l){const A=o.value.findIndex(Z=>Z.id===l);A===-1||!o.value[A]||(o.value[A]=$,await kt($))}const V=Q(-1),I=ht({input:"2283/1.35*1.39",result:0}),{translate:q,xingyao:M,huazhen:m,xinghun:c,xinghui:D}=de(),b=$=>Math.ceil($),U=ht({show:!1}),st=$=>{const l=q($);it.value&&it.value($.name,l)},it=Q(),T=Q(!1),y=Q(),Y=$=>{T.value=!0,y.value=$},j=({item:$})=>{if(T.value=!1,y.value){const l=y.value,A=q($);l.title==="\u6A21\u677F"&&(l.title=$.name),l.basic.w=Math.max(A.patt,A.matt),kt(l)}else st($)},$t=$=>{const l=Dt.cloneDeep($);l.id=Pt(),console.log(l),o.value.push(l),kt(l)};async function p(){const $=await Ue();s.selecteds=[],P($)}return le(()=>{p()}),($,l)=>{const A=_t("c-col"),G=_t("c-row"),Z=_t("calc-input"),at=_t("c-space"),dt=Gt("autofocus");return i(),v("div",Po,[t("div",Ro,[t("div",Go,[h(G,{flex:"",middle:"",gutter:16},{default:F(()=>[h(A,{flex:"0 0 auto"},{default:F(()=>[No]),_:1}),h(A,{flex:"0 0 auto"},{default:F(()=>[t("button",{class:"btn btn-sm btn-link",onClick:l[0]||(l[0]=x=>U.show=!U.show)},"\u9762\u677F"),s.selecteds.length>0?(i(),v("button",{key:0,class:"btn btn-success",onClick:l[1]||(l[1]=x=>s.selecteds=[])}," \u53D6\u6D88\u6240\u9009 ")):K("",!0)]),_:1}),h(A,{flex:"1 1 0"},{default:F(()=>[O(t("input",{type:"text",class:"input",placeholder:"\u540D\u79F0\u8FC7\u6EE4","onUpdate:modelValue":l[2]||(l[2]=x=>s.search=x)},null,512),[[ut,s.search]])]),_:1}),h(A,{flex:"0 0 auto"},{default:F(()=>[t("button",{class:"btn btn-danger",onClick:_},w(s.selecteds.length>0?"\u5220\u9664\u6240\u9009":"\u6E05\u7A7A"),1),t("div",Lo,[qo,t("input",{type:"file",class:"c-upload-input",accept:"application/json",onInput:E},null,32)]),t("button",{class:"btn btn-success",onClick:k},w(s.selecteds.length>0?"\u5BFC\u51FA\u6240\u9009":"\u5BFC\u51FA"),1),t("button",{class:"btn btn-primary",onClick:l[3]||(l[3]=x=>B())},"\u6DFB\u52A0")]),_:1})]),_:1}),h(Vo,{show:U.show,"onUpdate:show":l[4]||(l[4]=x=>U.show=x),onReference:l[5]||(l[5]=x=>Y()),onInit:l[6]||(l[6]=x=>it.value=x)},null,8,["show"])]),t("div",jo,[t("div",Oo,[h(Z,{modelValue:I.input,"onUpdate:modelValue":l[7]||(l[7]=x=>I.input=x),result:I.result,"onUpdate:result":l[8]||(l[8]=x=>I.result=x),style:{flex:"3 3 0"}},null,8,["modelValue","result"]),zo,h(ie,{readonly:"",value:b(I.result),style:{flex:"2 2 0"}},null,8,["value"])])])]),t("div",Ko,[t("div",Jo,[(i(!0),v(H,null,L(a(u),(x,Et)=>(i(),lt(a(xn),{key:x.id,activeKey:Et===V.value,onToggle:z=>V.value=z?Et:-1},{header:F(()=>[h(G,{flex:"",middle:""},{default:F(()=>[h(A,null,{default:F(()=>[O(t("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":l[9]||(l[9]=z=>s.selecteds=z),value:Et,onClick:l[10]||(l[10]=vt(()=>{},["stop"]))},null,8,Qo),[[yt,s.selecteds]]),Xo]),_:2},1024),h(A,null,{default:F(()=>[s.id===x.id?O((i(),v("input",{key:0,type:"text",class:"input","onUpdate:modelValue":l[11]||(l[11]=z=>s.title=z),onClick:l[12]||(l[12]=vt(()=>{},["stop"])),onKeypress:Mt(z=>r(x.id),["enter"])},null,40,Wo)),[[ut,s.title],[dt]]):(i(),v("span",Zo,w(x.title),1))]),_:2},1024),h(A,{class:"ml-4",onClick:l[13]||(l[13]=vt(()=>{},["stop"]))},{default:F(()=>[s.id===x.id?(i(),v("button",{key:0,class:"btn btn-sm btn-link",onClick:z=>r(x.id)},"\u786E\u8BA4",8,Yo)):(i(),v(H,{key:1},[t("button",{class:"btn btn-sm btn-link",onClick:z=>Y(x)},"\u9009\u62E9",8,ta),t("button",{class:"btn btn-sm btn-link",onClick:z=>{s.id=x.id,s.title=x.title}},[h(a(Se),{class:"svg-icon"}),sa],8,ea),t("button",{class:"btn btn-sm btn-link",onClick:z=>$t(x)},[h(a(jt),{class:"svg-icon"}),oa],8,na)],64))]),_:2},1024)]),_:2},1024)]),actions:F(()=>[t("button",{class:"btn btn-sm btn-success-outline",onClick:z=>S(x)},"\u5BFC\u51FA\u56FE\u50CF",8,aa),t("button",{class:"btn btn-sm btn-success-outline",onClick:z=>C(x)},"\u5BFC\u51FA",8,ua),t("button",{class:"btn btn-sm btn-danger-outline",onClick:z=>d(x.id)},"\u5220\u9664",8,la)]),default:F(()=>[Et===V.value?(i(),lt(a(on),{key:0,data:x,"onUpdate:data":z=>R(z,x.id)},null,8,["data","onUpdate:data"])):K("",!0)]),_:2},1032,["activeKey","onToggle"]))),128))])]),h(a(mn),{show:T.value,"onUpdate:show":l[18]||(l[18]=x=>T.value=x),onClick:j},{extra:F(()=>[t("div",ca,[h(at,null,{default:F(()=>[t("label",null,[ia,O(t("input",{type:"checkbox","onUpdate:modelValue":l[14]||(l[14]=x=>Ct(M)?M.value=x:null)},null,512),[[yt,a(M)]])]),t("label",null,[da,O(t("input",{type:"checkbox","onUpdate:modelValue":l[15]||(l[15]=x=>Ct(m)?m.value=x:null)},null,512),[[yt,a(m)]])]),t("label",null,[ra,O(t("input",{type:"checkbox","onUpdate:modelValue":l[16]||(l[16]=x=>Ct(c)?c.value=x:null)},null,512),[[yt,a(c)]])]),t("label",null,[pa,O(t("input",{type:"checkbox","onUpdate:modelValue":l[17]||(l[17]=x=>Ct(D)?D.value=x:null)},null,512),[[yt,a(D)]])])]),_:1})])]),_:1},8,["show"])])}}});const $a=et(_a,[["__scopeId","data-v-2cc2cbb6"]]);export{$a as default};
