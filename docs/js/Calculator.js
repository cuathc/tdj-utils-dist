import{_ as nt,J as Wt,o as r,c as v,f as t,K as Zt,L as Yt,M as te,N as ct,d as ht,r as K,O as qt,H as $t,g as E,P as Et,G as Tt,b as vt,t as ee,a as tt,e as f,w as h,u,k as X,Q as se,h as L,z as ot,R as Ut,S as ne,F as T,j as G,U as ue,x as Z,V as xt,W as Gt,p as Dt,m as jt,D as lt,T as Nt,I as oe,n as ae,X as le,q as Ct,v as Ht,A as _t,E as wt,l as bt,Y as z,Z as ie,i as yt}from"./index.js";import{D as zt,u as ce}from"./useHeroes.js";import{_ as kt}from"./lodash.js";import{C as de}from"./CollapsePanel.js";import St from"./InputNumber.js";import{b as Lt,d as Vt,a as re,i as pe}from"./shared.js";import{S as W,a as _e}from"./star-crystals.js";import{s as Ot}from"./data.js";const fe=["width","height"],ve=t("path",{d:"M16 3 l-14 14 l0 6 l14 -14 l14 14 l0 -6 l-14 -14 z"},null,-1),he=[ve];function me(s,n,a,e,c,$){return r(),v("svg",{width:s.width,height:s.height,viewBox:"0 0 32 32"},he,8,fe)}const Fe=nt(Wt,[["render",me]]),Be=["width","height"],be=t("path",{d:"M16 27 l-14 -14 l0 -6 l14 14 l14 -14 l0 6 l-14 14 z"},null,-1),$e=[be];function xe(s,n,a,e,c,$){return r(),v("svg",{width:s.width,height:s.height,viewBox:"0 0 32 32"},$e,8,Be)}const ye=nt(Zt,[["render",xe]]),Ce=["width","height"],ge=t("path",{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"},null,-1),we=[ge];function Ee(s,n,a,e,c,$){return r(),v("svg",{width:s.width,height:s.height,viewBox:"0 0 24 24"},we,8,Ce)}const Kt=nt(Yt,[["render",Ee]]),ke=["width","height"],De=t("path",{d:"M18 12.13V10H20V10.3C19.78 10.42 19.57 10.56 19.39 10.74L18 12.13M9.5 11C9.22 11 9 11.22 9 11.5V13H15V11.5C15 11.22 14.78 11 14.5 11H9.5M6 10H4V21H11V19.13L11.13 19H6V10M21 9H3V3H21V9M19 5H5V7H19V5M13 19.96V22H15.04L21.17 15.88L19.13 13.83L13 19.96M22.85 13.47L21.53 12.15C21.33 11.95 21 11.95 20.81 12.15L19.83 13.13L21.87 15.17L22.85 14.19C23.05 14 23.05 13.67 22.85 13.47Z"},null,-1),je=[De];function Ae(s,n,a,e,c,$){return r(),v("svg",{width:s.width,height:s.height,viewBox:"0 0 24 24"},je,8,ke)}const Se=nt(te,[["render",Ae]]);let Mt=0,Jt=0;const Me=500;function Pt(){const s=Math.floor(new Date().getTime()/1e3);Jt===s?Mt++:Mt=0,Jt=s;const n=s.toString(16);return`${(Me<<16|Mt&255).toString(16)}.${n}`}async function Ue(){try{return await ct.getAll("calculator")}catch{return[]}}async function Ve(s){try{await ct.add("calculator",JSON.parse(JSON.stringify(s)))}catch(n){n instanceof Error?console.log(n.message):console.log(n)}}async function gt(s){try{await ct.put("calculator",JSON.parse(JSON.stringify(s)))}catch(n){n instanceof Error?console.log(n.message):console.log(n)}}async function Ie(s){try{await ct.delete("calculator",s)}catch(n){n instanceof Error?console.log(n.message):console.log(n)}}async function Te(s){try{const e=(await ct.connect()).transaction("calculator","readwrite").objectStore("calculator");for(const c of s)await ct.wrap(e.put(c))}catch(n){n instanceof Error?console.log(n.message):console.log(n)}}async function He(s){try{const e=(await ct.connect()).transaction("calculator","readwrite").objectStore("calculator");for(const c of s)await ct.wrap(e.delete(c))}catch(n){n instanceof Error?console.log(n.message):console.log(n)}}function Je(){return{w:2438,g:0,a:"403+363",c:20,x:0,j:0}}function Pe(){return{a:0}}function Re(){return{att:0}}function Qt(){return{name:"1.5\u6280\u80FD",desc:"",a1:1.5,a2:0,att:"15+10+8",da:"10+10",db:"4+10+20",dc:"0",dx:"0",id:"0",cd:"30",ea:0,att2:"0",da2:"0",dx2:"0",defGain:"0",kz:0}}function qe(){return{a1:1.5,a2:0,att:0,id:0,da:0,db:0,dc:0,dx:0,cd:0,att2:0,da2:0,dx2:0,defGain:0}}function Ge(){return[Qt()]}function Ne(){return{hp:"10000",def:"1872",defExt:"0",defGain:"15+5",ra:"0",rb:"4+10"}}const ze=ht({props:{active:Boolean,label:String,dir:String,inline:Boolean,color:String,wait:{type:Number,default:500}},emits:["update:active"],setup(s,{emit:n}){const a=K(),e=K({}),c=K(s.active),$=()=>{const x=a.value.getBoundingClientRect();switch(c.value=!0,n("update:active",c.value),s.dir){case"left":e.value={top:`${x.top+x.height/2}px`,right:`${window.innerWidth-x.left-4}px`,maxWidth:"100%"};break;case"right":e.value={top:`${x.top+x.height/2}px`,left:`${x.right+4}px`,maxWidth:"100%"};break;case"top":e.value={bottom:`${window.innerHeight-x.top-4}px`,left:`${x.left+x.width/2}px`,maxWidth:"100%"};break;default:e.value={top:`${x.bottom+4}px`,left:`${x.left+x.width/2}px`,maxWidth:"100%"}}};let l;const d=()=>{l=window.setTimeout($,s.wait)},D=()=>{clearTimeout(l),c.value=!1,n("update:active",c.value)};return qt(()=>s.active,w=>{c.value=w}),{el:a,style:e,tActive:c,onEnter:d,onOut:D}}});const Le={class:"c-tooltip-label"};function Oe(s,n,a,e,c,$){return r(),v("div",{ref:"el",class:Et(["c-tooltip",{active:s.tActive,inline:s.inline}]),onMouseenter:n[0]||(n[0]=(...l)=>s.onEnter&&s.onEnter(...l)),onMouseout:n[1]||(n[1]=(...l)=>s.onOut&&s.onOut(...l))},[$t(s.$slots,"label",{},()=>[t("div",Le,E(s.label),1)]),t("div",{class:Et(["c-tooltip-inner",s.dir?`c-tooltip-${s.dir}`:"c-tooltip-bottom",s.color?`c-tooltip-${s.color}`:""]),style:Tt(s.style)},[$t(s.$slots,"default")],6)],34)}const it=nt(ze,[["render",Oe]]),st=s=>(Dt("data-v-2040a7c5"),s=s(),jt(),s),Ke=["onKeypress"],Qe=["onKeypress"],Xe=st(()=>t("div",{class:"label"},"\u514B\u5236%",-1)),We=Z(" \u514B\u523630%"),Ze=st(()=>t("br",null,null,-1)),Ye=Z("\u88AB\u514B\u5236-25%"),ts=st(()=>t("br",null,null,-1)),es=Z("\u6FC0\u836150% "),ss=["onClick"],ns=["onClick"],us={class:"row"},os={class:"col-item"},as=st(()=>t("div",{class:"label"},"\u6280\u80FD\u3001\u666E\u653B",-1)),ls=Z(" \u6280\u80FD\u3001\u666E\u653B\u500D\u7387 "),is={class:"input-group"},cs=["step"],ds=st(()=>t("div",{class:"input-ext"},"\u500D",-1)),rs={class:"label"},ps={class:"input-group"},_s={class:"col-item"},fs=st(()=>t("div",{class:"label"},"\u989D\u5916\u653B\u51FB",-1)),vs=Z(" \u9632\u8F6C\u653B\u8FD9\u7C7B\u4EA7\u751F\u7684\u989D\u5916\u653B\u51FB "),hs={class:"input-group"},ms=st(()=>t("div",{style:{clear:"both"}},null,-1)),Fs={class:"col-item"},Bs=st(()=>t("div",{class:"label"},"\u8FDE\u51FB\u3001\u8FFD\u51FB\u3001\u53CD\u51FB",-1)),bs=Z(" \u8FDE\u51FB\u3001\u8FFD\u51FB\u3001\u53CD\u51FB\u500D\u7387 "),$s={class:"input-group"},xs=["step"],ys=st(()=>t("div",{class:"input-ext"},"\u500D",-1)),Cs={class:"label"},gs={class:"input-group"},ws={class:"col-item"},Es=st(()=>t("div",{class:"label"},"\u6700\u7EC8\u653B\u51FB",-1)),ks={class:"static-control text-center"},Ds={class:"darkgold"},js=st(()=>t("div",{style:{clear:"both"}},null,-1)),As={class:"label"},Ss={class:"bold darkgold"},Ms=st(()=>t("span",{class:"bold red"},"(\u66B4\u51FB)",-1)),Us={class:"static-control text-center"},Vs={class:"bold darkgold"},Is={class:"bold red"},Ts={class:"label bold"},Hs={class:"static-control text-center"},Js={class:"bold darkgold"},Ps={key:0,class:"bold red"},Rs=ht({__name:"CalcItem",props:{panel:null,state:null,enemyState:null,itemState:null,showUp:{type:Boolean},showDown:{type:Boolean}},emits:["close","up","down","copy","update:itemState"],setup(s,{emit:n}){const a=s,e=K(!1),c=vt({editor:!1,name:"",desc:{f:!1,v:""}}),$=vt(qe()),l=ee(a,"itemState"),d=()=>{n("update:itemState",l.value)},D=[{name:"att",label:"\u653B\u51FB%",tip:"\u4F5C\u7528\u4E8E\u6240\u6709\u60C5\u51B5"},{name:"da",label:"A\u7C7B\u589E\u4F24%",tip:"\u9970\u54C1\u3001\u5404\u7C7Bbuff\u3001\u5929\u8D4B"},{name:"db",label:"B\u7C7B\u589E\u4F24%",tip:"\u661F\u8000\u3001\u661F\u76D8\u3001\u8BCD\u6761"},{name:"dx",label:"X\u7C7B\u589E\u4F24%",tip:"\u6700\u7EC8\u4FEE\u6B63\uFF0C\u5982\u4E00\u5B57\u7535\u65A9"},{name:"id",label:"\u7A7F\u900F%",tip:"\u65E0\u89C6\u9632\u5FA1"},{name:"cd",label:"\u66B4\u4F24%",tip:"\u66B4\u51FB\u4F24\u5BB3"}],w=[{name:"dc",label:"C\u7C7B\u589E\u4F24%",tip:"\u8FDE\u51FB\u3001\u8FFD\u51FB\u3001\u53CD\u51FB\u589E\u4F24"},{name:"att2",label:"\u653B\u51FB\u4FEE\u6B63%",tip:"\u6389\u8840\u540E\u653B\u51FB\u4FEE\u6B63\uFF0C\u4E00\u822C\u5728\u8FFD\u51FB\u6216\u53CD\u51FB\u65F6"},{name:"da2",label:"\u4F24\u5BB3\u4FEE\u6B63%",tip:"\u6389\u8840\u540E\u4F24\u5BB3\u4FEE\u6B63\uFF0C\u4E00\u822C\u5728\u8FFD\u51FB\u6216\u53CD\u51FB\u65F6"},{name:"defGain",label:"\u9632\u5FA1\u4FEE\u6B63%",tip:"\u6389\u8840\u540E\u9632\u5FA1\u4FEE\u6B63\uFF0C\u4E00\u822C\u5728\u8FFD\u51FB\u6216\u8FDE\u51FB\u65F6"},{name:"dx2",label:"X\u7C7B\u4FEE\u6B63%",tip:"\u6389\u8840\u540E\u6700\u7EC8\u4F24\u5BB3\u4FEE\u6B63\uFF0C\u4E00\u822C\u5728\u8FFD\u51FB\u6216\u8FDE\u51FB\u65F6"}],x=tt(()=>l.value.ea||0),P=tt(()=>{const{state:B}=a,g=(100+$.att)/100;return Math.ceil(B.att*g+x.value)}),_=tt(()=>{const{state:B}=a,g=(100+$.att+$.att2)/100;return Math.ceil(B.att*g+x.value)}),p=()=>{const{enemyState:B}=a,g=l.value,et=(100+g.kz)/100,b=(100+$.da-B.ra)/100,I=(100+$.da+$.da2-B.ra)/100,Y=(100+$.db-B.rb)/100,at=(100+$.dc)/100,rt=(100+$.dx)/100,mt=(100+$.dx+$.dx2)/100,U=(100+$.cd)/100,m=(100-$.id)/100,q=(100+B.defGain)/100,F=(100+B.defGain+$.defGain)/100,i=Math.max(0,Math.max(0,B.def*q+B.defExt)*m),o=Math.max(0,Math.max(0,B.def*F+B.defExt)*m),M=Math.max(1,P.value*et-i),J=Math.max(1,_.value*et-o),ut=M*g.a1*b*Y*rt,pt=Math.ceil(ut*U),C=J*g.a2*I*Y*at*mt,Ft=Math.ceil(C*U);return{r01:Math.ceil(ut),r01c:pt,r02:Math.ceil(C),r02c:Ft}},j=tt(()=>p());function k(){confirm(`\u786E\u8BA4\u8981\u5220\u9664\u6280\u80FD\u6A21\u677F"${a.itemState.name}"\u5417\uFF1F`)&&n("close")}function N(){c.editor=!0,c.name=a.itemState.name}function R(){const B=c.name;if(c.editor=!1,c.name="",!B)return;const g=a.itemState;g.name=B,n("update:itemState",g)}function V(){c.desc.f=!0,c.desc.v=a.itemState.desc}function H(){const B=c.desc.v;if(c.desc.f=!1,c.desc.v="",!B)return;const g=a.itemState;g.desc=B,n("update:itemState",g)}function A(){n("up")}function S(){n("down")}function y(){n("copy")}return(B,g)=>{const et=Gt("autofocus");return r(),v(T,null,[f(u(ue),{orientation:"left"},{action:h(()=>[t("span",{onClick:y},[f(u(Kt),{class:"close"})]),s.showUp?(r(),v("span",{key:0,onClick:A},[f(u(Fe),{class:"close"})])):X("",!0),s.showDown?(r(),v("span",{key:1,onClick:S},[f(u(ye),{class:"close"})])):X("",!0),t("span",{onClick:k},[f(u(se),{class:"close"})])]),default:h(()=>[c.editor?L((r(),v("input",{key:0,class:"input",type:"text","onUpdate:modelValue":g[0]||(g[0]=b=>c.name=b),onKeypress:Ut(R,["enter"]),onBlur:R},null,40,Ke)),[[ot,c.name],[et]]):(r(),v("span",{key:1,class:"calc-item-title",onClick:N},E(u(l).name||"\u6A21\u677F"),1)),c.desc.f?L((r(),v("input",{key:2,class:"input",type:"text","onUpdate:modelValue":g[1]||(g[1]=b=>c.desc.v=b),onKeypress:Ut(H,["enter"]),onBlur:H},null,40,Qe)),[[ot,c.desc.v],[et]]):(r(),v("span",{key:3,class:"calc-item-desc",onClick:V},E(u(l).desc||"\u6CA1\u6709\u63CF\u8FF0"),1)),f(u(ne),{style:{width:"120px"}},{default:h(()=>[f(u(it),{dir:"top"},{label:h(()=>[Xe]),default:h(()=>[We,Ze,Ye,ts,es]),_:1}),t("div",null,[f(u(zt),{modelValue:e.value,"onUpdate:modelValue":g[3]||(g[3]=b=>e.value=b)},{popover:h(({onClose:b})=>[t("div",{class:"list",onClick:I=>b()},[(r(),v(T,null,G([{label:"\u666E\u901A",value:0},{label:"\u514B\u5236",value:30},{label:"\u88AB\u514B\u5236",value:-25},{label:"\u6FC0\u8361",value:50}],({label:I,value:Y})=>t("div",{key:I,class:"list-item",onClick:at=>{u(l).kz=Y,d()}},E(I),9,ns)),64))],8,ss)]),default:h(()=>[L(t("input",{class:"input",type:"number","onUpdate:modelValue":g[2]||(g[2]=b=>u(l).kz=b)},null,512),[[ot,u(l).kz,void 0,{number:!0}]])]),_:1},8,["modelValue"])])]),_:1})]),_:1}),t("div",us,[t("div",os,[f(u(it),{dir:"top"},{label:h(()=>[as]),default:h(()=>[ls]),_:1}),t("div",is,[L(t("input",{type:"number",class:"input",min:"0",step:.1,"onUpdate:modelValue":g[4]||(g[4]=b=>u(l).a1=b),onInput:d},null,40,cs),[[ot,u(l).a1,void 0,{number:!0}]]),ds])]),(r(),v(T,null,G(D,b=>t("div",{class:"col-item",key:b.name},[f(u(it),{dir:"top"},{label:h(()=>[t("div",rs,E(b.label),1)]),default:h(()=>[Z(" "+E(b.tip),1)]),_:2},1024),t("div",ps,[f(u(xt),{class:"input",modelValue:u(l)[b.name],"onUpdate:modelValue":I=>u(l)[b.name]=I,result:$[b.name],"onUpdate:result":[I=>$[b.name]=I,d]},null,8,["modelValue","onUpdate:modelValue","result","onUpdate:result"])])])),64)),t("div",_s,[f(u(it),{dir:"top"},{label:h(()=>[fs]),default:h(()=>[vs]),_:1}),t("div",hs,[L(t("input",{type:"number",class:"input","onUpdate:modelValue":g[5]||(g[5]=b=>u(l).ea=b),onInput:d},null,544),[[ot,u(l).ea,void 0,{number:!0}]])])]),ms,t("div",Fs,[f(u(it),{dir:"top"},{label:h(()=>[Bs]),default:h(()=>[bs]),_:1}),t("div",$s,[L(t("input",{type:"number",class:"input",min:"0",step:.1,"onUpdate:modelValue":g[6]||(g[6]=b=>u(l).a2=b),onInput:d},null,40,xs),[[ot,u(l).a2,void 0,{number:!0}]]),ys])]),(r(),v(T,null,G(w,b=>t("div",{class:"col-item",key:b.name},[f(u(it),{dir:"top"},{label:h(()=>[t("div",Cs,E(b.label),1)]),default:h(()=>[Z(" "+E(b.tip),1)]),_:2},1024),t("div",gs,[f(u(xt),{class:"input",modelValue:u(l)[b.name],"onUpdate:modelValue":I=>u(l)[b.name]=I,result:$[b.name],"onUpdate:result":[I=>$[b.name]=I,d]},null,8,["modelValue","onUpdate:modelValue","result","onUpdate:result"])])])),64)),t("div",ws,[Es,t("div",ks,[t("span",Ds,E(u(P)),1)])]),js,(r(!0),v(T,null,G([u(j)],b=>(r(),v(T,null,[(r(!0),v(T,null,G([{label:"\u4E00\u6BB5\u4F24\u5BB3",v:b.r01,v2:b.r01c},{label:"\u4E8C\u6BB5\u4F24\u5BB3",v:b.r02,v2:b.r02c}],(I,Y)=>(r(),v("div",{class:"col-item",key:Y},[t("div",As,[t("span",Ss,E(I.label),1),Ms]),t("div",Us,[t("span",Vs,E(I.v),1),t("span",Is,"("+E(I.v2)+")",1)])]))),128)),(r(!0),v(T,null,G([{label:"\u4E0D\u66B4\u51FB",value:b.r01+b.r02},{label:"\u4E00\u6BB5\u66B4\u51FB",value:b.r01c+b.r02},{label:"\u4E8C\u6BB5\u66B4\u51FB",value:b.r01+b.r02c},{label:"\u5168\u66B4\u51FB",value:b.r01c+b.r02c}],(I,Y)=>(r(),v("div",{class:"col-item",key:Y},[t("div",Ts,E(I.label),1),t("div",Hs,[t("span",Js,E(I.value),1),(+s.enemyState.hp||0)<=I.value?(r(),v("span",Ps," \u51FB\u6740 ")):X("",!0)])]))),128))],64))),256))])],64)}}});const qs=nt(Rs,[["__scopeId","data-v-2040a7c5"]]),At=s=>(Dt("data-v-f608b9de"),s=s(),jt(),s),Gs=At(()=>t("div",{class:"heading"},[t("div",{class:"heading-title"},"\u57FA\u672C\u53C2\u6570")],-1)),Ns={class:"row"},zs={class:"label"},Ls={class:"input-group"},Os=["step","onUpdate:modelValue","onChange"],Ks=["value"],Qs={class:"col-item"},Xs=At(()=>t("div",{class:"label"},"\u8FDB\u56FE\u653B\u51FB",-1)),Ws={class:"static-control text-center"},Zs={class:"darkgold"},Ys=At(()=>t("div",{class:"heading"},[t("div",{class:"heading-title"},"\u654C\u4EBA\u9762\u677F")],-1)),tn={class:"row"},en={class:"label"},sn={key:1,class:"label"},nn={class:"input-group"},un={key:0,class:"input-ext"},on=At(()=>t("div",{class:"heading-title"},"\u6280\u80FD\u6A21\u677F",-1)),an=ht({__name:"Calculator",props:{data:null},emits:["update:data"],setup(s,{emit:n}){const a=s,e=tt(()=>a.data.basic),c=tt(()=>a.data.state),$=tt(()=>a.data.enemyState),l=tt(()=>a.data.items),d=vt(Pe()),D=vt({hp:0,def:0,defExt:0,defGain:0,ra:0,rb:0}),w=[{label:"\u9762\u677F\u653B\u51FB",name:"w",step:1,align:"right"},{label:"\u9B42\u77F3\u653B\u51FB",name:"a",step:1},{label:"\u8BCD\u6761\u653B\u51FB%",name:"c",step:1},{label:"\u661F\u4E4B\u6676\u653B\u51FB",name:"x",step:1},{label:"\u7CBE\u8FDB\u653B\u51FB",name:"j",step:1}],x=[{label:"\u6C14\u8840",name:"hp",step:1},{label:"\u9632\u5FA1",name:"def",step:1},{label:"\u9644\u52A0\u9632\u5FA1",name:"defExt",step:1,tips:"\u4E00\u822C\u4E3A\u653B\u8F6C\u9632\u9644\u52A0\u7684\u56FA\u5B9A\u9632\u5FA1"},{label:"\u9632\u5FA1\u4FEE\u6B63%",name:"defGain",step:1},{label:"A\u7C7B\u514D\u4F24%",name:"ra",step:1},{label:"B\u7C7B\u514D\u4F24%",name:"rb",step:1}],P=()=>{const A=e.value.c/100;e.value.g=Math.ceil(d.a+e.value.w*A+e.value.x+e.value.j),c.value.att=e.value.w+e.value.g},_=async()=>{n("update:data",a.data)},p=(A,S)=>{S==="panel"&&P(),_()},j=(A,S)=>{const y=a.data.items;!y||(y[S]=A,_())},k=()=>{const A=a.data.items;!A||(A.push(Qt()),_())},N=A=>{const S=a.data.items;!S||(S.splice(A,1),_())},R=A=>{const S=a.data.items;if(!S)return;const y=S[A],B=S[A-1];S[A-1]=y,S[A]=B,_()},V=A=>{const S=a.data.items;if(!S)return;const y=S[A],B=S[A+1];S[A+1]=y,S[A]=B,_()},H=A=>{const S=a.data.items;if(!S)return;const y=S[A];S.push(kt.cloneDeep(y)),_()};return qt(()=>[a.data.basic.w],()=>{P()}),(A,S)=>(r(),v("div",null,[Gs,t("div",Ns,[(r(),v(T,null,G(w,y=>t("div",{class:"col-item",key:y.name},[t("div",zs,E(y.label),1),t("div",Ls,[y.name in d?(r(),lt(u(xt),{key:0,modelValue:u(e)[y.name],"onUpdate:modelValue":B=>u(e)[y.name]=B,result:d[y.name],"onUpdate:result":B=>d[y.name]=B,onChange:B=>p(y.name,"panel")},null,8,["modelValue","onUpdate:modelValue","result","onUpdate:result","onChange"])):L((r(),v("input",{key:1,type:"number",class:"input",style:Tt({textAlign:y.align}),min:"0",step:y.step,"onUpdate:modelValue":B=>u(e)[y.name]=B,onChange:B=>p(y.name,"panel")},null,44,Os)),[[ot,u(e)[y.name],void 0,{number:!0}]]),y.name==="w"?(r(),v("input",{key:2,class:"input green",readonly:"",style:{textAlign:"left"},value:`+${u(e).g}`},null,8,Ks)):X("",!0)])])),64)),t("div",Qs,[Xs,t("div",Ws,[t("span",Zs,E(u(c).att),1)])])]),Ys,t("div",tn,[(r(),v(T,null,G(x,y=>t("div",{class:"col-item",key:y.name},[y.tips?(r(),lt(u(it),{key:0,dir:"top"},{label:h(()=>[t("div",en,E(y.label),1)]),default:h(()=>[Z(" "+E(y.tips),1)]),_:2},1024)):(r(),v("div",sn,E(y.label),1)),t("div",nn,[f(u(xt),{modelValue:u($)[y.name],"onUpdate:modelValue":B=>u($)[y.name]=B,result:D[y.name],"onUpdate:result":B=>D[y.name]=B,onChange:B=>p(y.name)},null,8,["modelValue","onUpdate:modelValue","result","onUpdate:result","onChange"]),y.precent?(r(),v("div",un,"%")):X("",!0)])])),64))]),t("div",{class:"heading"},[on,t("div",{class:"heading-actions"},[t("div",{class:"btn btn-primary btn-sm",onClick:k},"\u6DFB\u52A0")])]),(r(!0),v(T,null,G(u(l),(y,B)=>(r(),lt(qs,{key:y,panel:u(e),state:u(c),enemyState:D,itemState:y,showUp:B>0,showDown:u(l)&&B<u(l).length-1,"onUpdate:itemState":g=>j(g,B),onClose:g=>N(B),onUp:g=>R(B),onDown:g=>V(B),onCopy:g=>H(B)},null,8,["panel","state","enemyState","itemState","showUp","showDown","onUpdate:itemState","onClose","onUp","onDown","onCopy"]))),128))]))}});const ln=nt(an,[["__scopeId","data-v-f608b9de"]]),cn=ht({props:{show:Boolean,list:Array,class:String,height:String},emits:["click","close","update:show"],setup(s,{emit:n}){return{wrapClass:tt(()=>["c-action-sheet-wrapper",s.class,{show:s.show}]),onClick:($,l)=>{n("click",{item:$,index:l}),n("close",!1)},onClose:()=>{n("update:show",!1),n("close",!1)}}}});const dn={class:"c-action-sheet-section"},rn={class:"c-action-sheet-extra"},pn={class:"c-action-sheet-list"},_n=["onClick"];function fn(s,n,a,e,c,$){return r(),lt(Nt,{to:"body"},[t("div",{class:Et(s.wrapClass)},[t("div",{class:"c-action-sheet-mask",onClick:n[0]||(n[0]=(...l)=>s.onClose&&s.onClose(...l))}),t("div",dn,[t("div",{class:"c-action-sheet-body",style:Tt({maxHeight:s.height})},[t("div",rn,[$t(s.$slots,"extra")]),t("div",pn,[(r(!0),v(T,null,G(s.list,(l,d)=>(r(),v("div",{class:"c-action-sheet-item",key:d,onClick:D=>s.onClick(l,d)},[$t(s.$slots,"default",{record:l})],8,_n))),128))])],4)])],2)])}const It=nt(cn,[["render",fn]]);It.install=s=>{s.component("action-sheet",It)};const vn={class:"hero-item"},hn={class:"hero-item__inner"},mn=["src"],Fn=["src","alt","title"],Bn={class:"hero-item__label"},bn=ht({__name:"HeroSelect",props:{show:{type:Boolean}},emits:["click","update:show"],setup(s,{emit:n}){const{heroes:a,getHeroIcon:e,getHeroIconBg:c}=ce(),$=tt(()=>a.value),l=d=>{n("click",d)};return(d,D)=>(r(),lt(u(It),{class:"hero-select",show:s.show,list:u($),height:"80vh",onClick:l,"onUpdate:show":D[0]||(D[0]=w=>d.$emit("update:show",w))},{extra:h(()=>[$t(d.$slots,"extra")]),default:h(({record:w})=>[t("div",vn,[t("div",hn,[t("img",{src:u(c)(w)},null,8,mn),t("img",{src:u(e)(w),alt:w.name,title:w.name},null,8,Fn),t("div",Bn,E(w.name),1)])])]),_:3},8,["show","list"]))}});function $n(){const s="red_team",n=oe(),a=K([]),e=K(!1),c=K(),$=async _=>{const j=(await n.transaction(s,"readwrite")).objectStore(s),k=await n.wrap(j.put(_));return a.value.find(R=>R._id===_._id)||(_._id=k,a.value.push(_)),k},l=async _=>{const j=(await n.transaction(s,"readwrite")).objectStore(s);await n.wrap(j.delete(_._id)),a.value=a.value.filter(k=>k._id!==_._id)},d=async _=>{const p=await n.transaction(s,"readwrite"),j=p.objectStore(s);for(const k of _)await n.wrap(j.put(k));await n.twrap(p),await w()},D=async()=>{const p=(await n.transaction(s,"readwrite")).objectStore(s);await n.wrap(p.clear()),a.value=[]},w=async()=>{const p=(await n.transaction(s,"readonly")).objectStore(s),j=await n.wrap(p.getAll()).catch(()=>[]);j.forEach(k=>{k.scList||(k.scList=[{n:"\u6676\u7CB9\xB7\u9633",pos:W.ATT},{n:"\u6676\u7CB9\xB7\u9633",pos:W.ATT},{n:"\u6676\u7CB9\xB7\u9716",pos:W.XUE},{n:"\u6676\u7CB9\xB7\u9716",pos:W.XUE},{n:"\u6676\u7CB9\xB7\u8679",pos:W.DEF},{n:"\u6676\u7CB9\xB7\u8679",pos:W.DEF}])}),a.value=j},x=async _=>{const p=JSON.parse(await _.text());if(!Lt(p)||p.type!=="red_team"){alert("\u5BFC\u5165\u7684\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E");return}const j=p.data;j.forEach(k=>delete k._id),await d(j)},P=async()=>{const _={type:"red_team",data:a.value},p=new Blob([JSON.stringify(_)],{type:"application/json"});Vt(p,"red_team.json")};return w(),{scShow:e,scSelected:c,put:$,del:l,puts:d,clear:D,all:w,list:a,importData:x,exportData:P}}const xn={},yn={class:"c-upload"};function Cn(s,n){return r(),v("div",yn,[$t(s.$slots,"default",{},void 0,!0),t("input",ae({type:"file",class:"c-upload-input",accept:"application/json"},s.$attrs),null,16)])}const gn=nt(xn,[["render",Cn],["__scopeId","data-v-b3879154"]]),wn=[1020,330,270,0,150,0],En=[930,360,253,0,120,0],kn=[870,390,240,0,150,0],Dn=[870,0,240,390,150,0],jn=[780,360,210,0,180,0],An=[810,390,180,0,210,0],Sn=[750,360,210,0,150,0],Mn=[690,0,180,390,240,0],Un=[750,0,180,360,270,0],Vn=[750,0,210,330,270,0],In=[750,0,210,360,210,0],Tn={xk:kn,xk_f:Dn,ys:Sn,tw:wn,tw2:En,zs:Mn,zs2:Un,zy:Vn,yf:jn,yf2:An,dj:In,none:[0,0,0,0,0,0]};function Rt(s){return Tn[s]}const Bt=s=>s%1>.5?Math.ceil(s):Math.floor(s);function Hn(){const s=()=>({name:"",qixue:0,patt:0,pdef:0,matt:0,mdef:0,huixin:0,stoneName:"",hsQixue:0,hsPatt:0,hsPdef:0,hsMatt:0,hsMdef:0,hsHuixin:0,scList:[{n:"\u6676\u7CB9\xB7\u9633",pos:W.ATT},{n:"\u6676\u7CB9\xB7\u9633",pos:W.ATT},{n:"\u6676\u7CB9\xB7\u9716",pos:W.XUE},{n:"\u6676\u7CB9\xB7\u9716",pos:W.XUE},{n:"\u6676\u7CB9\xB7\u8679",pos:W.DEF},{n:"\u6676\u7CB9\xB7\u8679",pos:W.DEF}],cQixue:"40+5+5+5",cPatt:"0",cPdef:"0",cMatt:"0",cMdef:"0",cHuixin:"0",rQixue:0,rPatt:0,rPdef:0,rMatt:0,rMdef:0,rHuixin:0,jjType:"none",jjText:"\u65E0",jjQixue:0,jjPatt:0,jjPdef:0,jjMatt:0,jjMdef:0,jjHuixin:0}),n=K(s()),a=tt(()=>{const l=[0,0,0,0,0,0];return n.value.scList.forEach(d=>{!d.v||(l[0]+=d.v.qixue,l[1]+=d.v.patt,l[2]+=d.v.pdef,l[3]+=d.v.matt,l[4]+=d.v.mdef,l[5]+=d.v.huixin)}),l}),e=tt(()=>{const l=n.value,d={qixue:0,patt:0,pdef:0,matt:0,mdef:0,huixin:0},D=Ot.find(P=>l.stoneName===P.name);D&&(d.qixue=D.t[0]+D.d[0]+D.h[0],d.patt=D.t[1]+D.d[1]+D.h[1],d.matt=D.t[2]+D.d[2]+D.h[2],d.pdef=D.t[3]+D.d[3]+D.h[3],d.mdef=D.t[4]+D.d[4]+D.h[4]);const w={qixue:l.hsQixue/100,patt:l.hsPatt/100,pdef:l.hsPdef/100,matt:l.hsMatt/100,mdef:l.hsMdef/100,huixin:l.hsHuixin/100},x=a.value;return{qixue:Bt(l.qixue*w.qixue+d.qixue+x[0]+l.jjQixue),patt:Bt(l.patt*w.patt+d.patt+x[1]+l.jjPatt),pdef:Bt(l.pdef*w.pdef+d.pdef+x[2]+l.jjPdef),matt:Bt(l.matt*w.matt+d.matt+x[3]+l.jjMatt),mdef:Bt(l.mdef*w.mdef+d.mdef+x[4]+l.jjMdef),huixin:Bt(l.huixin*w.huixin+d.huixin+x[5]+l.jjHuixin)}}),c=tt(()=>{const l=e.value,d={qixue:(100+n.value.rQixue)/100,patt:(100+n.value.rPatt)/100,pdef:(100+n.value.rPdef)/100,matt:(100+n.value.rMatt)/100,mdef:(100+n.value.rMdef)/100,huixin:(100+n.value.rHuixin)/100};return{qixue:Math.round((n.value.qixue+l.qixue)*d.qixue),patt:Math.round((n.value.patt+l.patt)*d.patt),pdef:Math.round((n.value.pdef+l.pdef)*d.pdef),matt:Math.round((n.value.matt+l.matt)*d.matt),mdef:Math.round((n.value.mdef+l.mdef)*d.mdef),huixin:Math.round((n.value.huixin+l.huixin)*d.huixin)}});return{state:n,pValue:e,ckValue:c,scSum:a,reset:()=>{n.value=s()},defState:s}}const O=s=>(Dt("data-v-a38823ad"),s=s(),jt(),s),Jn={class:"transform-tools-popover"},Pn={class:"transform-tools-popover-toolbar"},Rn=["value"],qn=["value"],Gn=O(()=>t("button",{class:"btn btn-sm btn-success"},"\u5BFC\u5165",-1)),Nn={class:"transform-tools-popover-content"},zn={class:"grid-group"},Ln={class:"grid-group-item"},On={class:"input-group-title"},Kn=O(()=>t("span",null,"\u57FA\u7840",-1)),Qn={class:"grids"},Xn={class:"input-label"},Wn={class:"input-group"},Zn={class:"input green"},Yn={class:"grid-group-item"},tu={class:"input-group-title"},eu=O(()=>t("span",null,"\u9B42\u77F3",-1)),su=O(()=>t("option",{value:""},"\u65E0",-1)),nu=["value"],uu={class:"grids"},ou=O(()=>t("label",{class:"input-label"},"\u6C14\u8840%",-1)),au=O(()=>t("label",{class:"input-label"},"\u7269\u653B%",-1)),lu=O(()=>t("label",{class:"input-label"},"\u7269\u9632%",-1)),iu=O(()=>t("label",{class:"input-label"},"\u6CD5\u653B%",-1)),cu=O(()=>t("label",{class:"input-label"},"\u6CD5\u9632%",-1)),du={class:"grid-group-item"},ru={class:"input-group-title"},pu=Z(" \u661F\u4E4B\u6676 "),_u=O(()=>t("div",null,"\u6781\u9650\u653B\uFF1A202\u653B\uFF0C198\u8840\uFF0C66\u9632",-1)),fu=O(()=>t("div",null,"\u6781\u9650\u8840\uFF1A456\u8840\uFF0C66\u9632\uFF0C88\u653B",-1)),vu=O(()=>t("div",null,"\u6781\u9650\u9632\uFF1A150\u9632\uFF0C198\u8840\uFF0C88\u653B",-1)),hu={class:"grids"},mu=["onClick","onContextmenu"],Fu={key:0},Bu={key:1},bu={key:2},$u={key:3},xu={key:4},yu={key:5},Cu={key:1},gu={class:"grid-group-item"},wu=O(()=>t("div",{class:"input-group-title"},"\u661F\u4E4B\u6676\u5408\u8BA1",-1)),Eu={class:"grids"},ku={class:"input-label"},Du={class:"input"},ju={class:"grid-group-item"},Au={class:"input-group-title"},Su=O(()=>t("span",null,"\u7CBE\u8FDB\u5C5E\u6027",-1)),Mu=O(()=>t("button",null,"\u9009\u62E9\u7CBE\u8FDB",-1)),Uu={class:"c-list"},Vu=["onClick"],Iu={class:"grids"},Tu={class:"input-label"},Hu={class:"grid-group-item"},Ju=O(()=>t("div",{class:"input-group-title"},"\u4FEE\u6B63%",-1)),Pu={class:"grids"},Ru={class:"input-label"},qu={class:"grid-group-item"},Gu=O(()=>t("div",{class:"input-group-title"},"\u6700\u7EC8\u53C2\u8003",-1)),Nu={class:"grids"},zu={class:"input-label"},Lu={class:"input"},Ou=ht({__name:"transform-tools-modal",props:{show:{type:Boolean}},emits:["init","reference","update:show"],setup(s,{emit:n}){const a=K(!1),{state:e,pValue:c,ckValue:$,scSum:l,reset:d,defState:D}=Hn(),{list:w,put:x,del:P,clear:_,importData:p,exportData:j}=$n(),k=[{t:"\u6C14\u8840",n:"qixue"},{t:"\u7269\u653B",n:"patt"},{t:"\u7269\u9632",n:"pdef"},{t:"\u6CD5\u653B",n:"matt"},{t:"\u6CD5\u9632",n:"mdef"},{t:"\u4F1A\u5FC3",n:"huixin"}],N=[{t:"\u6C14\u8840%",c:"cQixue",r:"rQixue"},{t:"\u7269\u653B%",c:"cPatt",r:"rPatt"},{t:"\u7269\u9632%",c:"cPdef",r:"rPdef"},{t:"\u6CD5\u653B%",c:"cMatt",r:"rMatt"},{t:"\u6CD5\u9632%",c:"cMdef",r:"rMdef"},{t:"\u4F1A\u5FC3%",c:"cHuixin",r:"rHuixin"}],R=[{t:"\u6C14\u8840",n:"jjQixue"},{t:"\u7269\u653B",n:"jjPatt"},{t:"\u7269\u9632",n:"jjPdef"},{t:"\u6CD5\u653B",n:"jjMatt"},{t:"\u6CD5\u9632",n:"jjMdef"},{t:"\u4F1A\u5FC3",n:"jjHuixin"}],V=K(!1),H=K(),A=U=>{H.value=U,V.value=!0},S=U=>{!H.value||(H.value.v=U)},y=()=>{const U=kt.cloneDeep(e.value);x(U).then(m=>{e.value._id=m,alert("\u5DF2\u4FDD\u5B58")}).catch(m=>{console.log(m),alert("\u4FDD\u5B58\u5931\u8D25")})},B=()=>{const U=kt.cloneDeep(e.value);delete U._id,U.name+=" copy",x(U).then(m=>{U._id=m,e.value=U}).catch(m=>{console.log(m),alert("\u590D\u5236\u5931\u8D25")})},g=()=>{!confirm("\u786E\u8BA4\u8981\u5220\u9664\u5417\uFF1F")||P(e.value).then(()=>{d()}).catch(m=>{console.log(m),alert("\u5220\u9664\u5931\u8D25")})},et=U=>{const m=U.currentTarget;if(!m.files)return;const q=Array.prototype.slice.call(m.files);m.value="",q[0]&&p(q[0])},b=()=>{j()},I=()=>{!confirm("\u662F\u5426\u8981\u6E05\u7A7A\u5168\u90E8\uFF1F")||_().catch(m=>{console.log(m),alert("\u6E05\u7A7A\u5931\u8D25")})},Y=(U,m)=>{e.value.name||(e.value.name=U.name),e.value.qixue=m.qixue,e.value.patt=m.patt,e.value.pdef=m.pdef,e.value.matt=m.matt,e.value.mdef=m.mdef,e.value.huixin=m.huixin,e.value.jjType=U.key;const q=Rt(U.key);e.value.jjQixue=q[0],e.value.jjPatt=q[1],e.value.jjPdef=q[2],e.value.jjMatt=q[3],e.value.jjMdef=q[4],e.value.jjHuixin=q[5]},at=[{value:"xk",text:"\u4FA0\u5BA2"},{value:"xk_f",text:"\u4FA0\u5BA2\u6CD5"},{value:"tw",text:"\u94C1\u536B"},{value:"tw2",text:"\u731B\u58EB"},{value:"ys",text:"\u7FBD\u58EB"},{value:"yf",text:"\u5FA1\u98CE"},{value:"yf2",text:"\u5FA1\u98CE\u83BD"},{value:"zs",text:"\u5492\u5E08"},{value:"zs2",text:"\u5492\u5E08\u8089"},{value:"zy",text:"\u795D\u7531"},{value:"dj",text:"\u6597\u5C06"},{value:"none",text:"\u65E0"}],rt=U=>{e.value.jjType=U.value,e.value.jjText=U.text;const m=Rt(e.value.jjType);e.value.jjQixue=m[0],e.value.jjPatt=m[1],e.value.jjPdef=m[2],e.value.jjMatt=m[3],e.value.jjMdef=m[4],e.value.jjHuixin=m[5]},mt=()=>{n("reference")};return n("init",Y),(U,m)=>{const q=bt("c-col"),F=bt("c-space"),i=bt("c-row");return L((r(),v("div",Jn,[t("div",Pn,[f(i,{flex:"",middle:"",gutter:8},{default:h(()=>[f(q,null,{default:h(()=>[t("button",{class:"btn btn-sm btn-link",onClick:mt},"\u53C2\u8003")]),_:1}),f(q,null,{default:h(()=>[Z("ID: "+E(u(e)._id),1)]),_:1}),f(q,{flex:"1 1 auto"},{default:h(()=>[f(F,null,{default:h(()=>[L(t("select",{class:"input input-select",placeholder:"\u8BF7\u9009\u62E9\u5DF2\u6709\u6A21\u677F","onUpdate:modelValue":m[0]||(m[0]=o=>Ct(e)?e.value=o:null)},[t("option",{value:u(D)()},"\u7A7A\u6A21\u7248",8,Rn),(r(!0),v(T,null,G(u(w),o=>(r(),v("option",{key:o._id,value:o},E(o.name),9,qn))),128))],512),[[Ht,u(e)]]),t("button",{class:"btn btn-sm btn-primary",onClick:y},"\u4FDD\u5B58"),t("button",{class:"btn btn-sm btn-primary",onClick:B},"\u590D\u5236"),u(e)._id?(r(),v("button",{key:0,class:"btn btn-sm btn-danger",onClick:g},"\u5220\u9664")):X("",!0),f(gn,{onChange:et},{default:h(()=>[Gn]),_:1}),t("button",{class:"btn btn-sm btn-success",onClick:b},"\u5BFC\u51FA"),t("button",{class:"btn btn-sm btn-danger",onClick:I},"\u6E05\u7A7A")]),_:1})]),_:1}),f(q,null,{default:h(()=>[t("span",{class:"transform-tools-popover-close",onClick:m[1]||(m[1]=o=>n("update:show",!1))}," \xD7 ")]),_:1})]),_:1})]),t("div",Nn,[t("div",zn,[t("div",Ln,[t("div",On,[f(F,null,{default:h(()=>[Kn,L(t("input",{type:"text",class:"input input-text","onUpdate:modelValue":m[2]||(m[2]=o=>u(e).name=o)},null,512),[[ot,u(e).name]])]),_:1})]),t("div",Qn,[(r(),v(T,null,G(k,o=>f(F,{key:o.n},{default:h(()=>[t("label",Xn,E(o.t),1),t("div",Wn,[f(u(_t),{readonly:"",value:u(e)[o.n]},null,8,["value"]),t("div",Zn,"+"+E(u(c)[o.n]),1)])]),_:2},1024)),64))])]),t("div",Yn,[t("div",tu,[f(F,null,{default:h(()=>[eu,L(t("select",{class:"input input-select","onUpdate:modelValue":m[3]||(m[3]=o=>u(e).stoneName=o)},[su,(r(!0),v(T,null,G(u(Ot),(o,M)=>(r(),v("option",{key:M,value:o.name},E(o.name),9,nu))),128))],512),[[Ht,u(e).stoneName]])]),_:1})]),t("div",uu,[f(F,null,{default:h(()=>[ou,f(u(_t),{value:u(e).hsQixue,"onUpdate:value":m[4]||(m[4]=o=>u(e).hsQixue=o)},null,8,["value"])]),_:1}),f(F,null,{default:h(()=>[au,f(u(_t),{value:u(e).hsPatt,"onUpdate:value":m[5]||(m[5]=o=>u(e).hsPatt=o)},null,8,["value"])]),_:1}),f(F,null,{default:h(()=>[lu,f(u(_t),{value:u(e).hsPdef,"onUpdate:value":m[6]||(m[6]=o=>u(e).hsPdef=o)},null,8,["value"])]),_:1}),f(F,null,{default:h(()=>[iu,f(u(_t),{value:u(e).hsMatt,"onUpdate:value":m[7]||(m[7]=o=>u(e).hsMatt=o)},null,8,["value"])]),_:1}),f(F,null,{default:h(()=>[cu,f(u(_t),{value:u(e).hsMdef,"onUpdate:value":m[8]||(m[8]=o=>u(e).hsMdef=o)},null,8,["value"])]),_:1})])]),t("div",du,[t("div",ru,[pu,f(u(it),{label:"?",inline:"",dir:"right"},{default:h(()=>[_u,fu,vu]),_:1})]),t("div",hu,[(r(!0),v(T,null,G(u(e).scList,(o,M)=>(r(),v("div",{key:M,class:Et(["sc-props",{selected:H.value===o,s1:u(W).ATT===o.pos,s2:u(W).XUE===o.pos,s3:u(W).DEF===o.pos}]),onClick:J=>A(o),onContextmenu:wt(J=>o.v=void 0,["prevent"])},[o.v?(r(),v(T,{key:0},[o.v.qixue>0?(r(),v("span",Fu,"\u6C14\u8840+"+E(o.v.qixue),1)):X("",!0),o.v.patt>0?(r(),v("span",Bu,"\u7269\u653B+"+E(o.v.patt),1)):X("",!0),o.v.pdef>0?(r(),v("span",bu,"\u7269\u9632+"+E(o.v.pdef),1)):X("",!0),o.v.matt>0?(r(),v("span",$u,"\u6CD5\u653B+"+E(o.v.matt),1)):X("",!0),o.v.mdef>0?(r(),v("span",xu,"\u6CD5\u9632+"+E(o.v.mdef),1)):X("",!0),o.v.huixin>0?(r(),v("span",yu,"\u4F1A\u5FC3+"+E(o.v.huixin),1)):X("",!0)],64)):(r(),v("span",Cu,E(o.n),1))],42,mu))),128))]),(r(),lt(Nt,{to:"body"},[H.value?(r(),lt(u(_e),{key:0,show:V.value,"onUpdate:show":m[9]||(m[9]=o=>V.value=o),position:H.value.pos,dir:"left",overlayStyle:"width:360px",onSelect:S},null,8,["show","position"])):X("",!0)]))]),t("div",gu,[wu,t("div",Eu,[(r(),v(T,null,G(k,(o,M)=>f(F,{key:M},{default:h(()=>[t("label",ku,E(o.t),1),t("div",Du,"+"+E(u(l)[M]),1)]),_:2},1024)),64))])]),t("div",ju,[t("div",Au,[f(F,null,{default:h(()=>[Su,f(u(zt),{modelValue:a.value,"onUpdate:modelValue":m[10]||(m[10]=o=>a.value=o)},{popover:h(({onClose:o})=>[t("ul",Uu,[(r(),v(T,null,G(at,M=>t("li",{key:M.value,onClick:J=>{rt(M),o()}},E(M.text),9,Vu)),64))])]),default:h(()=>[Mu]),_:1},8,["modelValue"])]),_:1})]),t("div",Iu,[(r(),v(T,null,G(R,(o,M)=>f(F,{key:M},{default:h(()=>[t("label",Tu,E(o.t),1),f(u(_t),{value:u(e)[o.n],"onUpdate:value":J=>u(e)[o.n]=J,min:"0"},null,8,["value","onUpdate:value"])]),_:2},1024)),64))])]),t("div",Hu,[Ju,t("div",Pu,[(r(),v(T,null,G(N,(o,M)=>f(F,{key:M},{default:h(()=>[t("label",Ru,E(o.t),1),f(u(xt),{modelValue:u(e)[o.c],"onUpdate:modelValue":J=>u(e)[o.c]=J,result:u(e)[o.r],"onUpdate:result":J=>u(e)[o.r]=J},null,8,["modelValue","onUpdate:modelValue","result","onUpdate:result"])]),_:2},1024)),64))])]),t("div",qu,[Gu,t("div",Nu,[(r(),v(T,null,G(k,o=>f(F,{key:o.n},{default:h(()=>[t("label",zu,E(o.t),1),t("div",Lu,E(u($)[o.n]),1)]),_:2},1024)),64))])])])])],512)),[[le,s.show]])}}});const Ku=nt(Ou,[["__scopeId","data-v-a38823ad"]]);function ft(s){return(s%1>.5?Math.ceil:Math.floor)(s)}function Xt(s){const{basic:n,enemyState:a}=s,e={w:n.w,a:z(n.a),c:n.c,x:n.x,j:n.j,g:0,att:0};e.g=ft(n.w*n.c/100+e.a+e.x+e.j),e.att=n.w+e.g;const c={hp:z(a.hp),ra:z(a.ra),rb:z(a.rb),def:z(a.def),defExt:z(a.defExt),defGain:z(a.defGain)};return{b:e,e:c}}function Qu(s,n){const{b:a,e}=Xt(s),c={a1:n.a1,a2:n.a2,att:z(n.att),att2:z(n.att2),da:z(n.da),da2:z(n.da2),db:z(n.db),dc:z(n.dc),dx:z(n.dx),dx2:z(n.dx2),id:z(n.id),cd:z(n.cd),defGain:z(n.defGain),kz:n.kz||0},$=a.att*(100+c.att)/100,l=a.att*(100+c.att+c.att2)/100,d=(100+c.kz)/100,D=(100+c.da-e.ra)/100,w=(100+c.da+c.da2-e.ra)/100,x=(100+c.db-e.rb)/100,P=(100+c.dc)/100,_=(100+c.dx)/100,p=(100+c.dx+c.dx2)/100,j=(100+c.cd)/100,k=(100-c.id)/100,N=(100+e.defGain)/100,R=(100+e.defGain+c.defGain)/100,V=Math.max(0,Math.max(0,e.def*N+e.defExt)*k),H=Math.max(0,Math.max(0,e.def*R+e.defExt)*k),A=Math.max(1,$*d-V),S=Math.max(1,l*d-H),y=A*c.a1*D*x*_,B=ft(y*j),g=S*c.a2*w*x*P*p,et=ft(g*j);return{satt:$,satt2:l,r01:ft(y),r01c:B,r02:ft(g),r02c:et}}function Xu(s){const n=s.items||[],a=document.createElement("canvas");a.width=800,a.height=8+160+n.reduce((p,j)=>{let k=30;return k+=50,j.a1>0&&(k+=30),j.a2>0&&(k+=50),(j.a1>0||j.a2>0)&&(k+=20),j.a1>0&&j.a2>0&&(k+=20),k+=20,p+k},0)+8;const e=a.getContext("2d");if(!e)return;const c=s.basic,$=s.enemyState,{b:l}=Xt(s),d={x:0,y:0},D=(p,j,k)=>{k?(d.x+=p,d.y+=j):(d.x=p,d.y=j)},w=(p=0)=>{d.x=8+p*16},x=(p=0)=>{d.x=8,d.y+=p},P=(p,j="#222222")=>{e.save(),e.fillStyle=j;const{width:k}=e.measureText(p);e.fillText(p,d.x,d.y),d.x+=k+16,e.restore()},_=(p,...j)=>{e.save();const k=typeof p=="string"?p:p[0],N=typeof p=="string"?"#222222":p[1];e.fillStyle=N,e.font="bold 16px sans-serif";const{width:R}=e.measureText(k);e.fillText(k,d.x,d.y),d.x+=R+8,e.restore(),e.save(),e.font="16px sans-serif";for(const V of j){const H=typeof V=="string"?V:V[0],A=typeof V=="string"?"#ff4446":V[1];e.fillStyle=A;const{width:S}=e.measureText(H);e.fillText(H,d.x,d.y),d.x+=S+8}d.x+=8,e.restore()};e.fillStyle="#FBFFF0",e.fillRect(0,0,a.width,a.height),D(8,28),e.textBaseline="bottom",e.font="bold 20px sans-serif",P(s.title),x(40),e.font="bold 18px sans-serif",P("\u653B\u65B9:"),e.font="16px sans-serif",x(30),w(2),_("\u653B\u51FB:",`${c.w}`,[`+${l.g}`,"#55a14f"]),_("\u9B42\u77F3\u653B\u51FB:",`${c.a}`),_("\u9B42\u77F3\u653B\u51FB%:",`${c.c}`),_("\u661F\u4E4B\u6676\u653B\u51FB:",`${c.x}`),_("\u7CBE\u8FDB\u653B\u51FB:",`${c.j}`),x(30),e.font="bold 18px sans-serif",P("\u5B88\u65B9:"),x(30),w(2),_("\u6C14\u8840:",`${$.hp}`),_("\u9632\u5FA1:",`${$.def}`),_("\u9632\u5FA1%:",`${$.defGain}`),_("\u9644\u52A0\u9632\u5FA1:",`${$.defExt}`),x(20),w(2),_("\u514D\u4F24A%:",`${$.ra}`),_("\u514D\u4F24B%:",`${$.rb}`),x(30);for(const p of n){const{satt:j,satt2:k,r01:N,r01c:R,r02:V,r02c:H}=Qu(s,p);e.font="bold 18px sans-serif",P(p.name,"#a30000"),e.font="14px sans-serif",P(p.desc||"\u65E0\u63CF\u8FF0","#a30000"),e.font="16px sans-serif",_("\u514B\u5236:",`${p.kz||0}%`),x(30),w(2),_("\u653B\u51FB%:",`${p.att}`),_("\u7A7F\u900F%:",`${p.id}`),_("\u66B4\u4F24%:",`${p.cd}`),x(20),w(2),_("\u589E\u4F24A%:",`${p.da}`),_("\u589E\u4F24B%:",`${p.db}`),_("\u589E\u4F24X%:",`${p.dx}`),x(30),p.a1>0&&(w(2),_("\u6280\u80FD\u3001\u666E\u653B:",`${p.a1}\u500D`),_("\u653B\u51FB:",[`${ft(j)}`,"#b8860b"]),x(30)),p.a2>0&&(w(2),_("\u8FDE\u51FB\u3001\u8FFD\u51FB\u3001\u53CD\u51FB:",`${p.a2}\u500D`),_("\u653B\u51FB\u4FEE\u6B63%:",p.att2),_("\u9632\u5FA1\u4FEE\u6B63%:",p.defGain),_("\u653B\u51FB:",[`${ft(k)}`,"#b8860b"]),x(20),w(2),_("\u589E\u4F24C%:",p.dc),_("\u589E\u4F24A\u4FEE\u6B63%:",p.da2),_("\u589E\u4F24X\u4FEE\u6B63%:",p.dx2),x(30)),w(2),N>0&&_(["\u6280\u80FD\u3001\u666E\u653B\u4F24\u5BB3","#b8860b"],["\u66B4\u51FB","#ff4446"],[`${N}`,"#b8860b"],[`${R}`,"#ff4446"]),V>0&&_(["\u8FDE\u51FB\u3001\u8FFD\u51FB\u3001\u53CD\u51FB\u4F24\u5BB3","#b8860b"],["\u66B4\u51FB","#ff4446"],[`${V}`,"#b8860b"],[`${H}`,"#ff4446"]),x(20),N>0&&V>0&&(w(2),_(["\u4E0D\u66B4\u51FB","#b8860b"],[`${N+V}`,"#ff4446"]),_(["\u4EC5\u4E00\u6BB5\u66B4\u51FB","#b8860b"],[`${R+V}`,"#ff4446"]),_(["\u4EC5\u4E8C\u6BB5\u66B4\u51FB","#b8860b"],[`${N+H}`,"#ff4446"]),_(["\u5168\u66B4\u51FB","#b8860b"],[`${R+H}`,"#ff4446"]),x(20)),x(20)}a.toBlob(p=>{!p||window.open(URL.createObjectURL(p))})}function Wu(){return{exportImage:Xu}}const dt=s=>(Dt("data-v-6d3f793a"),s=s(),jt(),s),Zu={class:"wrapper"},Yu={class:"toolbar"},to={style:{padding:"6px 16px"}},eo=Z("\u4F24\u5BB3\u8BA1\u7B97\u5668"),so={class:"c-upload"},no=dt(()=>t("button",{class:"btn btn-success"},"\u5BFC\u5165",-1)),uo={style:{padding:"6px 16px"}},oo={class:"input-group"},ao=dt(()=>t("div",{class:"input-ext"},"=",-1)),lo={class:"content"},io={class:"container"},co=["value"],ro=Z(" \u2007 "),po=["onKeypress"],_o={key:1},fo=["onClick"],vo=["onClick"],ho=["onClick"],mo=Z(" \u91CD\u547D\u540D "),Fo=["onClick"],Bo=Z(" \u590D\u5236 "),bo=["onClick"],$o=["onClick"],xo=["onClick"],yo={style:{"text-align":"center"}},Co=dt(()=>t("span",null,"\u7B49\u7EA7",-1)),go=dt(()=>t("span",null,"\u53CA\u8EAB",-1)),wo=dt(()=>t("span",null,"\u661F\u8000",-1)),Eo=dt(()=>t("span",null,"\u5316\u81FB",-1)),ko=dt(()=>t("span",null,"\u661F\u9B42",-1)),Do=dt(()=>t("span",null,"\u661F\u8F89",-1)),jo=ht({__name:"Calculator",setup(s){const{exportImage:n}=Wu(),a=vt({id:"",title:"",selecteds:[],search:""}),e=K([]),c=tt(()=>e.value.filter(F=>F.title.indexOf(a.search)>-1)),$=async()=>{const i={id:Pt(),title:"\u6A21\u677F",basic:Je(),state:Re(),enemyState:Ne(),items:Ge()};await Ve(i),e.value.push(i)},l=async F=>{if(!confirm("\u786E\u8BA4\u8981\u5220\u9664\u5417\uFF1F"))return;const o=e.value.findIndex(M=>M.id===F);o!==-1&&(await Ie(e.value[o].id),e.value.splice(o,1))},d=async F=>{const i=a.title;if(!i){D();return}const o=e.value.findIndex(J=>J.id===F);if(o===-1)return;const M=e.value[o];M.title=i,D(),await gt(M)},D=()=>{a.id="",a.title=""},w=F=>{try{n(F)}catch{alert("\u5BFC\u51FA\u5931\u8D25\uFF0C\u6570\u636E\u5B58\u5728\u9519\u8BEF")}},x=F=>{const i={type:"calculator",data:[F]},o=new Blob([JSON.stringify(i)],{type:"application/json"});Vt(o,`${F.title}.json`)},P=async F=>{e.value=F},_=F=>new Promise((i,o)=>{const M=new FileReader;M.onload=()=>{i(M.result)},M.onerror=()=>{o(M.error)},M.readAsText(F)}),p=async()=>{if(!confirm("\u786E\u8BA4\u8981\u6E05\u7A7A\u6240\u6709\u6570\u636E\u5417\uFF1F"))return;let i=c.value;a.selecteds.length>0&&(i=a.selecteds.map(o=>c.value[o]).filter(o=>o)),await He(i.map(o=>o.id)),q()},j=async F=>{const i=F.currentTarget,o=Array.prototype.slice.call(i.files);if(i.value="",!o||!o[0])return;const M=o[0],J=await _(M),ut=JSON.parse(J);let pt=[];if(pe(ut))pt=ut;else if(Lt(ut)&&ut.type==="calculator")pt=ut.data;else{alert("\u5BFC\u5165\u7684\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E");return}await Te(pt),q()},k=async()=>{let F="calculator.json",i=c.value;a.selecteds.length>0&&(i=a.selecteds.map(J=>c.value[J]).filter(J=>J),F="calculator-selected.json");const o={type:"calculator",data:i},M=new Blob([JSON.stringify(o)],{type:"application/json"});Vt(M,F)};async function N(F,i){const o=e.value.findIndex(J=>J.id===i);o===-1||!e.value[o]||(e.value[o]=F,await gt(F))}const R=K(-1),V=vt({input:"2283/1.35*1.39",result:0}),{translate:H,level:A,xingyao:S,huazhen:y,xinghun:B,xinghui:g}=re(),et=F=>Math.ceil(F),b=vt({show:!1}),I=F=>{const i=H(F);Y.value&&Y.value(F,i)},Y=K(),at=K(!1),rt=K(),mt=F=>{at.value=!0,rt.value=F},U=({item:F})=>{if(at.value=!1,rt.value){const i=rt.value,o=H(F);i.title==="\u6A21\u677F"&&(i.title=F.name),i.basic.w=Math.max(o.patt,o.matt),gt(i)}else I(F)},m=F=>{const i=kt.cloneDeep(F);i.id=Pt(),console.log(i),e.value.push(i),gt(i)};async function q(){const F=await Ue();a.selecteds=[],P(F)}return ie(()=>{q()}),(F,i)=>{const o=bt("c-col"),M=bt("c-row"),J=xt,ut=bt("c-space"),pt=Gt("autofocus");return r(),v("div",Zu,[t("div",Yu,[t("div",to,[f(M,{flex:"",middle:"",gutter:16},{default:h(()=>[f(o,{flex:"0 0 auto"},{default:h(()=>[eo]),_:1}),f(o,{flex:"0 0 auto"},{default:h(()=>[t("button",{class:"btn btn-sm btn-link",onClick:i[0]||(i[0]=C=>b.show=!b.show)},"\u9762\u677F"),a.selecteds.length>0?(r(),v("button",{key:0,class:"btn btn-success",onClick:i[1]||(i[1]=C=>a.selecteds=[])}," \u53D6\u6D88\u6240\u9009 ")):X("",!0)]),_:1}),f(o,{flex:"1 1 0"},{default:h(()=>[L(t("input",{type:"text",class:"input",placeholder:"\u540D\u79F0\u8FC7\u6EE4","onUpdate:modelValue":i[2]||(i[2]=C=>a.search=C)},null,512),[[ot,a.search]])]),_:1}),f(o,{flex:"0 0 auto"},{default:h(()=>[t("button",{class:"btn btn-danger",onClick:p},E(a.selecteds.length>0?"\u5220\u9664\u6240\u9009":"\u6E05\u7A7A"),1),t("div",so,[no,t("input",{type:"file",class:"c-upload-input",accept:"application/json",onInput:j},null,32)]),t("button",{class:"btn btn-success",onClick:k},E(a.selecteds.length>0?"\u5BFC\u51FA\u6240\u9009":"\u5BFC\u51FA"),1),t("button",{class:"btn btn-primary",onClick:i[3]||(i[3]=C=>$())},"\u6DFB\u52A0")]),_:1})]),_:1}),f(u(Ku),{show:b.show,"onUpdate:show":i[4]||(i[4]=C=>b.show=C),onReference:i[5]||(i[5]=C=>mt()),onInit:i[6]||(i[6]=C=>Y.value=C)},null,8,["show"])]),t("div",uo,[t("div",oo,[f(J,{modelValue:V.input,"onUpdate:modelValue":i[7]||(i[7]=C=>V.input=C),result:V.result,"onUpdate:result":i[8]||(i[8]=C=>V.result=C),style:{flex:"3 3 0"}},null,8,["modelValue","result"]),ao,f(St,{readonly:"",value:et(V.result),style:{flex:"2 2 0"}},null,8,["value"])])])]),t("div",lo,[t("div",io,[(r(!0),v(T,null,G(u(c),(C,Ft)=>(r(),lt(u(de),{key:C.id,activeKey:Ft===R.value,onToggle:Q=>R.value=Q?Ft:-1},{header:h(()=>[f(M,{flex:"",middle:""},{default:h(()=>[f(o,null,{default:h(()=>[L(t("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":i[9]||(i[9]=Q=>a.selecteds=Q),value:Ft,onClick:i[10]||(i[10]=wt(()=>{},["stop"]))},null,8,co),[[yt,a.selecteds]]),ro]),_:2},1024),f(o,null,{default:h(()=>[a.id===C.id?L((r(),v("input",{key:0,type:"text",class:"input","onUpdate:modelValue":i[11]||(i[11]=Q=>a.title=Q),onClick:i[12]||(i[12]=wt(()=>{},["stop"])),onKeypress:Ut(Q=>d(C.id),["enter"])},null,40,po)),[[ot,a.title],[pt]]):(r(),v("span",_o,E(C.title),1))]),_:2},1024),f(o,{class:"ml-4",onClick:i[13]||(i[13]=wt(()=>{},["stop"]))},{default:h(()=>[a.id===C.id?(r(),v("button",{key:0,class:"btn btn-sm btn-link",onClick:Q=>d(C.id)},"\u786E\u8BA4",8,fo)):(r(),v(T,{key:1},[t("button",{class:"btn btn-sm btn-link",onClick:Q=>mt(C)},"\u9009\u62E9",8,vo),t("button",{class:"btn btn-sm btn-link",onClick:Q=>{a.id=C.id,a.title=C.title}},[f(u(Se),{class:"svg-icon"}),mo],8,ho),t("button",{class:"btn btn-sm btn-link",onClick:Q=>m(C)},[f(u(Kt),{class:"svg-icon"}),Bo],8,Fo)],64))]),_:2},1024)]),_:2},1024)]),actions:h(()=>[t("button",{class:"btn btn-sm btn-success-outline",onClick:Q=>w(C)},"\u5BFC\u51FA\u56FE\u50CF",8,bo),t("button",{class:"btn btn-sm btn-success-outline",onClick:Q=>x(C)},"\u5BFC\u51FA",8,$o),t("button",{class:"btn btn-sm btn-danger-outline",onClick:Q=>l(C.id)},"\u5220\u9664",8,xo)]),default:h(()=>[Ft===R.value?(r(),lt(u(ln),{key:0,data:C,"onUpdate:data":Q=>N(Q,C.id)},null,8,["data","onUpdate:data"])):X("",!0)]),_:2},1032,["activeKey","onToggle"]))),128))])]),f(u(bn),{show:at.value,"onUpdate:show":i[20]||(i[20]=C=>at.value=C),onClick:U},{extra:h(()=>[t("div",yo,[f(ut,null,{default:h(()=>[t("label",null,[Co,f(St,{class:"mini-input",min:"0",max:"70",value:u(A).v,"onUpdate:value":i[14]||(i[14]=C=>u(A).v=C)},null,8,["value"])]),t("label",null,[go,f(St,{class:"mini-input",min:"0",max:"16",value:u(A).eq,"onUpdate:value":i[15]||(i[15]=C=>u(A).eq=C)},null,8,["value"])]),t("label",null,[wo,L(t("input",{type:"checkbox","onUpdate:modelValue":i[16]||(i[16]=C=>Ct(S)?S.value=C:null)},null,512),[[yt,u(S)]])]),t("label",null,[Eo,L(t("input",{type:"checkbox","onUpdate:modelValue":i[17]||(i[17]=C=>Ct(y)?y.value=C:null)},null,512),[[yt,u(y)]])]),t("label",null,[ko,L(t("input",{type:"checkbox","onUpdate:modelValue":i[18]||(i[18]=C=>Ct(B)?B.value=C:null)},null,512),[[yt,u(B)]])]),t("label",null,[Do,L(t("input",{type:"checkbox","onUpdate:modelValue":i[19]||(i[19]=C=>Ct(g)?g.value=C:null)},null,512),[[yt,u(g)]])])]),_:1})])]),_:1},8,["show"])])}}});const Jo=nt(jo,[["__scopeId","data-v-6d3f793a"]]);export{Jo as default};
