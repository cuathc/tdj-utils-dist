import{D as e,s as t,i as a,g as l}from"./index.js";import{d as o,o as s,c as n,x as c,y as i,a as r,z as d,A as u,q as p,r as m,B as v,C as f,D as h,F as b,E as y,G as _,T as w,t as x,f as g,H as k,I as C,J as S,b as $}from"./vendor.js";import{u as F,a as E,_ as N}from"./lodash.js";var D=o({props:{type:String},setup:()=>({})});const U={key:0,class:"c-sort-desc"},T={key:1,class:"c-sort-asc"},I={key:2,class:"c-sort-none"};D.render=function(e,t,a,l,o,c){return"DESC"===e.type?(s(),n("span",U)):"ASC"===e.type?(s(),n("span",T)):(s(),n("span",I))};var q=o({props:{hp:Number,patt:Number,pdef:Number,matt:Number,mdef:Number,crit:Number,readonly:Boolean},emits:["update:hp","update:patt","update:pdef","update:matt","update:mdef","update:crit"],setup:(e,{emit:t})=>({update:(e,a)=>{t(`update:${e}`,+a.currentTarget.value)}})});const j=d();c("data-v-27ab2e04");const O={class:"form"},z={class:"form-item"},A=r("label",{for:""},"气血",-1),V={class:"form-item"},R=r("label",{for:""},"物攻",-1),H={class:"form-item"},L=r("label",{for:""},"物防",-1),B={class:"form-item"},J=r("label",{for:""},"法攻",-1),P={class:"form-item"},M=r("label",{for:""},"法防",-1),G={class:"form-item"},K=r("label",{for:""},"会心",-1);i();const Q=j(((e,t,a,l,o,c)=>(s(),n("div",O,[r("div",z,[A,r("input",{type:"number",readonly:e.readonly,value:e.hp,onInput:t[1]||(t[1]=t=>e.update("hp",t))},null,40,["readonly","value"])]),r("div",V,[R,r("input",{type:"number",readonly:e.readonly,value:e.patt,onInput:t[2]||(t[2]=t=>e.update("patt",t))},null,40,["readonly","value"])]),r("div",H,[L,r("input",{type:"number",readonly:e.readonly,value:e.pdef,onInput:t[3]||(t[3]=t=>e.update("pdef",t))},null,40,["readonly","value"])]),r("div",B,[J,r("input",{type:"number",readonly:e.readonly,value:e.matt,onInput:t[4]||(t[4]=t=>e.update("matt",t))},null,40,["readonly","value"])]),r("div",P,[M,r("input",{type:"number",readonly:e.readonly,value:e.mdef,onInput:t[5]||(t[5]=t=>e.update("mdef",t))},null,40,["readonly","value"])]),r("div",G,[K,r("input",{type:"number",readonly:e.readonly,value:e.crit,onInput:t[6]||(t[6]=t=>e.update("crit",t))},null,40,["readonly","value"])])]))));q.render=Q,q.__scopeId="data-v-27ab2e04";var W=o({props:{record:Object,width:String,height:String},emits:["update:record","save"],setup(e,{emit:t}){const a=[["qixue","气血"],["physical_attack","物攻"],["physical_defense","物防"],["magic_attack","法攻"],["magic_defense","法防"],["huixin","会心"]],l=u(e,"record"),o=p((()=>{const t=e.width||600,a=e.height||400;return{width:Number(t)?`${t}px`:t,height:Number(a)?`${a}px`:a}}));return{names:a,model:l,dialogStyle:o,onEditorSave:e=>{t("save",e),t("update:record",void 0)},onEditorCanel:()=>{t("update:record",void 0)},prefixNames:(e,t)=>a.map((([a,l])=>[e.replace("$&",a),t.replace("$&",l)]))}}});const X=d();c("data-v-5c01ac4e");const Y={key:0,class:["modal active"]},Z={class:"modal-body"},ee={class:"models-container"},te={class:"models"},ae={class:"model-item"},le=r("label",null,"ID",-1),oe={class:"input"},se={class:"model-item"},ne=r("label",null,"名称",-1),ce={class:"model-item"},ie=r("label",null,"属相",-1),re=r("option",{value:"炎"},"炎",-1),de=r("option",{value:"雷"},"雷",-1),ue=r("option",{value:"冰"},"冰",-1),pe=r("option",{value:"光"},"光",-1),me=r("option",{value:"暗"},"暗",-1),ve={class:"model-item"},fe=r("label",null,"职业",-1),he=r("option",{value:"铁卫"},"铁卫",-1),be=r("option",{value:"侠客"},"侠客",-1),ye=r("option",{value:"咒师"},"咒师",-1),_e=r("option",{value:"祝由"},"祝由",-1),we=r("option",{value:"御风"},"御风",-1),xe=r("option",{value:"羽士"},"羽士",-1),ge={class:"modal-footer"};i();const ke=X(((e,t,a,l,o,c)=>{const i=m("c-input-text"),d=m("c-input-number"),u=m("c-space");return s(),n(w,{to:"body"},[e.model?(s(),n("div",Y,[r("div",{class:"modal-mask",onClick:t[1]||(t[1]=(...t)=>e.onEditorCanel&&e.onEditorCanel(...t))}),r("div",{class:"modal-dialog",style:e.dialogStyle},[r("div",Z,[r("div",ee,[r("div",te,[r("div",ae,[le,r("div",oe,v(e.model.id),1)]),r("div",se,[ne,r(i,{value:e.model.name,"onUpdate:value":t[2]||(t[2]=t=>e.model.name=t)},null,8,["value"])]),r("div",ce,[ie,f(r("select",{class:"input","onUpdate:modelValue":t[3]||(t[3]=t=>e.model.prop=t)},[re,de,ue,pe,me],512),[[h,e.model.prop]])]),r("div",ve,[fe,f(r("select",{class:"input","onUpdate:modelValue":t[4]||(t[4]=t=>e.model.career=t)},[he,be,ye,_e,we,xe],512),[[h,e.model.career]])])]),(s(),n(b,null,y([["panel_$&","面板$&"],["basic_$&","基础$&"],["equipment1_$&","头部$&"],["equipment2_$&","身体$&"],["equipment3_$&","腰部$&"],["equipment4_$&","手部$&"],["wunei0_$&","主线$&"],["wunei1_$&","上线$&"],["wunei2_$&","下线$&"],["huazhen_$&","化臻$&"],["$&","0级$&"],["$&_cz","$&成长"]],(([t,a])=>r("div",{class:"models",key:t},[(s(!0),n(b,null,y(e.prefixNames(t,a),(([t,a])=>(s(),n("div",{class:"model-item",key:t},[r("label",null,v(a),1),r(d,{value:e.model[t],"onUpdate:value":a=>e.model[t]=a},null,8,["value","onUpdate:value"])])))),128))]))),64))])]),r("div",ge,[r(u,null,{default:X((()=>[r("button",{class:"btn btn-sm btn-primary-outline",onClick:t[5]||(t[5]=t=>e.onEditorSave(e.model))}," 保存 "),r("button",{class:"btn btn-sm btn-danger-outline",onClick:t[6]||(t[6]=t=>e.onEditorCanel())}," 取消 ")])),_:1})])],4)])):_("",!0)])}));W.render=ke,W.__scopeId="data-v-5c01ac4e";var Ce=o({components:{SortIcon:D,PropPanel:q,HeroModelVue:W},setup(){const o=x(e),s=p((()=>t.value.slice().sort(((e,t)=>{switch(m.value){case"basic_qixue":case"basic_physical_attack":case"basic_physical_defense":case"basic_magic_attack":case"basic_magic_defense":case"basic_huixin":return"DESC"===v.value?t[m.value]-e[m.value]:"ASC"===v.value?e[m.value]-t[m.value]:0;default:return 0}})))),n=g(-1),{editor:c,defaultHeroState:i}=F();function r(e){if(e instanceof Error)switch(e.name){case"ConstraintError":alert("数据已经存在");break;default:alert(e.message)}else alert(e)}async function d(){try{await a()}catch(e){r(e)}}function u(e){return new Promise(((t,a)=>{const l=new FileReader;l.onload=()=>{t(JSON.parse(l.result))},l.onerror=()=>{a(l.error)},l.readAsText(e)}))}const m=g("name"),v=g("");t.value&&0!==t.value.length||d();const{show:f,form:h,calc:b,open:y,close:_,toggle:w,translate:k,xinyao:C,huazhen:S}=E();return{editable:n,editor:c,onEditorOpen:e=>{const a=t.value.find((t=>t.id===e));a&&(n.value=e,c.value=N.cloneDeep(a))},onEditorSave:async e=>{n.value=-1;const a=t.value.find((t=>t.id===e.id));if(a){Object.assign(a,e);try{if(!o)return;await o.connect(),await o.put("heroes",N.cloneDeep(a))}catch(l){console.log(l)}}},onEditorCanel:()=>{n.value=-1},sources:t,list:s,add:async function(){try{if(!o)return;const e=i();await o.connect(),delete e.id;const a=await o.add("heroes",e),l=await o.get("heroes",a);if(!l)return;t.value.push(l)}catch(e){r(e)}},remove:async function(e){try{if(!o)return;if(!e.id)return;if(!confirm("确定要删除吗？"))return;await o.connect(),await o.delete("heroes",e.id),t.value=t.value.filter((t=>t.id!==e.id))}catch(a){r(a)}},exportData:function(){const e=new Blob([JSON.stringify(t.value)]),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download="heroes.json",a.click(),URL.revokeObjectURL(a.href)},importData:async function(e){try{const t=e.currentTarget,a=t.files;if(!a)return;if(!o)return;await o.connect(),console.log("导入数据");for(let e=0;e<a.length;e++){const t=await u(a[e]);for(const e of t)e.id=Number(e.weight),await o.put("heroes",e)}t.value="",d()}catch(t){r(t)}},sortName:m,sortType:v,switchSort:function(e){if(m.value===e)switch(v.value){case"DESC":v.value="ASC";break;case"ASC":v.value="";break;default:v.value="DESC"}else m.value=e,v.value="DESC"},loadDefault:function(){l()},toolsShow:f,toolsForm:h,toolsCalc:b,toolsOpen:y,toolsClose:_,toolsToggle:w,toolsTranslate:k,xinyao:C,huazhen:S}}});const Se=d();c("data-v-8ed1684c");const $e={class:"toolbar"},Fe=$("人物列表"),Ee={class:"c-label"},Ne=$(" 星耀 "),De={class:"c-label"},Ue=$(" 化臻 "),Te={class:"c-upload"},Ie={class:"c-upload"},qe=r("button",{class:"btn btn-success"},"导入",-1),je={key:0,class:"transform-popup"},Oe={class:"row"},ze={class:"col-auto"},Ae={class:"col-auto"},Ve={class:"content"},Re={class:"table-wrap"},He={class:"table table-bordered",style:{"min-width":"100%"}},Le=r("colgroup",null,[r("col",{width:"60"}),r("col",{width:"80"}),r("col",{width:"80"}),r("col",{width:"80"}),r("col",{width:"80"}),r("col",{width:"80"}),r("col",{width:"80"}),r("col",{width:"80"}),r("col",{width:"80"}),r("col",{width:"80"}),r("col",{width:"100"})],-1),Be={style:{position:"sticky",top:"100px"}},Je=r("th",null,"#",-1),Pe=r("th",null,"名字",-1),Me=$(" 气血 "),Ge=$(" 物攻 "),Ke=$(" 物防 "),Qe=$(" 法攻 "),We=$(" 法防 "),Xe=$(" 会心 "),Ye=r("th",null,"属性",-1),Ze=r("th",null,"职业",-1),et=r("th",null,"操作",-1),tt={class:"cell-static text-center"},at={class:"cell-static text-center"},lt={class:"cell-static text-center"},ot={class:"cell-static text-center"},st={class:"cell-static text-center"},nt={class:"cell-static text-center"},ct={class:"cell-static text-center"},it={class:"cell-static text-center"},rt={class:"cell-static text-center"},dt={class:"cell-static text-center"},ut={class:"cell-static"};i();const pt=Se(((e,t,a,l,o,c)=>{const i=m("c-col"),d=m("c-space"),u=m("prop-panel"),p=m("c-row"),h=m("SortIcon"),w=m("HeroModelVue");return s(),n(b,null,[r("div",S({class:"wrapper"},e.$attrs),[r("div",$e,[r(p,{flex:"",middle:"",style:{padding:"4px 16px"}},{default:Se((()=>[r(i,{flex:"1 0 auto"},{default:Se((()=>[Fe])),_:1}),r(i,{flex:"0 0 auto"},{default:Se((()=>[r(d,{size:"8"},{default:Se((()=>[r("label",Ee,[f(r("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=t=>e.xinyao=t)},null,512),[[k,e.xinyao]]),Ne]),r("label",De,[f(r("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=t=>e.huazhen=t)},null,512),[[k,e.huazhen]]),Ue])])),_:1}),r("div",Te,[r("button",{class:"btn btn-danger",onClick:t[3]||(t[3]=(...t)=>e.loadDefault&&e.loadDefault(...t))}," 载入默认 ")]),r("div",Ie,[qe,r("input",{type:"file",class:"c-upload-input",accept:"application/json",onInput:t[4]||(t[4]=(...t)=>e.importData&&e.importData(...t))},null,32)]),r("button",{class:"btn btn-success",onClick:t[5]||(t[5]=(...t)=>e.exportData&&e.exportData(...t))},"导出"),r("button",{class:"btn btn-primary",onClick:t[6]||(t[6]=t=>e.add())},"添加"),r("button",{class:"btn btn-primary",onClick:t[7]||(t[7]=(...t)=>e.toolsToggle&&e.toolsToggle(...t))},"转换工具"),r(C,{name:"popup"},{default:Se((()=>[e.toolsShow?(s(),n("div",je,[r("div",Oe,[r("div",ze,[r(u,{hp:e.toolsForm.hp,"onUpdate:hp":t[8]||(t[8]=t=>e.toolsForm.hp=t),patt:e.toolsForm.patt,"onUpdate:patt":t[9]||(t[9]=t=>e.toolsForm.patt=t),pdef:e.toolsForm.pdef,"onUpdate:pdef":t[10]||(t[10]=t=>e.toolsForm.pdef=t),matt:e.toolsForm.matt,"onUpdate:matt":t[11]||(t[11]=t=>e.toolsForm.matt=t),mdef:e.toolsForm.mdef,"onUpdate:mdef":t[12]||(t[12]=t=>e.toolsForm.mdef=t),crit:e.toolsForm.crit,"onUpdate:crit":t[13]||(t[13]=t=>e.toolsForm.crit=t)},null,8,["hp","patt","pdef","matt","mdef","crit"])]),r("div",Ae,[r(u,{hp:e.toolsCalc(e.toolsForm.hp,1.35,1.45),patt:e.toolsCalc(e.toolsForm.patt,1.25,1.35),pdef:e.toolsCalc(e.toolsForm.pdef,1.35,1.55),matt:e.toolsCalc(e.toolsForm.matt,1.25,1.35),mdef:e.toolsCalc(e.toolsForm.mdef,1.35,1.55),crit:e.toolsCalc(e.toolsForm.crit,1.25,1),readonly:""},null,8,["hp","patt","pdef","matt","mdef","crit"])])])])):_("",!0)])),_:1})])),_:1})])),_:1})]),r("div",Ve,[r("div",Re,[r("table",He,[Le,r("thead",Be,[r("tr",null,[Je,Pe,r("th",null,[Me,r(h,{type:"basic_qixue"===e.sortName?e.sortType:"",onClick:t[14]||(t[14]=t=>e.switchSort("basic_qixue"))},null,8,["type"])]),r("th",null,[Ge,r(h,{type:"basic_physical_attack"===e.sortName?e.sortType:"",onClick:t[15]||(t[15]=t=>e.switchSort("basic_physical_attack"))},null,8,["type"])]),r("th",null,[Ke,r(h,{type:"basic_physical_defense"===e.sortName?e.sortType:"",onClick:t[16]||(t[16]=t=>e.switchSort("basic_physical_defense"))},null,8,["type"])]),r("th",null,[Qe,r(h,{type:"basic_magic_attack"===e.sortName?e.sortType:"",onClick:t[17]||(t[17]=t=>e.switchSort("basic_magic_attack"))},null,8,["type"])]),r("th",null,[We,r(h,{type:"basic_magic_defense"===e.sortName?e.sortType:"",onClick:t[18]||(t[18]=t=>e.switchSort("basic_magic_defense"))},null,8,["type"])]),r("th",null,[Xe,r(h,{type:"basic_huixin"===e.sortName?e.sortType:"",onClick:t[19]||(t[19]=t=>e.switchSort("basic_huixin"))},null,8,["type"])]),Ye,Ze,et])]),r("tbody",null,[(s(!0),n(b,null,y(e.list,((t,a)=>(s(),n("tr",{key:t.id,class:"c-user-row"},[r("td",tt,v(a+1),1),r("td",at,v(t.name),1),(s(!0),n(b,null,y([e.toolsTranslate(t)],((e,t)=>(s(),n(b,{key:t},[r("td",lt,v(e.qixue),1),r("td",ot,v(e.patt),1),r("td",st,v(e.pdef),1),r("td",nt,v(e.matt),1),r("td",ct,v(e.mdef),1),r("td",it,v(e.huixin),1)],64)))),128)),r("td",rt,v(t.prop),1),r("td",dt,v(t.career),1),r("td",ut,[r(d,null,{default:Se((()=>[r("button",{class:"btn btn-sm btn-primary-outline",onClick:a=>e.onEditorOpen(t.id)}," 编辑 ",8,["onClick"]),r("button",{class:"btn btn-sm btn-danger-outline",onClick:a=>e.remove(t)}," 删除 ",8,["onClick"])])),_:2},1024)])])))),128))])])])])],16),r(w,{record:e.editor,"onUpdate:record":t[20]||(t[20]=t=>e.editor=t),width:"800",height:"600",onSave:e.onEditorSave},null,8,["record","onSave"])],64)}));Ce.render=pt,Ce.__scopeId="data-v-8ed1684c";export{Ce as default};
