import{d as ut,h as K,a as te,i as lt,O as St,Z as Vt,$ as It,_ as dt,o as E,c as A,b as s,n as q,j as yt,p as V,W as ct,w as Y,G as H,T as ee,y as At,z as Gt,g as kt,D as pt,m as st,f as at,r as oe,a0 as Ct,v as rt,l as U,k as Z,e as m,F as et,s as ot,x as se,V as ne}from"./index.js";import{_ as nt}from"./lodash.js";import{u as le,D as ae}from"./useHeroes.js";const Et=(o,r,h)=>{let f=0,y=0,a=0;o%=360;const n=Math.floor(o/60),b=o/60-n,_=h*(1-r),B=h*(1-r*b),D=h*(1-r*(1-b));switch(n){case 0:f=h,y=D,a=_;break;case 1:f=B,y=h,a=_;break;case 2:f=_,y=h,a=D;break;case 3:f=_,y=B,a=h;break;case 4:f=D,y=_,a=h;break;case 5:f=h,y=_,a=B;break}f=Math.floor(f*255),y=Math.floor(y*255),a=Math.floor(a*255);const T=("00"+f.toString(16)).slice(-2),L=("00"+y.toString(16)).slice(-2),$=("00"+a.toString(16)).slice(-2);return[o,r,h,f,y,a,"#"+T+L+$]},Bt=o=>{let r=0,h=0,f=0,y=0,a=0,n=0;if(/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i.test(o))r=window.parseInt(RegExp.$1,16),h=window.parseInt(RegExp.$2,16),f=window.parseInt(RegExp.$3,16);else if(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i.test(o))r=window.parseInt(RegExp.$1,10),h=window.parseInt(RegExp.$2,10),f=window.parseInt(RegExp.$3,10);else return[0,0,0,0,0,0,"#000000"];y=r/255,a=h/255,n=f/255;let b=y;a>b&&(b=a),n>b&&(b=n);let _=y;a<_&&(_=a),n<_&&(_=n);let B=0,D=0,T=0;b===_?B=0:b===y&&a>=n?B=60*(a-n)/(b-_)+0:b===y&&a<n?B=60*(a-n)/(b-_)+360:b===a?B=60*(n-y)/(b-_)+120:b===n&&(B=60*(y-a)/(b-_)+240),b===0?D=0:D=1-_/b,T=b;const L=("00"+r.toString(16)).slice(-2),$=("00"+h.toString(16)).slice(-2),N=("00"+f.toString(16)).slice(-2);return[Math.floor(B),D,T,r,h,f,"#"+L+$+N]},re=ut({name:"ColorPicker",emits:["update:modelValue"],props:{modelValue:{type:String,required:!0}},setup(o,{emit:r}){const h=K(!1),f=te({set:d=>{r("update:modelValue",d)},get:()=>o.modelValue}),y=lt({h:0,s:0,v:0,r:0,g:0,b:0}),a=lt({rect_down:!1,rect_left:0,rect_bottom:0,ver_down:!1,ver_bottom:0}),n={rect:{left:0,bottom:0,x:0,y:0},ver:{bottom:0,y:0}},b=K(!1),_=()=>{b.value=!0},B=nt.debounce(()=>{b.value=!1},300),D=()=>{_();const d=Et(y.h,y.s,y.v);y.r=d[3],y.g=d[4],y.b=d[5],f.value=d[6],a.ver_bottom=y.h,a.rect_left=y.s*360,a.rect_bottom=y.v*360,B()},T=()=>{_();const d=Bt(`${y.r},${y.g},${y.b}`);y.h=d[0],y.s=d[1],y.v=d[2],f.value=d[6],a.ver_bottom=y.h,a.rect_left=y.s*360,a.rect_bottom=y.v*360,B()},L=d=>{d=d||"#000000";const C=Bt(d);y.h=C[0],y.s=C[1],y.v=C[2],y.r=C[3],y.g=C[4],y.b=C[5],a.ver_bottom=y.h,a.rect_left=y.s*360,a.rect_bottom=y.v*360},$=()=>{const d=Et(a.ver_bottom,a.rect_left/360,a.rect_bottom/360);y.h=d[0],y.s=d[1],y.v=d[2],y.r=d[3],y.g=d[4],y.b=d[5],f.value=d[6]},N=d=>{a.rect_down=!0,n.rect.x=d.clientX,n.rect.y=d.clientY;const C=d.currentTarget,P=C.getBoundingClientRect().left,it=C.getBoundingClientRect().top;n.rect.left=a.rect_left=d.clientX-P,n.rect.bottom=a.rect_bottom=360-(d.clientY-it),$()},j=d=>{if(!a.rect_down)return;const C=d.clientX-n.rect.x,P=d.clientY-n.rect.y;a.rect_left=Math.max(0,Math.min(360,n.rect.left+C)),a.rect_bottom=Math.max(0,Math.min(360,n.rect.bottom-P)),$()},z=()=>{!a.rect_down||(a.rect_down=!1)},u=d=>{a.ver_down=!0,n.ver.y=d.clientY;const P=d.currentTarget.getBoundingClientRect().top;n.ver.bottom=a.ver_bottom=360-(d.clientY-P),$()},F=d=>{if(!a.ver_down)return;const C=d.clientY-n.ver.y;a.ver_bottom=Math.max(0,Math.min(360,n.ver.bottom-C)),$()},I=()=>{!a.ver_down||(a.ver_down=!1)},J=()=>{h.value=!0},O=()=>{h.value=!1};return St(()=>o.modelValue,d=>{a.ver_down||a.rect_down||b.value||L(d)}),L(o.modelValue),Vt(()=>{window.addEventListener("mousemove",j,!1),window.addEventListener("mouseup",z,!1),window.addEventListener("mousemove",F,!1),window.addEventListener("mouseup",I,!1)}),It(()=>{window.removeEventListener("mousemove",j,!1),window.removeEventListener("mouseup",z,!1),window.removeEventListener("mousemove",F,!1),window.removeEventListener("mouseup",I,!1)}),{show:h,color:f,vars:y,state:a,colorRectPointerStart:N,colorVerPointerStart:u,updateHSV:D,updateRGB:T,updateHex:L,onOpen:J,onComfirm:O}}});const xt=o=>(At("data-v-27cd0415"),o=o(),Gt(),o),ye={class:"color-control"},ce={class:"color-picker-layer"},ie={class:"color-picker-view"},ue=xt(()=>s("div",{class:"color-picker-view__label"},"HSV",-1)),de=xt(()=>s("div",{class:"color-picker-view__label"},"RGB",-1)),pe=xt(()=>s("div",{class:"color-picker-view__label"},"Hex",-1));function xe(o,r,h,f,y,a){return E(),A("div",ye,[s("div",{class:"color-preview",style:q({backgroundColor:o.color}),onClick:r[0]||(r[0]=(...n)=>o.onOpen&&o.onOpen(...n))},null,4),(E(),yt(ee,{to:"body"},[V(s("div",{class:"color-picker-mask",onWheel:r[1]||(r[1]=Y(()=>{},["prevent"])),onTouchstart:r[2]||(r[2]=Y(()=>{},["prevent"])),onClick:r[3]||(r[3]=(...n)=>o.onComfirm&&o.onComfirm(...n))},null,544),[[ct,o.show]]),V(s("div",ce,[s("div",{class:"color-picker-rect",style:q(`background-color: hsl(${o.vars.h}deg, 100%, 50%)`),onMousedown:r[4]||(r[4]=Y((...n)=>o.colorRectPointerStart&&o.colorRectPointerStart(...n),["prevent","stop"]))},[s("div",{class:"color-picker-rect-cur",style:q({left:`${o.state.rect_left}px`,bottom:`${o.state.rect_bottom}px`})},null,4)],36),s("div",{class:"color-picker-hue",onMousedown:r[5]||(r[5]=Y((...n)=>o.colorVerPointerStart&&o.colorVerPointerStart(...n),["prevent","stop"]))},[s("div",{class:"color-picker-hue-cur",style:q({bottom:`${o.state.ver_bottom}px`})},null,4)],32),s("div",ie,[s("div",{class:"color-picker-view-color",style:q({background:o.color})},null,4),ue,V(s("input",{type:"number",max:"360",min:"0",step:"1","onUpdate:modelValue":r[6]||(r[6]=n=>o.vars.h=n),class:"color-picker-view__input",onInput:r[7]||(r[7]=(...n)=>o.updateHSV&&o.updateHSV(...n))},null,544),[[H,o.vars.h]]),V(s("input",{type:"number",max:"1",min:"0",step:"0.01","onUpdate:modelValue":r[8]||(r[8]=n=>o.vars.s=n),class:"color-picker-view__input",onInput:r[9]||(r[9]=(...n)=>o.updateHSV&&o.updateHSV(...n))},null,544),[[H,o.vars.s]]),V(s("input",{type:"number",max:"1",min:"0",step:"0.01","onUpdate:modelValue":r[10]||(r[10]=n=>o.vars.v=n),class:"color-picker-view__input",onInput:r[11]||(r[11]=(...n)=>o.updateHSV&&o.updateHSV(...n))},null,544),[[H,o.vars.v]]),de,V(s("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":r[12]||(r[12]=n=>o.vars.r=n),class:"color-picker-view__input",onInput:r[13]||(r[13]=(...n)=>o.updateRGB&&o.updateRGB(...n))},null,544),[[H,o.vars.r]]),V(s("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":r[14]||(r[14]=n=>o.vars.g=n),class:"color-picker-view__input",onInput:r[15]||(r[15]=(...n)=>o.updateRGB&&o.updateRGB(...n))},null,544),[[H,o.vars.g]]),V(s("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":r[16]||(r[16]=n=>o.vars.b=n),class:"color-picker-view__input",onInput:r[17]||(r[17]=(...n)=>o.updateRGB&&o.updateRGB(...n))},null,544),[[H,o.vars.b]]),pe,V(s("input",{type:"text","onUpdate:modelValue":r[18]||(r[18]=n=>o.color=n),class:"color-picker-view__input"},null,512),[[H,o.color]]),s("div",{class:"color-picker-view__enter",onClick:r[19]||(r[19]=(...n)=>o.onComfirm&&o.onComfirm(...n))},"\u786E\u8BA4")])],512),[[ct,o.show]])]))])}const W=dt(re,[["render",xe],["__scopeId","data-v-27cd0415"]]);W.install=function(o){o.component(W.name,W)};const fe={draggable:!0,class:"grid-item"},ve={key:0,class:"tg lt"},me={key:1,class:"tg rt"},be={key:2,class:"tg rb"},he={class:"overlay-dot"},ge={class:"overlay-selected"},_e=ut({__name:"GridItem",props:{disabled:{type:Boolean},selected:{type:Boolean},dot:{type:Boolean},item:null},setup(o){return(r,h)=>(E(),A("div",fe,[o.item?(E(),A("div",{key:0,class:kt(["color-unit",{disabled:o.disabled}]),style:q({fontSize:`${o.item.data.size}px`,color:o.item.style.color,backgroundColor:o.item.style.bgcolor,backgroundImage:o.item.style.image?`url(${o.item.style.image})`:"",opacity:o.item.style.opacity})},[pt(st(o.item.data.txt)+" ",1),o.item.data.actorId?(E(),A("i",ve,st(o.item.data.actorId),1)):at("",!0),o.item.data.sup?(E(),A("i",me,st(o.item.data.sup),1)):at("",!0),o.item.data.sub?(E(),A("i",be,st(o.item.data.sub),1)):at("",!0)],6)):(E(),A("div",{key:1,class:kt(["color-unit",{disabled:o.disabled}])},[oe(r.$slots,"default",{},void 0,!0)],2)),V(s("div",he,null,512),[[ct,o.dot]]),V(s("div",ge,null,512),[[ct,o.selected]])]))}});const X=dt(_e,[["__scopeId","data-v-6c3c6c6f"]]);var x=(o=>(o[o.NONE=0]="NONE",o[o.GUARD=1]="GUARD",o[o.SHEEP=2]="SHEEP",o[o.ATTACKER=3]="ATTACKER",o[o.FLY=4]="FLY",o[o.BLOCKED=5]="BLOCKED",o[o.CLIFF=6]="CLIFF",o))(x||{});function we(){const o=K(15),r=K(15),h=K(0),f=K([]),y=K([]),a=[{color:"#202020",bgcolor:"#f5fff0"},{color:"#f9f9fa",bgcolor:"#ff3333"},{color:"#f9f9fa",bgcolor:"#00d659"},{color:"#f9f9fa",bgcolor:"#369af7"},{color:"#f9f9fa",bgcolor:"#fec02f"},{color:"#f9f9fa",bgcolor:"#a865e7"}],n=()=>({actorId:0,actorType:x.NONE,size:14,txt:"",disabled:!1}),b=()=>({color:a[0].color,bgcolor:a[0].bgcolor,image:"",opacity:1}),_=()=>({d:0,d1:0,d2:0,q:0}),B=()=>({x:0,y:0,data:n(),style:b(),state:_()});function D(u){u.data=n(),u.style=b(),u.state=_()}function T(){h.value=0,f.value.forEach(u=>{u.forEach(F=>{D(F)})}),y.value=[]}function L(u,F){const I=[];for(let J=0;J<u;J++){const O=[];for(let d=0;d<F;d++){const C=B();C.x=d,C.y=J,O.push(C)}I.push(O)}f.value=I}function $(u,F){r.value=u,o.value=F,z()}function N(u,F){var I;return(I=f.value[F])==null?void 0:I[u]}function j(u){for(let F=0;F<o.value;F++)for(let I=0;I<r.value;I++)u(f.value[F][I])}function z(){L(o.value,r.value)}return z(),{rows:o,cols:r,actorId:h,grids:f,selects:y,gridColors:a,defGridData:n,defGridStyle:b,defGridState:_,defGrid:B,cleanGrid:D,cleanGrids:T,setSize:$,getGrid:N,gridForEach:j}}const Dt=""+new URL("../assets/cliff.svg",import.meta.url).href,Ft=""+new URL("../assets/block.svg",import.meta.url).href,ke=[{name:"\u7A7A\u767D\u573A\u666F",width:15,height:15,data:[]},{name:"\u5316\u8352\u5E7B\u5883",width:17,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:14,y:10,type:5},{x:15,y:10,type:5},{x:16,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:15,y:9,type:5},{x:16,y:9,type:5},{x:0,y:8,type:5},{x:7,y:8,type:6},{x:8,y:8,type:6},{x:9,y:8,type:6},{x:16,y:8,type:5},{x:6,y:7,type:6},{x:7,y:7,type:6},{x:8,y:7,type:6},{x:9,y:7,type:6},{x:10,y:7,type:6},{x:5,y:6,type:6},{x:6,y:6,type:6},{x:10,y:6,type:6},{x:11,y:6,type:6},{x:5,y:4,type:6},{x:6,y:4,type:6},{x:10,y:4,type:6},{x:11,y:4,type:6},{x:6,y:3,type:6},{x:7,y:3,type:6},{x:8,y:3,type:6},{x:9,y:3,type:6},{x:10,y:3,type:6},{x:0,y:2,type:5},{x:7,y:2,type:6},{x:8,y:2,type:6},{x:9,y:2,type:6},{x:16,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:15,y:1,type:5},{x:16,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:14,y:0,type:5},{x:15,y:0,type:5},{x:16,y:0,type:5}]},{name:"\u96EA\u5CAD\u5E7B\u5883",width:15,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:5,y:10,type:6},{x:6,y:10,type:6},{x:7,y:10,type:6},{x:8,y:10,type:6},{x:9,y:10,type:6},{x:12,y:10,type:5},{x:13,y:10,type:5},{x:14,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:2,y:9,type:5},{x:3,y:9,type:6},{x:4,y:9,type:6},{x:5,y:9,type:6},{x:6,y:9,type:6},{x:7,y:9,type:6},{x:8,y:9,type:6},{x:9,y:9,type:6},{x:10,y:9,type:6},{x:11,y:9,type:6},{x:12,y:9,type:5},{x:13,y:9,type:5},{x:14,y:9,type:5},{x:0,y:8,type:5},{x:1,y:8,type:5},{x:2,y:8,type:5},{x:3,y:8,type:6},{x:11,y:8,type:6},{x:12,y:8,type:5},{x:13,y:8,type:5},{x:14,y:8,type:5},{x:6,y:6,type:6},{x:7,y:6,type:6},{x:8,y:6,type:6},{x:3,y:5,type:6},{x:11,y:5,type:6},{x:6,y:4,type:6},{x:7,y:4,type:6},{x:8,y:4,type:6},{x:0,y:2,type:5},{x:1,y:2,type:5},{x:2,y:2,type:5},{x:3,y:2,type:6},{x:11,y:2,type:6},{x:12,y:2,type:5},{x:13,y:2,type:5},{x:14,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:2,y:1,type:5},{x:3,y:1,type:6},{x:4,y:1,type:6},{x:5,y:1,type:6},{x:6,y:1,type:6},{x:7,y:1,type:6},{x:8,y:1,type:6},{x:9,y:1,type:6},{x:10,y:1,type:6},{x:11,y:1,type:6},{x:12,y:1,type:5},{x:13,y:1,type:5},{x:14,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:6},{x:6,y:0,type:6},{x:7,y:0,type:6},{x:8,y:0,type:6},{x:9,y:0,type:6},{x:12,y:0,type:5},{x:13,y:0,type:5},{x:14,y:0,type:5}]},{name:"\u5730\u754C\u5E7B\u5883",width:17,height:13,data:[{x:0,y:12,type:5},{x:1,y:12,type:5},{x:2,y:12,type:5},{x:5,y:12,type:6},{x:6,y:12,type:6},{x:7,y:12,type:6},{x:8,y:12,type:6},{x:9,y:12,type:6},{x:10,y:12,type:6},{x:11,y:12,type:6},{x:14,y:12,type:5},{x:15,y:12,type:5},{x:16,y:12,type:5},{x:0,y:11,type:5},{x:1,y:11,type:5},{x:2,y:11,type:5},{x:6,y:11,type:6},{x:10,y:11,type:6},{x:14,y:11,type:5},{x:15,y:11,type:5},{x:16,y:11,type:5},{x:0,y:10,type:5},{x:1,y:10,type:5},{x:6,y:10,type:6},{x:10,y:10,type:6},{x:15,y:10,type:5},{x:16,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:6,y:9,type:6},{x:7,y:9,type:6},{x:8,y:9,type:6},{x:9,y:9,type:6},{x:10,y:9,type:6},{x:15,y:9,type:5},{x:16,y:9,type:5},{x:7,y:8,type:6},{x:8,y:8,type:6},{x:9,y:8,type:6},{x:7,y:4,type:6},{x:8,y:4,type:6},{x:9,y:4,type:6},{x:0,y:3,type:5},{x:1,y:3,type:5},{x:6,y:3,type:6},{x:7,y:3,type:6},{x:8,y:3,type:6},{x:9,y:3,type:6},{x:10,y:3,type:6},{x:15,y:3,type:5},{x:16,y:3,type:5},{x:0,y:2,type:5},{x:1,y:2,type:5},{x:6,y:2,type:6},{x:10,y:2,type:6},{x:15,y:2,type:5},{x:16,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:2,y:1,type:5},{x:6,y:1,type:6},{x:10,y:1,type:6},{x:14,y:1,type:5},{x:15,y:1,type:5},{x:16,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:6},{x:6,y:0,type:6},{x:7,y:0,type:6},{x:8,y:0,type:6},{x:9,y:0,type:6},{x:10,y:0,type:6},{x:11,y:0,type:6},{x:14,y:0,type:5},{x:15,y:0,type:5},{x:16,y:0,type:5}]},{name:"\u7ED3\u754C\u5E7B\u5883",width:11,height:11,data:[{x:5,y:8,type:5},{x:2,y:5,type:5},{x:5,y:5,type:5},{x:8,y:5,type:5},{x:5,y:2,type:5}]},{name:"\u57CE\u9685\u5E7B\u5883",width:15,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:5,y:10,type:5},{x:6,y:10,type:5},{x:7,y:10,type:5},{x:8,y:10,type:5},{x:9,y:10,type:5},{x:12,y:10,type:5},{x:13,y:10,type:5},{x:14,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:6,y:9,type:5},{x:8,y:9,type:5},{x:13,y:9,type:5},{x:14,y:9,type:5},{x:0,y:8,type:5},{x:14,y:8,type:5},{x:10,y:6,type:5},{x:5,y:5,type:5},{x:9,y:5,type:5},{x:4,y:4,type:5},{x:0,y:2,type:5},{x:14,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:6,y:1,type:5},{x:8,y:1,type:5},{x:13,y:1,type:5},{x:14,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:5},{x:6,y:0,type:5},{x:7,y:0,type:5},{x:8,y:0,type:5},{x:9,y:0,type:5},{x:12,y:0,type:5},{x:13,y:0,type:5},{x:14,y:0,type:5}]},{name:"\u6D1E\u7A74\u5E7B\u5883",width:11,height:11,data:[{x:10,y:10,type:5},{x:10,y:9,type:5},{x:6,y:8,type:6},{x:7,y:8,type:6},{x:10,y:8,type:5},{x:6,y:7,type:6},{x:7,y:7,type:6},{x:8,y:7,type:6},{x:2,y:3,type:6},{x:3,y:3,type:6},{x:4,y:3,type:6},{x:0,y:2,type:5},{x:3,y:2,type:6},{x:4,y:2,type:6},{x:0,y:1,type:5},{x:0,y:0,type:5}]},{name:"\u5996\u5C71\u5E7B\u5883",width:17,height:11,data:[]}],g=o=>(At("data-v-a098bd50"),o=o(),Gt(),o),Ce={class:"wrapper"},Ee={class:"toolbar"},Be={class:"setting"},De={class:"label-control"},Fe=g(()=>s("span",null,"\u7F16\u8F91\u6A21\u5F0F\xA0",-1)),Se=g(()=>s("option",{value:1},"\u7F16\u8F91\u7F51\u683C",-1)),Ve=g(()=>s("option",{value:2},"\u7F51\u683C\u4E0A\u8272",-1)),Ie=g(()=>s("option",{value:3},"\u9009\u62E9\u5F62\u72B6",-1)),Ae=g(()=>s("option",{value:4},"\u62A4\u536B\u8BA1\u7B97",-1)),Ge=[Se,Ve,Ie,Ae],$e={class:"label-control"},Me=g(()=>s("span",null,"\u8303\u56F4\xA0",-1)),Le={class:"label-control"},Re=g(()=>s("span",null,"\u5F62\u72B6\xA0",-1)),Ue=g(()=>s("option",{value:1},"\u83F1\u5F62",-1)),He=g(()=>s("option",{value:2},"\u5708\u6570",-1)),Te=[Ue,He],Ne={class:"label-control"},Ke=g(()=>s("span",null,"\u6392\u5E8F\xA0",-1)),qe=g(()=>s("option",{value:1},"\u8DDD\u79BBX",-1)),ze=g(()=>s("option",{value:2},"\u8DDD\u79BBY",-1)),Oe=g(()=>s("option",{value:3},"X\u4F18\u5148",-1)),Pe=g(()=>s("option",{value:4},"Y\u4F18\u5148",-1)),Xe=[qe,ze,Oe,Pe],je=g(()=>s("button",{class:"btn"},"\u9884\u8BBE\u573A\u666F",-1)),Je=["onClick"],We=["onClick"],Ze={class:"color-container"},Ye={class:"label-control"},Qe=g(()=>s("span",null,"\u9884\u89C8\xA0",-1)),to=pt(" E "),eo={class:"label-control"},oo=g(()=>s("span",null,"\u6587\u5B57\xA0",-1)),so={class:"label-control"},no=g(()=>s("span",null,"\u80CC\u666F\xA0",-1)),lo=g(()=>s("label",{class:"label-control"},[s("span",null,"\u9884\u8BBE\xA0")],-1)),ao={class:"color-tpls"},ro=pt(" E "),yo={width:"32",height:"32",viewBox:"0 0 24 24",fill:"#a9a9a9",style:{"pointer-events":"none"}},co=g(()=>s("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"},null,-1)),io=[co],uo={class:"props-container"},po={key:0,class:"props-content"},xo={class:"label-control"},fo=g(()=>s("span",null,"\u9884\u89C8\xA0",-1)),vo={class:"label-control"},mo=g(()=>s("span",null,"\u6587\u5B57\xA0",-1)),bo={class:"label-control"},ho=g(()=>s("span",null,"\u80CC\u666F\xA0",-1)),go={class:"label-control"},_o=g(()=>s("span",null,"\u5927\u5C0F\xA0",-1)),wo={class:"label-control"},ko=g(()=>s("span",null,"Id\xA0",-1)),Co={class:"label-control"},Eo=g(()=>s("span",null,"\u7C7B\u578B\xA0",-1)),Bo=["value"],Do=["value"],Fo=["value"],So=["value"],Vo=["value"],Io=["value"],Ao=["value"],Go={class:"label-control"},$o=g(()=>s("span",null,"\u5185\u5BB9\xA0",-1)),Mo={class:"content"},Lo={class:"grids"},Ro={class:"heroes"},Uo=ut({__name:"Grids",setup(o){const{rows:r,cols:h,actorId:f,grids:y,selects:a,gridColors:n,defGridData:b,defGridStyle:_,defGridState:B,defGrid:D,cleanGrid:T,cleanGrids:L,setSize:$,getGrid:N,gridForEach:j}=we(),z=K(),u=lt({editor:1,selectRange:5,shape:1,sortType:1,color:n[0].color,bgcolor:n[0].bgcolor}),F=D();F.style.image=Ft,F.data.actorType=x.BLOCKED;const I=D();I.style.image=Dt,I.data.actorType=x.CLIFF;function J(e){u.color=e.color,u.bgcolor=e.bgcolor}const{heroes:O}=le(),d=Ct(D()),C=Ct(O.value.map(e=>{const t=D();return t.style.image=`https://media.zlongame.com/media/news/cn/tdj/info/data/heroicon/${e.hero_icon}.png`,t}));St(O,()=>{C.value=O.value.map(e=>{const t=D();return t.style.image=`https://media.zlongame.com/media/news/cn/tdj/info/data/heroicon/${e.hero_icon}.png`,t})});function P(e,t,p,v){const c=[];return j(i=>{i.state=B()}),j(i=>{const l=Math.abs(e-i.x),S=Math.abs(t-i.y),G=l+S,R=Math.max(l,S),M=l>1?l-1:l+S>1?S-1:S;switch(v){case 1:G<=p&&(i.state.d=G,i.state.q=R,i.state.d1=M,c.push(i));break;case 2:Math.abs(l)<=p&&Math.abs(S)<=p&&(i.state.d=G,i.state.q=R,i.state.d1=M,c.push(i));break}}),c}function it(e,t,p,v,c,i,l){const S=P(e,t,p,v);switch(S.forEach(G=>{G.style.color=i,G.style.bgcolor=l}),a.value=S,c){case 1:a.value.sort($t);break;case 2:a.value.sort(ft);break;case 3:a.value.sort(Mt);break;case 4:a.value.sort(Lt);break}for(let G=0;G<a.value.length;G++)a.value[G].data.txt=String(G+1)}function $t(e,t){return e.state.q!==t.state.q?e.state.q-t.state.q:e.state.d!==t.state.d?e.state.d-t.state.d:e.x!==t.x?e.x-t.x:e.y!==t.y?e.y-t.y:0}function ft(e,t){return e.state.q!==t.state.q?e.state.q-t.state.q:e.state.d!==t.state.d?e.state.d-t.state.d:e.y!==t.y?e.y-t.y:e.x!==t.x?e.x-t.x:0}function Mt(e,t){return e.x!==t.x?e.x-t.x:e.y!==t.y?e.y-t.y:0}function Lt(e,t){return e.y!==t.y?e.y-t.y:e.x!==t.x?e.x-t.x:0}const w=lt({enabled:!1});function Rt(){L()}function vt(){w.enabled=!1}function Ut(e,t){var p;switch(u.editor){case 1:case 4:w.current=t,(p=z.value)==null||p.focus();break;case 3:L(),it(t.x,t.y,u.selectRange,u.shape,u.sortType,u.color,u.bgcolor);break}}function Ht(e,t){if(e.button===0)switch(u.editor){case 2:{w.enabled=!0,t.style.color=u.color,t.style.bgcolor=u.bgcolor;break}}}function Tt(e,t){e.button===0&&w.enabled&&(t.style.color=u.color,t.style.bgcolor=u.bgcolor)}function Nt(){w.current=void 0}const Q=K({width:15,height:15});function Kt(){try{const e=localStorage.getItem("grids");if(!e)return;const t=JSON.parse(e);Q.value=t}catch{}}function mt(){Q.value={width:h.value,height:r.value,data:nt.cloneDeep(y.value)},localStorage.setItem("grids",JSON.stringify(Q.value))}function qt(){const e=Q.value;!e.data||($(e.width,e.height),y.value=nt.cloneDeep(e.data))}function zt(e){$(e.width,e.height),e.data.forEach(t=>{const p=N(t.x,t.y);if(!!p)switch(t.type){case x.CLIFF:p.style.image=Dt,p.data.actorType=x.CLIFF;break;case x.BLOCKED:p.style.image=Ft,p.data.actorType=x.BLOCKED;break}})}function Ot(){const e=w.current;if(!e)return;Q.value||mt();let t,p,v=[];for(t=e.x-2;t<=e.x+2;t++)for(p=e.y-2;p<=e.y+2;p++){const l=N(t,p);if(!!l)if(l.x===e.x&&l.y===e.y){const S=v[0];S&&(v.push(S),v[0]=l)}else v.push(l)}v=v.filter(l=>l.data.actorId>0&&l.data.actorType!==x.BLOCKED&&l.data.actorType!==x.CLIFF&&!(l.x===e.x&&l.y===e.y));const c=v.map(l=>({data:l.data,style:l.style}));v.forEach(l=>{T(l)});const i=P(e.x,e.y,4,2).filter(l=>l.data.actorType!==x.BLOCKED&&!(l.x===e.x&&l.y===e.y)).sort(ft).map(l=>[l.x,l.y]);for(const l of c)for(const[S,G]of i){const R=N(S,G);if(!!R&&!(R.data.actorId>0)&&R.data.actorType!==x.BLOCKED&&!(R.data.actorType===x.CLIFF&&l.data.actorType!==x.FLY)){R.data=l.data,R.style=l.style;break}}}const k=lt({}),bt=["#ffffff00","#FF3C4132","#0EBEFF32","#48CF7432","#FCD00032","#80008032"],Pt=(e,t)=>{switch(u.editor){case 2:e.preventDefault();break;default:k.grid=t,k.action="swap",e.dataTransfer&&(e.dataTransfer.effectAllowed="move")}},Xt=(e,t)=>{const p=D();p.style.color=t.color,p.style.bgcolor=t.bgcolor,p.data.txt="E",k.grid=p,k.action="color"},ht=(e,t)=>{k.grid=nt.cloneDeep(t),k.action="other"},gt=(e,t)=>{k.grid=nt.cloneDeep(t),k.action="image"},jt=(e,t)=>{if(e.preventDefault(),!k.grid)return;const p=k.grid.data,v=k.grid.style;switch(k.action){case"color":t.data.actorId||(t.data.actorId=++f.value),t.style.color=v.color,t.style.bgcolor=v.bgcolor;break;case"image":t.data.actorId||(t.data.actorId=++f.value),t.style.image=v.image;break;case"swap":k.grid.data=t.data,k.grid.style=t.style,t.data=p,t.style=v;break;case"other":t.style=v,t.data=p;break}k.grid=void 0,k.action=void 0,u.editor===4&&tt()};function Jt(e,t){let p=e[0].state[t];for(let v=1;v<e.length;v++)e[v].state[t]<p&&(p=e[v].state[t]);return p}function _t(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function wt(e,t,p){e.sort((l,S)=>+l.data.actorId-+S.data.actorId),e.forEach(l=>{l.state.d1=_t(l,p),l.state.d2=_t(l,t),l.data.guard=!1});const v=Jt(e,"d1");if(e=e.filter(l=>l.state.d1===v),e.length===1)return e[0];let c=e[0],i=e.length;for(;i--;)if(e[i].state.d2<c.state.d2){c=e[i];break}return c}function Wt(){$(15,15),f.value=0;const e=[{x:7,y:9,txt:"",type:x.GUARD,bg:"#0ebeff"},{x:9,y:7,txt:"",type:x.GUARD,bg:"#0ebeff"},{x:7,y:5,txt:"",type:x.GUARD,bg:"#0ebeff"},{x:5,y:7,txt:"",type:x.GUARD,bg:"#0ebeff"},{x:8,y:6,txt:"",type:x.ATTACKER,bg:"#ff3c41"},{x:7,y:7,txt:"",type:x.SHEEP,bg:"#fcd000"}];for(const t of e){const p=N(t.x,t.y);!p||(p.data.actorId=++f.value,p.data.actorType=t.type,p.data.txt=t.txt,p.data.disabled=!1,p.style.bgcolor=t.bg)}u.editor=4}const tt=()=>{let e=y.value.flat();e.forEach(i=>i.style.opacity=1),e=e.filter(i=>!i.data.disabled);const t=e.filter(i=>i.data.actorType===x.ATTACKER)[0],p=e.filter(i=>i.data.actorType===x.SHEEP)[0],v=e.filter(i=>i.data.actorType===x.GUARD);if(!p||v.length===0){alert("\u7F3A\u5C11\u89D2\u8272\uFF0C\u5C06\u81EA\u52A8\u751F\u6210"),Wt(),tt();return}const c=e.filter(i=>!i.data.disabled).filter(i=>i.data.actorType===x.NONE);for(const i of c){const l=wt(v,i,p);i.style.image=l.style.image,i.style.bgcolor=bt[l.data.actorId]||bt[0],l.style.image?i.data.sup="":i.data.sup=String(l.data.actorId),i.style.opacity=.6}if(t){const i=wt(v,t,p);i.data.guard=!0}},Zt=e=>{if(e.data.disabled=!e.data.disabled,u.editor===4){switch(e.data.actorType){case x.ATTACKER:case x.SHEEP:e.data.disabled=!1;break}tt()}},Yt=e=>{!k.grid||!e.dataTransfer||k.action==="swap"&&(u.editor===4&&k.grid.data.actorType===x.SHEEP||e.preventDefault())},Qt=e=>{if(!!k.grid&&!!e)switch(k.action){case"swap":e.data=b(),e.style=_(),e.state=B(),k.grid=void 0,k.action=void 0,u.editor===4&&tt()}};return Vt(()=>{Kt(),window.addEventListener("mouseup",vt,!1)}),It(()=>{window.removeEventListener("mouseup",vt,!1)}),(e,t)=>{const p=se("c-space"),v=ne("autofocus");return E(),A("div",Ce,[s("div",Ee,[s("div",Be,[s("label",De,[Fe,V(s("select",{"onUpdate:modelValue":t[0]||(t[0]=c=>u.editor=c)},Ge,512),[[rt,u.editor,void 0,{number:!0}]])]),s("label",$e,[Me,V(s("input",{type:"number",min:"0","onUpdate:modelValue":t[1]||(t[1]=c=>u.selectRange=c),style:{width:"5em"}},null,512),[[H,u.selectRange]])]),s("label",Le,[Re,V(s("select",{"onUpdate:modelValue":t[2]||(t[2]=c=>u.shape=c)},Te,512),[[rt,u.shape]])]),s("label",Ne,[Ke,V(s("select",{"onUpdate:modelValue":t[3]||(t[3]=c=>u.sortType=c)},Xe,512),[[rt,u.sortType]])]),s("button",{class:"btn",onClick:Rt},"\u6E05\u7A7A"),s("button",{class:"btn",onClick:tt},"\u8BA1\u7B97\u62A4\u536B"),s("button",{class:"btn btn-success",onClick:mt},"\u4FDD\u5B58\u5E03\u5C40"),s("button",{class:"btn btn-success",onClick:qt},"\u8FD8\u539F\u5E03\u5C40"),at("",!0),U(m(ae),null,{popover:Z(({onClose:c})=>[s("div",{class:"list",onClick:i=>c()},[(E(!0),A(et,null,ot(m(ke),(i,l)=>(E(),A("div",{class:"list-item",key:l,onClick:S=>zt(i)},st(i.name),9,We))),128))],8,Je)]),default:Z(()=>[je]),_:1})]),s("div",Ze,[U(p,null,{default:Z(()=>[s("label",Ye,[Qe,U(m(X),{draggable:!1,style:q([`--color:${u.color};--bgcolor:${u.bgcolor}`])},{default:Z(()=>[to]),_:1},8,["style"])]),s("label",eo,[oo,U(m(W),{modelValue:u.color,"onUpdate:modelValue":t[4]||(t[4]=c=>u.color=c)},null,8,["modelValue"])]),s("label",so,[no,U(m(W),{modelValue:u.bgcolor,"onUpdate:modelValue":t[5]||(t[5]=c=>u.bgcolor=c)},null,8,["modelValue"])]),lo,s("div",ao,[(E(!0),A(et,null,ot(m(n),(c,i)=>(E(),yt(m(X),{key:i,selected:u.bgcolor===c.bgcolor,style:q([`--color:${c.color};--bgcolor:${c.bgcolor}`]),onClick:l=>J(c),onDragstart:l=>Xt(l,c)},{default:Z(()=>[ro]),_:2},1032,["selected","style","onClick","onDragstart"]))),128)),U(m(X),{item:m(I),onDragstart:t[6]||(t[6]=c=>ht(c,m(I)))},null,8,["item"]),U(m(X),{item:m(F),onDragstart:t[7]||(t[7]=c=>ht(c,m(F)))},null,8,["item"])]),s("div",{class:"trush",onDragover:Yt,onDrop:t[8]||(t[8]=c=>Qt(k.grid))},[(E(),A("svg",yo,io))],32)]),_:1})]),s("div",uo,[w.current?(E(),A("div",po,[U(p,null,{default:Z(()=>[s("label",xo,[fo,U(m(X),{draggable:!1,style:q([`--color:${w.current.style.color};--bgcolor:${w.current.style.bgcolor}`]),item:w.current},null,8,["style","item"])]),s("label",vo,[mo,U(m(W),{modelValue:w.current.style.color,"onUpdate:modelValue":t[9]||(t[9]=c=>w.current.style.color=c)},null,8,["modelValue"])]),s("label",bo,[ho,U(m(W),{modelValue:w.current.style.bgcolor,"onUpdate:modelValue":t[10]||(t[10]=c=>w.current.style.bgcolor=c)},null,8,["modelValue"])]),s("label",go,[_o,V(s("input",{type:"number",style:{width:"4em"},min:"12",step:"1","onUpdate:modelValue":t[11]||(t[11]=c=>w.current.data.size=c)},null,512),[[H,w.current.data.size]])]),s("label",wo,[ko,V(s("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=c=>w.current.data.actorId=c),style:{width:"4em"}},null,512),[[H,w.current.data.actorId]])]),s("label",Co,[Eo,V(s("select",{"onUpdate:modelValue":t[13]||(t[13]=c=>w.current.data.actorType=c)},[s("option",{value:m(x).NONE},"\u65E0",8,Bo),s("option",{value:m(x).GUARD},"\u62A4\u536B",8,Do),s("option",{value:m(x).SHEEP},"\u9776\u5B50",8,Fo),s("option",{value:m(x).ATTACKER},"\u653B\u51FB\u8005",8,So),s("option",{value:m(x).FLY},"\u98DE\u884C",8,Vo),s("option",{value:m(x).BLOCKED},"\u969C\u788D",8,Io),s("option",{value:m(x).CLIFF},"\u60AC\u5D16",8,Ao)],512),[[rt,w.current.data.actorType]])]),s("label",Go,[$o,V(s("input",{type:"text",ref_key:"txtInput",ref:z,"onUpdate:modelValue":t[14]||(t[14]=c=>w.current.data.txt=c)},null,512),[[v],[H,w.current.data.txt]])]),s("button",{class:"btn",onClick:Nt},"\u5B8C\u6210"),s("button",{class:"btn btn-success",onClick:Ot},"\u602A\u529B\u4E71\u795E")]),_:1})])):at("",!0)])]),s("div",Mo,[s("div",Lo,[(E(!0),A(et,null,ot(m(y),(c,i)=>(E(),A("div",{class:"grids-row",key:i},[(E(!0),A(et,null,ot(c,(l,S)=>{var G,R;return E(),yt(m(X),{key:S,draggable:!0,selected:l.x===((G=w.current)==null?void 0:G.x)&&l.y===((R=w.current)==null?void 0:R.y),disabled:l.data.disabled,dot:l.data.guard,item:l,onDragstart:M=>Pt(M,l),onDragover:t[15]||(t[15]=Y(()=>{},["prevent"])),onDrop:M=>jt(M,l),onContextmenu:Y(M=>Zt(l),["prevent"]),onClick:M=>Ut(M,l),onMousedown:M=>Ht(M,l),onMouseenter:M=>Tt(M,l)},null,8,["selected","disabled","dot","item","onDragstart","onDrop","onContextmenu","onClick","onMousedown","onMouseenter"])}),128))]))),128))]),s("div",Ro,[U(m(X),{item:m(d),onDragstart:t[16]||(t[16]=c=>gt(c,m(d)))},null,8,["item"]),(E(!0),A(et,null,ot(m(C),(c,i)=>(E(),yt(m(X),{key:i,item:c,onDragstart:l=>gt(l,c)},null,8,["item","onDragstart"]))),128))])])])}}});const Ko=dt(Uo,[["__scopeId","data-v-a098bd50"]]);export{Ko as default};
