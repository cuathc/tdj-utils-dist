import{d as dt,h as P,a as ee,i as it,O as St,Z as Vt,$ as It,_ as pt,o as C,c as S,b as n,n as K,j as ut,p as D,W as ct,w as ot,G as T,T as oe,y as Gt,z as $t,f as J,g as kt,m as lt,r as ne,a0 as Ct,v as rt,l as O,k as tt,e as b,F as et,s as at,x as se,q as re,D as Mt,V as ae}from"./index.js";import{_ as yt}from"./lodash.js";import{u as le,D as ie}from"./useHeroes.js";const Et=(e,i,w)=>{let p=0,u=0,l=0;e%=360;const r=Math.floor(e/60),f=e/60-r,k=w*(1-i),E=w*(1-i*f),A=w*(1-i*(1-f));switch(r){case 0:p=w,u=A,l=k;break;case 1:p=E,u=w,l=k;break;case 2:p=k,u=w,l=A;break;case 3:p=k,u=E,l=w;break;case 4:p=A,u=k,l=w;break;case 5:p=w,u=k,l=E;break}p=Math.floor(p*255),u=Math.floor(u*255),l=Math.floor(l*255);const N=("00"+p.toString(16)).slice(-2),U=("00"+u.toString(16)).slice(-2),G=("00"+l.toString(16)).slice(-2);return[e,i,w,p,u,l,"#"+N+U+G]},Bt=e=>{let i=0,w=0,p=0,u=0,l=0,r=0;if(/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i.test(e))i=window.parseInt(RegExp.$1,16),w=window.parseInt(RegExp.$2,16),p=window.parseInt(RegExp.$3,16);else if(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i.test(e))i=window.parseInt(RegExp.$1,10),w=window.parseInt(RegExp.$2,10),p=window.parseInt(RegExp.$3,10);else return[0,0,0,0,0,0,"#000000"];u=i/255,l=w/255,r=p/255;let f=u;l>f&&(f=l),r>f&&(f=r);let k=u;l<k&&(k=l),r<k&&(k=r);let E=0,A=0,N=0;f===k?E=0:f===u&&l>=r?E=60*(l-r)/(f-k)+0:f===u&&l<r?E=60*(l-r)/(f-k)+360:f===l?E=60*(r-u)/(f-k)+120:f===r&&(E=60*(u-l)/(f-k)+240),f===0?A=0:A=1-k/f,N=f;const U=("00"+i.toString(16)).slice(-2),G=("00"+w.toString(16)).slice(-2),X=("00"+p.toString(16)).slice(-2);return[Math.floor(E),A,N,i,w,p,"#"+U+G+X]},ue=dt({name:"ColorPicker",emits:["update:modelValue"],props:{modelValue:{type:String,required:!0}},setup(e,{emit:i}){const w=P(!1),p=ee({set:c=>{i("update:modelValue",c)},get:()=>e.modelValue}),u=it({h:0,s:0,v:0,r:0,g:0,b:0}),l=it({rect_down:!1,rect_left:0,rect_bottom:0,ver_down:!1,ver_bottom:0}),r={rect:{left:0,bottom:0,x:0,y:0},ver:{bottom:0,y:0}},f=P(!1),k=()=>{f.value=!0},E=yt.debounce(()=>{f.value=!1},300),A=()=>{k();const c=Et(u.h,u.s,u.v);u.r=c[3],u.g=c[4],u.b=c[5],p.value=c[6],l.ver_bottom=u.h,l.rect_left=u.s*360,l.rect_bottom=u.v*360,E()},N=()=>{k();const c=Bt(`${u.r},${u.g},${u.b}`);u.h=c[0],u.s=c[1],u.v=c[2],p.value=c[6],l.ver_bottom=u.h,l.rect_left=u.s*360,l.rect_bottom=u.v*360,E()},U=c=>{c=c||"#000000";const F=Bt(c);u.h=F[0],u.s=F[1],u.v=F[2],u.r=F[3],u.g=F[4],u.b=F[5],l.ver_bottom=u.h,l.rect_left=u.s*360,l.rect_bottom=u.v*360},G=()=>{const c=Et(l.ver_bottom,l.rect_left/360,l.rect_bottom/360);u.h=c[0],u.s=c[1],u.v=c[2],u.r=c[3],u.g=c[4],u.b=c[5],p.value=c[6]},X=c=>{l.rect_down=!0,r.rect.x=c.clientX,r.rect.y=c.clientY;const F=c.currentTarget,q=F.getBoundingClientRect().left,Q=F.getBoundingClientRect().top;r.rect.left=l.rect_left=c.clientX-q,r.rect.bottom=l.rect_bottom=360-(c.clientY-Q),G()},W=c=>{if(!l.rect_down)return;const F=c.clientX-r.rect.x,q=c.clientY-r.rect.y;l.rect_left=Math.max(0,Math.min(360,r.rect.left+F)),l.rect_bottom=Math.max(0,Math.min(360,r.rect.bottom-q)),G()},d=()=>{!l.rect_down||(l.rect_down=!1)},Z=c=>{l.ver_down=!0,r.ver.y=c.clientY;const q=c.currentTarget.getBoundingClientRect().top;r.ver.bottom=l.ver_bottom=360-(c.clientY-q),G()},z=c=>{if(!l.ver_down)return;const F=c.clientY-r.ver.y;l.ver_bottom=Math.max(0,Math.min(360,r.ver.bottom-F)),G()},B=()=>{!l.ver_down||(l.ver_down=!1)},I=()=>{w.value=!0},H=()=>{w.value=!1};return St(()=>e.modelValue,c=>{l.ver_down||l.rect_down||f.value||U(c)}),U(e.modelValue),Vt(()=>{window.addEventListener("mousemove",W,!1),window.addEventListener("mouseup",d,!1),window.addEventListener("mousemove",z,!1),window.addEventListener("mouseup",B,!1)}),It(()=>{window.removeEventListener("mousemove",W,!1),window.removeEventListener("mouseup",d,!1),window.removeEventListener("mousemove",z,!1),window.removeEventListener("mouseup",B,!1)}),{show:w,color:p,vars:u,state:l,colorRectPointerStart:X,colorVerPointerStart:Z,updateHSV:A,updateRGB:N,updateHex:U,onOpen:I,onComfirm:H}}});const xt=e=>(Gt("data-v-27cd0415"),e=e(),$t(),e),ye={class:"color-control"},ce={class:"color-picker-layer"},de={class:"color-picker-view"},pe=xt(()=>n("div",{class:"color-picker-view__label"},"HSV",-1)),xe=xt(()=>n("div",{class:"color-picker-view__label"},"RGB",-1)),fe=xt(()=>n("div",{class:"color-picker-view__label"},"Hex",-1));function me(e,i,w,p,u,l){return C(),S("div",ye,[n("div",{class:"color-preview",style:K({backgroundColor:e.color}),onClick:i[0]||(i[0]=(...r)=>e.onOpen&&e.onOpen(...r))},null,4),(C(),ut(oe,{to:"body"},[D(n("div",{class:"color-picker-mask",onWheel:i[1]||(i[1]=ot(()=>{},["prevent"])),onTouchstart:i[2]||(i[2]=ot(()=>{},["prevent"])),onClick:i[3]||(i[3]=(...r)=>e.onComfirm&&e.onComfirm(...r))},null,544),[[ct,e.show]]),D(n("div",ce,[n("div",{class:"color-picker-rect",style:K(`background-color: hsl(${e.vars.h}deg, 100%, 50%)`),onMousedown:i[4]||(i[4]=ot((...r)=>e.colorRectPointerStart&&e.colorRectPointerStart(...r),["prevent","stop"]))},[n("div",{class:"color-picker-rect-cur",style:K({left:`${e.state.rect_left}px`,bottom:`${e.state.rect_bottom}px`})},null,4)],36),n("div",{class:"color-picker-hue",onMousedown:i[5]||(i[5]=ot((...r)=>e.colorVerPointerStart&&e.colorVerPointerStart(...r),["prevent","stop"]))},[n("div",{class:"color-picker-hue-cur",style:K({bottom:`${e.state.ver_bottom}px`})},null,4)],32),n("div",de,[n("div",{class:"color-picker-view-color",style:K({background:e.color})},null,4),pe,D(n("input",{type:"number",max:"360",min:"0",step:"1","onUpdate:modelValue":i[6]||(i[6]=r=>e.vars.h=r),class:"color-picker-view__input",onInput:i[7]||(i[7]=(...r)=>e.updateHSV&&e.updateHSV(...r))},null,544),[[T,e.vars.h]]),D(n("input",{type:"number",max:"1",min:"0",step:"0.01","onUpdate:modelValue":i[8]||(i[8]=r=>e.vars.s=r),class:"color-picker-view__input",onInput:i[9]||(i[9]=(...r)=>e.updateHSV&&e.updateHSV(...r))},null,544),[[T,e.vars.s]]),D(n("input",{type:"number",max:"1",min:"0",step:"0.01","onUpdate:modelValue":i[10]||(i[10]=r=>e.vars.v=r),class:"color-picker-view__input",onInput:i[11]||(i[11]=(...r)=>e.updateHSV&&e.updateHSV(...r))},null,544),[[T,e.vars.v]]),xe,D(n("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":i[12]||(i[12]=r=>e.vars.r=r),class:"color-picker-view__input",onInput:i[13]||(i[13]=(...r)=>e.updateRGB&&e.updateRGB(...r))},null,544),[[T,e.vars.r]]),D(n("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":i[14]||(i[14]=r=>e.vars.g=r),class:"color-picker-view__input",onInput:i[15]||(i[15]=(...r)=>e.updateRGB&&e.updateRGB(...r))},null,544),[[T,e.vars.g]]),D(n("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":i[16]||(i[16]=r=>e.vars.b=r),class:"color-picker-view__input",onInput:i[17]||(i[17]=(...r)=>e.updateRGB&&e.updateRGB(...r))},null,544),[[T,e.vars.b]]),fe,D(n("input",{type:"text","onUpdate:modelValue":i[18]||(i[18]=r=>e.color=r),class:"color-picker-view__input"},null,512),[[T,e.color]]),n("div",{class:"color-picker-view__enter",onClick:i[19]||(i[19]=(...r)=>e.onComfirm&&e.onComfirm(...r))},"\u786E\u8BA4")])],512),[[ct,e.show]])]))])}const Y=pt(ue,[["render",me],["__scopeId","data-v-27cd0415"]]);Y.install=function(e){e.component(Y.name,Y)};const ve={key:2,class:"tg lt"},be={key:3,class:"tg rt"},he={key:4,class:"tg rb"},ge={class:"overlay-dot"},we={class:"overlay-selected"},_e={key:1,draggable:!0,class:"grid-item"},ke=dt({__name:"GridItem",props:{disabled:{type:Boolean},selected:{type:Boolean},dot:{type:Boolean},item:null},setup(e){return(i,w)=>{var p;return e.item?(C(),S("div",{key:0,draggable:!0,class:"grid-item",style:K({fontSize:e.item.data.size?`${e.item.data.size}px`:"",color:e.item.data.color,backgroundColor:e.item.data.bgcolor,backgroundImage:e.item.data.image?`url(${e.item.data.image})`:"",opacity:e.item.data.opacity})},[e.item.terrain?(C(),S("div",{key:0,class:"grid-terrain",style:K({backgroundImage:e.item.terrain.image?`url(${e.item.terrain.image})`:""})},null,4)):J("",!0),e.item.unit?(C(),S("div",{key:1,class:kt(["grid-unit",{disabled:e.disabled}]),style:K({backgroundImage:e.item.unit.image?`url(${e.item.unit.image})`:""})},lt(e.item.unit.name),7)):J("",!0),(p=e.item.unit)!=null&&p.actorId?(C(),S("i",ve,lt(e.item.unit.actorId),1)):J("",!0),e.item.data.sup?(C(),S("i",be,lt(e.item.data.sup),1)):J("",!0),e.item.data.sub?(C(),S("i",he,lt(e.item.data.sub),1)):J("",!0),D(n("div",ge,null,512),[[ct,e.dot]]),D(n("div",we,null,512),[[ct,e.selected]])],4)):(C(),S("div",_e,[n("div",{class:kt(["grid-unit",{disabled:e.disabled}])},[ne(i.$slots,"default",{},void 0,!0)],2)]))}}});const j=pt(ke,[["__scopeId","data-v-ae9d7a02"]]);var V=(e=>(e[e.NONE=0]="NONE",e[e.GUARD=1]="GUARD",e[e.SHEEP=2]="SHEEP",e[e.ATTACKER=3]="ATTACKER",e))(V||{}),M=(e=>(e[e.NONE=0]="NONE",e[e.BLOCKED=5]="BLOCKED",e[e.CLIFF=6]="CLIFF",e))(M||{}),At=(e=>(e[e.NONE=0]="NONE",e))(At||{});function Ce(){const e=P(15),i=P(15),w=P(0),p=P([]),u=P([]),l=[{color:"#202020",bgcolor:"transparent"},{color:"#f9f9fa",bgcolor:"#ff3333"},{color:"#f9f9fa",bgcolor:"#00d659"},{color:"#f9f9fa",bgcolor:"#369af7"},{color:"#f9f9fa",bgcolor:"#fec02f"},{color:"#f9f9fa",bgcolor:"#a865e7"}],r=()=>({d:0,d1:0,d2:0,q:0}),f=()=>({txt:"",size:14,color:l[0].color,bgcolor:l[0].bgcolor,image:"",opacity:1}),k=()=>({type:M.NONE,image:""}),E=()=>({type:At.NONE,image:""}),A=()=>({actorId:0,actorType:V.NONE,name:"",image:"",disabled:!1}),N=B=>({x:0,y:0,data:f(),state:r(),terrain:k(),unit:B});function U(B){B.state=r(),B.data=f(),B.terrain=k(),B.overlay=void 0,B.unit=void 0}function G(){w.value=0,p.value.forEach(B=>{B.forEach(I=>{U(I)})}),u.value=[]}function X(B,I){const H=[];for(let c=0;c<B;c++){const F=[];for(let q=0;q<I;q++){const Q=N();Q.x=q,Q.y=c,F.push(Q)}H.push(F)}p.value=H}function W(B,I){i.value=B,e.value=I,z()}function d(B,I){var H;return(H=p.value[I])==null?void 0:H[B]}function Z(B){for(let I=0;I<e.value;I++)for(let H=0;H<i.value;H++)B(p.value[I][H])}function z(){X(e.value,i.value)}return z(),{rows:e,cols:i,actorId:w,grids:p,selects:u,gridColors:l,defGridState:r,defGridData:f,defGridTerrain:k,defGridOverlay:E,defGridUnit:A,defGrid:N,cleanGrid:U,cleanGrids:G,setSize:W,getGrid:d,gridForEach:Z}}const Dt=""+new URL("../assets/cliff.svg",import.meta.url).href,Ft=""+new URL("../assets/block.svg",import.meta.url).href,Ee=[{name:"\u7A7A\u767D\u573A\u666F",width:15,height:15,data:[]},{name:"\u5316\u8352\u5E7B\u5883",width:17,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:14,y:10,type:5},{x:15,y:10,type:5},{x:16,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:15,y:9,type:5},{x:16,y:9,type:5},{x:0,y:8,type:5},{x:7,y:8,type:6},{x:8,y:8,type:6},{x:9,y:8,type:6},{x:16,y:8,type:5},{x:6,y:7,type:6},{x:7,y:7,type:6},{x:8,y:7,type:6},{x:9,y:7,type:6},{x:10,y:7,type:6},{x:5,y:6,type:6},{x:6,y:6,type:6},{x:10,y:6,type:6},{x:11,y:6,type:6},{x:5,y:4,type:6},{x:6,y:4,type:6},{x:10,y:4,type:6},{x:11,y:4,type:6},{x:6,y:3,type:6},{x:7,y:3,type:6},{x:8,y:3,type:6},{x:9,y:3,type:6},{x:10,y:3,type:6},{x:0,y:2,type:5},{x:7,y:2,type:6},{x:8,y:2,type:6},{x:9,y:2,type:6},{x:16,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:15,y:1,type:5},{x:16,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:14,y:0,type:5},{x:15,y:0,type:5},{x:16,y:0,type:5}]},{name:"\u96EA\u5CAD\u5E7B\u5883",width:15,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:5,y:10,type:6},{x:6,y:10,type:6},{x:7,y:10,type:6},{x:8,y:10,type:6},{x:9,y:10,type:6},{x:12,y:10,type:5},{x:13,y:10,type:5},{x:14,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:2,y:9,type:5},{x:3,y:9,type:6},{x:4,y:9,type:6},{x:5,y:9,type:6},{x:6,y:9,type:6},{x:7,y:9,type:6},{x:8,y:9,type:6},{x:9,y:9,type:6},{x:10,y:9,type:6},{x:11,y:9,type:6},{x:12,y:9,type:5},{x:13,y:9,type:5},{x:14,y:9,type:5},{x:0,y:8,type:5},{x:1,y:8,type:5},{x:2,y:8,type:5},{x:3,y:8,type:6},{x:11,y:8,type:6},{x:12,y:8,type:5},{x:13,y:8,type:5},{x:14,y:8,type:5},{x:6,y:6,type:6},{x:7,y:6,type:6},{x:8,y:6,type:6},{x:3,y:5,type:6},{x:11,y:5,type:6},{x:6,y:4,type:6},{x:7,y:4,type:6},{x:8,y:4,type:6},{x:0,y:2,type:5},{x:1,y:2,type:5},{x:2,y:2,type:5},{x:3,y:2,type:6},{x:11,y:2,type:6},{x:12,y:2,type:5},{x:13,y:2,type:5},{x:14,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:2,y:1,type:5},{x:3,y:1,type:6},{x:4,y:1,type:6},{x:5,y:1,type:6},{x:6,y:1,type:6},{x:7,y:1,type:6},{x:8,y:1,type:6},{x:9,y:1,type:6},{x:10,y:1,type:6},{x:11,y:1,type:6},{x:12,y:1,type:5},{x:13,y:1,type:5},{x:14,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:6},{x:6,y:0,type:6},{x:7,y:0,type:6},{x:8,y:0,type:6},{x:9,y:0,type:6},{x:12,y:0,type:5},{x:13,y:0,type:5},{x:14,y:0,type:5}]},{name:"\u5730\u754C\u5E7B\u5883",width:17,height:13,data:[{x:0,y:12,type:5},{x:1,y:12,type:5},{x:2,y:12,type:5},{x:5,y:12,type:6},{x:6,y:12,type:6},{x:7,y:12,type:6},{x:8,y:12,type:6},{x:9,y:12,type:6},{x:10,y:12,type:6},{x:11,y:12,type:6},{x:14,y:12,type:5},{x:15,y:12,type:5},{x:16,y:12,type:5},{x:0,y:11,type:5},{x:1,y:11,type:5},{x:2,y:11,type:5},{x:6,y:11,type:6},{x:10,y:11,type:6},{x:14,y:11,type:5},{x:15,y:11,type:5},{x:16,y:11,type:5},{x:0,y:10,type:5},{x:1,y:10,type:5},{x:6,y:10,type:6},{x:10,y:10,type:6},{x:15,y:10,type:5},{x:16,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:6,y:9,type:6},{x:7,y:9,type:6},{x:8,y:9,type:6},{x:9,y:9,type:6},{x:10,y:9,type:6},{x:15,y:9,type:5},{x:16,y:9,type:5},{x:7,y:8,type:6},{x:8,y:8,type:6},{x:9,y:8,type:6},{x:7,y:4,type:6},{x:8,y:4,type:6},{x:9,y:4,type:6},{x:0,y:3,type:5},{x:1,y:3,type:5},{x:6,y:3,type:6},{x:7,y:3,type:6},{x:8,y:3,type:6},{x:9,y:3,type:6},{x:10,y:3,type:6},{x:15,y:3,type:5},{x:16,y:3,type:5},{x:0,y:2,type:5},{x:1,y:2,type:5},{x:6,y:2,type:6},{x:10,y:2,type:6},{x:15,y:2,type:5},{x:16,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:2,y:1,type:5},{x:6,y:1,type:6},{x:10,y:1,type:6},{x:14,y:1,type:5},{x:15,y:1,type:5},{x:16,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:6},{x:6,y:0,type:6},{x:7,y:0,type:6},{x:8,y:0,type:6},{x:9,y:0,type:6},{x:10,y:0,type:6},{x:11,y:0,type:6},{x:14,y:0,type:5},{x:15,y:0,type:5},{x:16,y:0,type:5}]},{name:"\u7ED3\u754C\u5E7B\u5883",width:11,height:11,data:[{x:5,y:8,type:5},{x:2,y:5,type:5},{x:5,y:5,type:5},{x:8,y:5,type:5},{x:5,y:2,type:5}]},{name:"\u57CE\u9685\u5E7B\u5883",width:15,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:5,y:10,type:5},{x:6,y:10,type:5},{x:7,y:10,type:5},{x:8,y:10,type:5},{x:9,y:10,type:5},{x:12,y:10,type:5},{x:13,y:10,type:5},{x:14,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:6,y:9,type:5},{x:8,y:9,type:5},{x:13,y:9,type:5},{x:14,y:9,type:5},{x:0,y:8,type:5},{x:14,y:8,type:5},{x:10,y:6,type:5},{x:5,y:5,type:5},{x:9,y:5,type:5},{x:4,y:4,type:5},{x:0,y:2,type:5},{x:14,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:6,y:1,type:5},{x:8,y:1,type:5},{x:13,y:1,type:5},{x:14,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:5},{x:6,y:0,type:5},{x:7,y:0,type:5},{x:8,y:0,type:5},{x:9,y:0,type:5},{x:12,y:0,type:5},{x:13,y:0,type:5},{x:14,y:0,type:5}]},{name:"\u6D1E\u7A74\u5E7B\u5883",width:11,height:11,data:[{x:0,y:0,type:5},{x:1,y:0,type:5},{x:0,y:1,type:5},{x:0,y:2,type:5},{x:3,y:2,type:6},{x:4,y:2,type:6},{x:2,y:3,type:6},{x:3,y:3,type:6},{x:4,y:3,type:6},{x:6,y:7,type:6},{x:7,y:7,type:6},{x:8,y:7,type:6},{x:6,y:8,type:6},{x:7,y:8,type:6},{x:10,y:8,type:5},{x:10,y:9,type:5},{x:9,y:10,type:5},{x:10,y:10,type:5}]},{name:"\u5996\u5C71\u5E7B\u5883",width:17,height:11,data:[]}],g=e=>(Gt("data-v-2dbdd791"),e=e(),$t(),e),Be={class:"wrapper"},De={class:"toolbar"},Fe={class:"setting"},Se={class:"label-control"},Ve=g(()=>n("span",null,"\u7F16\u8F91\u6A21\u5F0F",-1)),Ie=g(()=>n("option",{value:1},"\u7F16\u8F91\u7F51\u683C",-1)),Ge=g(()=>n("option",{value:2},"\u7F51\u683C\u4E0A\u8272",-1)),$e=g(()=>n("option",{value:3},"\u9009\u62E9\u5F62\u72B6",-1)),Me=g(()=>n("option",{value:4},"\u62A4\u536B\u8BA1\u7B97",-1)),Ae=[Ie,Ge,$e,Me],Ue={class:"label-control"},He=g(()=>n("span",null,"\u8303\u56F4",-1)),Re={class:"label-control"},Le=g(()=>n("span",null,"\u5F62\u72B6",-1)),Ne=g(()=>n("option",{value:1},"\u83F1\u5F62",-1)),Oe=g(()=>n("option",{value:2},"\u5708\u6570",-1)),qe=[Ne,Oe],Te={class:"label-control"},Ke=g(()=>n("span",null,"\u6392\u5E8F",-1)),ze=g(()=>n("option",{value:1},"\u8DDD\u79BBX",-1)),Pe=g(()=>n("option",{value:2},"\u8DDD\u79BBY",-1)),Xe=g(()=>n("option",{value:3},"X\u4F18\u5148",-1)),je=g(()=>n("option",{value:4},"Y\u4F18\u5148",-1)),Je=[ze,Pe,Xe,je],We=g(()=>n("button",{class:"btn"},"\u9884\u8BBE\u573A\u666F",-1)),Ze=["onClick"],Qe=["onClick"],Ye={class:"color-container"},to={class:"label-control"},eo=g(()=>n("span",null,"\u9884\u89C8",-1)),oo=Mt(" E "),no={class:"label-control"},so=g(()=>n("span",null,"\u6587\u5B57",-1)),ro={class:"label-control"},ao=g(()=>n("span",null,"\u80CC\u666F",-1)),lo=g(()=>n("label",{class:"label-control"},[n("span",null,"\u9884\u8BBE")],-1)),io={class:"color-tpls"},uo=Mt(" E "),yo={width:"32",height:"32",viewBox:"0 0 24 24",fill:"#a9a9a9",style:{"pointer-events":"none"}},co=g(()=>n("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"},null,-1)),po=[co],xo={class:"props-container"},fo={key:0,class:"props-content"},mo={class:"label-control"},vo=g(()=>n("span",null,"\u9884\u89C8",-1)),bo={class:"label-control"},ho=g(()=>n("span",null,"\u6587\u5B57",-1)),go={class:"label-control"},wo=g(()=>n("span",null,"\u80CC\u666F",-1)),_o={class:"label-control"},ko=g(()=>n("span",null,"\u5927\u5C0F",-1)),Co={class:"label-control"},Eo=g(()=>n("span",null,"\u5185\u5BB9",-1)),Bo={class:"label-control"},Do=g(()=>n("span",null,"\u5730\u5F62",-1)),Fo=["value"],So=["value"],Vo=["value"],Io={class:"label-control"},Go=g(()=>n("span",null,"Id",-1)),$o={class:"label-control"},Mo=g(()=>n("span",null,"\u7C7B\u578B",-1)),Ao=["value"],Uo=["value"],Ho=["value"],Ro=["value"],Lo={class:"label-control"},No=g(()=>n("span",null,"\u98DE\u884C",-1)),Oo={class:"content"},qo={class:"grids"},To={class:"heroes"},Ko=dt({__name:"Grids",setup(e){const{rows:i,cols:w,actorId:p,grids:u,selects:l,gridColors:r,defGridUnit:f,defGridState:k,defGrid:E,cleanGrid:A,cleanGrids:N,setSize:U,getGrid:G,gridForEach:X}=Ce(),W=P(),d=it({editor:1,selectRange:5,shape:1,sortType:1,color:r[0].color,bgcolor:r[0].bgcolor}),Z=E();Z.terrain={image:Ft,type:M.BLOCKED};const z=E();z.terrain={image:Dt,type:M.CLIFF};function B(o){d.color=o.color,d.bgcolor=o.bgcolor}const{heroes:I}=le(),H=Ct(E(f())),c=Ct(I.value.map(o=>{const t=E(),y=f();return y.image=`https://media.zlongame.com/media/news/cn/tdj/info/data/heroicon/${o.hero_icon}.png`,t.unit=y,t}));St(I,()=>{c.value=I.value.map(o=>{const t=E(),y=f();return y.image=`https://media.zlongame.com/media/news/cn/tdj/info/data/heroicon/${o.hero_icon}.png`,t.unit=y,t})});function F(o,t,y,v){const a=[];return X(m=>{m.state=k()}),X(m=>{const s=Math.abs(o-m.x),x=Math.abs(t-m.y),$=s+x,R=Math.max(s,x),L=s>1?s-1:s+x>1?x-1:x;switch(v){case 1:$<=y&&(m.state.d=$,m.state.q=R,m.state.d1=L,a.push(m));break;case 2:Math.abs(s)<=y&&Math.abs(x)<=y&&(m.state.d=$,m.state.q=R,m.state.d1=L,a.push(m));break}}),a}function q(o,t,y,v,a,m,s){const x=F(o,t,y,v);switch(x.forEach($=>{$.data.color=m,$.data.bgcolor=s}),l.value=x,a){case 1:l.value.sort(Q);break;case 2:l.value.sort(ft);break;case 3:l.value.sort(Ut);break;case 4:l.value.sort(Ht);break}for(let $=0;$<l.value.length;$++){const R=l.value[$];R.data.txt=String($+1)}}function Q(o,t){return o.state.q!==t.state.q?o.state.q-t.state.q:o.state.d!==t.state.d?o.state.d-t.state.d:o.x!==t.x?o.x-t.x:o.y!==t.y?o.y-t.y:0}function ft(o,t){return o.state.q!==t.state.q?o.state.q-t.state.q:o.state.d!==t.state.d?o.state.d-t.state.d:o.y!==t.y?o.y-t.y:o.x!==t.x?o.x-t.x:0}function Ut(o,t){return o.x!==t.x?o.x-t.x:o.y!==t.y?o.y-t.y:0}function Ht(o,t){return o.y!==t.y?o.y-t.y:o.x!==t.x?o.x-t.x:0}const h=it({enabled:!1});function Rt(){N()}function mt(){h.enabled=!1}function Lt(o,t){var y;switch(d.editor){case 1:case 4:h.current=t,(y=W.value)==null||y.focus();break;case 3:N(),q(t.x,t.y,d.selectRange,d.shape,d.sortType,d.color,d.bgcolor);break}}function Nt(o,t){if(o.button===0)switch(d.editor){case 2:{h.enabled=!0,t.data.color=d.color,t.data.bgcolor=d.bgcolor;break}}}function Ot(o,t){o.button===0&&h.enabled&&(t.data.color=d.color,t.data.bgcolor=d.bgcolor)}function qt(){h.current=void 0}const nt=P({width:15,height:15});function Tt(){try{const o=localStorage.getItem("grids");if(!o)return;const t=JSON.parse(o);nt.value=t}catch{}}function vt(){if(!confirm("\u786E\u5B9A\u8981\u4FDD\u5B58\u5417\uFF1F"))return;let t=u.value.flat().filter(y=>y.terrain.type!==M.NONE||y.unit&&y.unit.actorId>0);t=yt.cloneDeep(t),nt.value={width:w.value,height:i.value,data:t},localStorage.setItem("grids",JSON.stringify(nt.value))}function Kt(){const o=nt.value;if(!!o.data){U(o.width,o.height);for(const t of o.data){const y=G(t.x,t.y);!y||(t.data&&(y.data=t.data),t.terrain&&(y.terrain=t.terrain),t.unit&&t.unit.actorId>0&&(y.unit=t.unit))}}}function zt(o){U(o.width,o.height),o.data.forEach(t=>{const y=G(t.x,t.y);if(!!y)switch(t.type){case M.CLIFF:y.terrain={image:Dt,type:M.CLIFF};break;case M.BLOCKED:y.terrain={image:Ft,type:M.BLOCKED};break}})}function Pt(){const o=h.current;if(!o)return;nt.value||vt();let t,y,v=[];for(t=o.x-2;t<=o.x+2;t++)for(y=o.y-2;y<=o.y+2;y++){const s=G(t,y);if(!!s)if(s.x===o.x&&s.y===o.y){const x=v[0];x&&(v.push(x),v[0]=s)}else v.push(s)}v=v.filter(s=>s.unit&&!(s.x===o.x&&s.y===o.y));const a=v.map(s=>({unit:s.unit}));v.forEach(s=>{A(s)});const m=F(o.x,o.y,4,2).filter(s=>s.terrain.type!==M.BLOCKED&&!(s.x===o.x&&s.y===o.y)).sort(ft).map(s=>[s.x,s.y]);for(const s of a)for(const[x,$]of m){const R=G(x,$);if(!!R&&!(R.unit&&R.unit.actorId>0)&&R.terrain.type!==M.BLOCKED&&!(R.terrain.type===M.CLIFF&&!s.unit.fly)){R.unit=s.unit;break}}}const _=it({}),bt=["#ffffff00","#FF3C4132","#0EBEFF32","#48CF7432","#FCD00032","#80008032"],Xt=(o,t)=>{switch(d.editor){case 2:o.preventDefault();break;default:_.grid=t,_.action="swap",o.dataTransfer&&(o.dataTransfer.effectAllowed="move")}},jt=(o,t)=>{const y=E();y.data.color=t.color,y.data.bgcolor=t.bgcolor,y.data.txt="E",_.grid=y,_.action="color"},ht=(o,t)=>{_.grid=yt.cloneDeep(t),_.action="terrain"},gt=(o,t)=>{_.grid=yt.cloneDeep(t),_.action="unit"},Jt=(o,t)=>{if(o.preventDefault(),!_.grid)return;const y=_.grid.data,v=_.grid.unit,a=_.grid.terrain;switch(_.action){case"color":t.unit||(t.unit=f()),t.unit.actorId||(t.unit.actorId=++p.value),t.data=_.grid.data;break;case"unit":if(t.unit||(t.unit=f()),t.unit.actorId||(t.unit.actorId=++p.value),!v)break;t.unit.image=v.image;break;case"swap":_.grid.data=t.data,_.grid.unit=t.unit,t.data=y,t.unit=v,(!v||v.actorId===0)&&(_.grid.terrain=t.terrain,t.terrain=a);break;case"terrain":t.terrain=a;break}_.grid=void 0,_.action=void 0,d.editor===4&&st()};function Wt(o,t){let y=o[0].state[t];for(let v=1;v<o.length;v++)o[v].state[t]<y&&(y=o[v].state[t]);return y}function wt(o,t){return Math.abs(o.x-t.x)+Math.abs(o.y-t.y)}function _t(o,t,y){o.sort((s,x)=>!s.unit||!x.unit?0:+s.unit.actorId-+x.unit.actorId),o.forEach(s=>{s.state.d1=wt(s,y),s.state.d2=wt(s,t),s.unit&&(s.unit.guard=!1)});const v=Wt(o,"d1");if(o=o.filter(s=>s.state.d1===v),o.length===1)return o[0];let a=o[0],m=o.length;for(;m--;)if(o[m].state.d2<a.state.d2){a=o[m];break}return a}function Zt(){U(15,15),p.value=0;const o=[{x:7,y:9,txt:"",type:V.GUARD,bg:"#0ebeff"},{x:9,y:7,txt:"",type:V.GUARD,bg:"#0ebeff"},{x:7,y:5,txt:"",type:V.GUARD,bg:"#0ebeff"},{x:5,y:7,txt:"",type:V.GUARD,bg:"#0ebeff"},{x:8,y:6,txt:"",type:V.ATTACKER,bg:"#ff3c41"},{x:7,y:7,txt:"",type:V.SHEEP,bg:"#fcd000"}];for(const t of o){const y=G(t.x,t.y);!y||(y.unit||(y.unit=f()),y.unit.actorId=++p.value,y.unit.actorType=t.type,y.unit.disabled=!1,y.data.txt=t.txt,y.data.bgcolor=t.bg)}d.editor=4}const st=()=>{const o=u.value.flat();o.forEach(s=>{s.data.opacity=1});const t=o.filter(s=>s.unit&&!s.unit.disabled),y=t.filter(s=>{var x;return((x=s.unit)==null?void 0:x.actorType)===V.ATTACKER})[0],v=t.filter(s=>{var x;return((x=s.unit)==null?void 0:x.actorType)===V.SHEEP})[0],a=t.filter(s=>{var x;return((x=s.unit)==null?void 0:x.actorType)===V.GUARD});if(!v||a.length===0){alert("\u7F3A\u5C11\u89D2\u8272\uFF0C\u5C06\u81EA\u52A8\u751F\u6210"),Zt(),st();return}const m=o.filter(s=>!s.unit);for(const s of m){const x=_t(a,s,v);!x.unit||(s.data.image=x.unit.image,s.data.bgcolor=bt[x.unit.actorId]||bt[0],x.data.image?s.data.sup="":s.data.sup=String(x.unit.actorId),s.data.opacity=.6)}if(y){const s=_t(a,y,v);s.unit&&(s.unit.guard=!0)}},Qt=o=>{if(!!o.unit&&(o.unit.disabled=!o.unit.disabled,d.editor===4)){switch(o.unit.actorType){case V.ATTACKER:case V.SHEEP:o.unit.disabled=!1;break}st()}},Yt=o=>{var t;!_.grid||!o.dataTransfer||_.action==="swap"&&(d.editor===4&&((t=_.grid.unit)==null?void 0:t.actorType)===V.SHEEP||o.preventDefault())},te=o=>{if(!!_.grid&&!!o)switch(_.action){case"swap":A(o),_.grid=void 0,_.action=void 0,d.editor===4&&st()}};return Vt(()=>{Tt(),window.addEventListener("mouseup",mt,!1)}),It(()=>{window.removeEventListener("mouseup",mt,!1)}),(o,t)=>{const y=se("c-space"),v=ae("autofocus");return C(),S("div",Be,[n("div",De,[n("div",Fe,[n("label",Se,[Ve,D(n("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>d.editor=a)},Ae,512),[[rt,d.editor,void 0,{number:!0}]])]),n("label",Ue,[He,D(n("input",{type:"number",min:"0","onUpdate:modelValue":t[1]||(t[1]=a=>d.selectRange=a),style:{width:"5em"}},null,512),[[T,d.selectRange]])]),n("label",Re,[Le,D(n("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>d.shape=a)},qe,512),[[rt,d.shape]])]),n("label",Te,[Ke,D(n("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>d.sortType=a)},Je,512),[[rt,d.sortType]])]),n("button",{class:"btn",onClick:Rt},"\u6E05\u7A7A"),n("button",{class:"btn",onClick:st},"\u8BA1\u7B97\u62A4\u536B"),n("button",{class:"btn btn-success",onClick:vt},"\u4FDD\u5B58\u5E03\u5C40"),n("button",{class:"btn btn-success",onClick:Kt},"\u8FD8\u539F\u5E03\u5C40"),J("",!0),O(b(ie),null,{popover:tt(({onClose:a})=>[n("div",{class:"list",onClick:m=>a()},[(C(!0),S(et,null,at(b(Ee),(m,s)=>(C(),S("div",{class:"list-item",key:s,onClick:x=>zt(m)},lt(m.name),9,Qe))),128))],8,Ze)]),default:tt(()=>[We]),_:1})]),n("div",Ye,[O(y,null,{default:tt(()=>[n("label",to,[eo,O(b(j),{draggable:!1,style:K([`--color:${d.color};--bgcolor:${d.bgcolor}`])},{default:tt(()=>[oo]),_:1},8,["style"])]),n("label",no,[so,O(b(Y),{modelValue:d.color,"onUpdate:modelValue":t[4]||(t[4]=a=>d.color=a)},null,8,["modelValue"])]),n("label",ro,[ao,O(b(Y),{modelValue:d.bgcolor,"onUpdate:modelValue":t[5]||(t[5]=a=>d.bgcolor=a)},null,8,["modelValue"])]),lo,n("div",io,[(C(!0),S(et,null,at(b(r),(a,m)=>(C(),ut(b(j),{key:m,selected:d.bgcolor===a.bgcolor,style:K([`--color:${a.color};--bgcolor:${a.bgcolor}`]),onClick:s=>B(a),onDragstart:s=>jt(s,a)},{default:tt(()=>[uo]),_:2},1032,["selected","style","onClick","onDragstart"]))),128)),O(b(j),{item:b(z),onDragstart:t[6]||(t[6]=a=>ht(a,b(z)))},null,8,["item"]),O(b(j),{item:b(Z),onDragstart:t[7]||(t[7]=a=>ht(a,b(Z)))},null,8,["item"])]),n("div",{class:"trush",onDragover:Yt,onDrop:t[8]||(t[8]=a=>te(_.grid))},[(C(),S("svg",yo,po))],32)]),_:1})]),n("div",xo,[h.current?(C(),S("div",fo,[O(y,null,{default:tt(()=>[n("label",mo,[vo,O(b(j),{draggable:!1,style:K([`--color:${h.current.data.color};--bgcolor:${h.current.data.bgcolor}`]),item:h.current},null,8,["style","item"])]),n("label",bo,[ho,O(b(Y),{modelValue:h.current.data.color,"onUpdate:modelValue":t[9]||(t[9]=a=>h.current.data.color=a)},null,8,["modelValue"])]),n("label",go,[wo,O(b(Y),{modelValue:h.current.data.bgcolor,"onUpdate:modelValue":t[10]||(t[10]=a=>h.current.data.bgcolor=a)},null,8,["modelValue"])]),n("label",_o,[ko,D(n("input",{type:"number",style:{width:"4em"},min:"12",step:"1","onUpdate:modelValue":t[11]||(t[11]=a=>h.current.data.size=a)},null,512),[[T,h.current.data.size]])]),n("label",Co,[Eo,D(n("input",{type:"text",ref_key:"txtInput",ref:W,"onUpdate:modelValue":t[12]||(t[12]=a=>h.current.data.txt=a),style:{width:"6em"}},null,512),[[v],[T,h.current.data.txt]])]),n("label",Bo,[Do,D(n("select",{"onUpdate:modelValue":t[13]||(t[13]=a=>h.current.terrain.type=a)},[n("option",{value:b(M).NONE},"\u65E0",8,Fo),n("option",{value:b(M).BLOCKED},"\u969C\u788D",8,So),n("option",{value:b(M).CLIFF},"\u60AC\u5D16",8,Vo)],512),[[rt,h.current.terrain.type]])]),h.current.unit?(C(),S(et,{key:0},[n("label",Io,[Go,D(n("input",{type:"number","onUpdate:modelValue":t[14]||(t[14]=a=>h.current.unit.actorId=a),style:{width:"4em"}},null,512),[[T,h.current.unit.actorId]])]),n("label",$o,[Mo,D(n("select",{"onUpdate:modelValue":t[15]||(t[15]=a=>h.current.unit.actorType=a)},[n("option",{value:b(V).NONE},"\u65E0",8,Ao),n("option",{value:b(V).GUARD},"\u62A4\u536B",8,Uo),n("option",{value:b(V).SHEEP},"\u9776\u5B50",8,Ho),n("option",{value:b(V).ATTACKER},"\u653B\u51FB\u8005",8,Ro)],512),[[rt,h.current.unit.actorType]])]),n("label",Lo,[No,D(n("input",{type:"checkbox","onUpdate:modelValue":t[16]||(t[16]=a=>h.current.unit.fly=a)},null,512),[[re,h.current.unit.fly]])])],64)):J("",!0),n("button",{class:"btn",onClick:qt},"\u5B8C\u6210"),n("button",{class:"btn btn-success",onClick:Pt},"\u602A\u529B\u4E71\u795E")]),_:1})])):J("",!0)])]),n("div",Oo,[n("div",qo,[(C(!0),S(et,null,at(b(u),(a,m)=>(C(),S("div",{class:"grids-row",key:m},[(C(!0),S(et,null,at(a,(s,x)=>{var $,R;return C(),ut(b(j),{key:x,draggable:!0,selected:s.x===(($=h.current)==null?void 0:$.x)&&s.y===((R=h.current)==null?void 0:R.y),disabled:s.unit&&s.unit.disabled,dot:s.unit&&s.unit.guard,item:s,onDragstart:L=>Xt(L,s),onDragover:t[17]||(t[17]=ot(()=>{},["prevent"])),onDrop:L=>Jt(L,s),onContextmenu:ot(L=>Qt(s),["prevent"]),onClick:L=>Lt(L,s),onMousedown:L=>Nt(L,s),onMouseenter:L=>Ot(L,s)},null,8,["selected","disabled","dot","item","onDragstart","onDrop","onContextmenu","onClick","onMousedown","onMouseenter"])}),128))]))),128))]),n("div",To,[O(b(j),{item:b(H),onDragstart:t[18]||(t[18]=a=>gt(a,b(H)))},null,8,["item"]),(C(!0),S(et,null,at(b(c),(a,m)=>(C(),ut(b(j),{key:m,item:a,onDragstart:s=>gt(s,a)},null,8,["item","onDragstart"]))),128))])])])}}});const jo=pt(Ko,[["__scopeId","data-v-2dbdd791"]]);export{jo as default};
