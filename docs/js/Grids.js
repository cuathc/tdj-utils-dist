import{d as pt,h as j,a as ee,i as it,O as Ft,Z as St,$ as Vt,_ as dt,o as E,c as V,b as r,n as T,j as yt,p as D,W as ct,w as ot,G as K,T as oe,y as Gt,z as It,f as X,m as lt,g as ne,a0 as kt,v as at,l as q,k as tt,e as v,F as et,s as st,x as re,q as ae,D as $t,V as se}from"./index.js";import{_ as ut}from"./lodash.js";import{u as le,D as ie}from"./useHeroes.js";const Ct=(o,y,_)=>{let x=0,l=0,s=0;o%=360;const a=Math.floor(o/60),d=o/60-a,g=_*(1-y),C=_*(1-y*d),G=_*(1-y*(1-d));switch(a){case 0:x=_,l=G,s=g;break;case 1:x=C,l=_,s=g;break;case 2:x=g,l=_,s=G;break;case 3:x=g,l=C,s=_;break;case 4:x=G,l=g,s=_;break;case 5:x=_,l=g,s=C;break}x=Math.floor(x*255),l=Math.floor(l*255),s=Math.floor(s*255);const A=("00"+x.toString(16)).slice(-2),H=("00"+l.toString(16)).slice(-2),M=("00"+s.toString(16)).slice(-2);return[o,y,_,x,l,s,"#"+A+H+M]},Et=o=>{let y=0,_=0,x=0,l=0,s=0,a=0;if(/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i.test(o))y=window.parseInt(RegExp.$1,16),_=window.parseInt(RegExp.$2,16),x=window.parseInt(RegExp.$3,16);else if(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i.test(o))y=window.parseInt(RegExp.$1,10),_=window.parseInt(RegExp.$2,10),x=window.parseInt(RegExp.$3,10);else return[0,0,0,0,0,0,"#000000"];l=y/255,s=_/255,a=x/255;let d=l;s>d&&(d=s),a>d&&(d=a);let g=l;s<g&&(g=s),a<g&&(g=a);let C=0,G=0,A=0;d===g?C=0:d===l&&s>=a?C=60*(s-a)/(d-g)+0:d===l&&s<a?C=60*(s-a)/(d-g)+360:d===s?C=60*(a-l)/(d-g)+120:d===a&&(C=60*(l-s)/(d-g)+240),d===0?G=0:G=1-g/d,A=d;const H=("00"+y.toString(16)).slice(-2),M=("00"+_.toString(16)).slice(-2),J=("00"+x.toString(16)).slice(-2);return[Math.floor(C),G,A,y,_,x,"#"+H+M+J]},ye=pt({name:"ColorPicker",emits:["update:modelValue"],props:{modelValue:{type:String,required:!0}},setup(o,{emit:y}){const _=j(!1),x=ee({set:p=>{y("update:modelValue",p)},get:()=>o.modelValue}),l=it({h:0,s:0,v:0,r:0,g:0,b:0}),s=it({rect_down:!1,rect_left:0,rect_bottom:0,ver_down:!1,ver_bottom:0}),a={rect:{left:0,bottom:0,x:0,y:0},ver:{bottom:0,y:0}},d=j(!1),g=()=>{d.value=!0},C=ut.debounce(()=>{d.value=!1},300),G=()=>{g();const p=Ct(l.h,l.s,l.v);l.r=p[3],l.g=p[4],l.b=p[5],x.value=p[6],s.ver_bottom=l.h,s.rect_left=l.s*360,s.rect_bottom=l.v*360,C()},A=()=>{g();const p=Et(`${l.r},${l.g},${l.b}`);l.h=p[0],l.s=p[1],l.v=p[2],x.value=p[6],s.ver_bottom=l.h,s.rect_left=l.s*360,s.rect_bottom=l.v*360,C()},H=p=>{p=p||"#000000";const F=Et(p);l.h=F[0],l.s=F[1],l.v=F[2],l.r=F[3],l.g=F[4],l.b=F[5],s.ver_bottom=l.h,s.rect_left=l.s*360,s.rect_bottom=l.v*360},M=()=>{const p=Ct(s.ver_bottom,s.rect_left/360,s.rect_bottom/360);l.h=p[0],l.s=p[1],l.v=p[2],l.r=p[3],l.g=p[4],l.b=p[5],x.value=p[6]},J=p=>{s.rect_down=!0,a.rect.x=p.clientX,a.rect.y=p.clientY;const F=p.currentTarget,O=F.getBoundingClientRect().left,Q=F.getBoundingClientRect().top;a.rect.left=s.rect_left=p.clientX-O,a.rect.bottom=s.rect_bottom=360-(p.clientY-Q),M()},Z=p=>{if(!s.rect_down)return;const F=p.clientX-a.rect.x,O=p.clientY-a.rect.y;s.rect_left=Math.max(0,Math.min(360,a.rect.left+F)),s.rect_bottom=Math.max(0,Math.min(360,a.rect.bottom-O)),M()},c=()=>{!s.rect_down||(s.rect_down=!1)},P=p=>{s.ver_down=!0,a.ver.y=p.clientY;const O=p.currentTarget.getBoundingClientRect().top;a.ver.bottom=s.ver_bottom=360-(p.clientY-O),M()},z=p=>{if(!s.ver_down)return;const F=p.clientY-a.ver.y;s.ver_bottom=Math.max(0,Math.min(360,a.ver.bottom-F)),M()},B=()=>{!s.ver_down||(s.ver_down=!1)},U=()=>{_.value=!0},R=()=>{_.value=!1};return Ft(()=>o.modelValue,p=>{s.ver_down||s.rect_down||d.value||H(p)}),H(o.modelValue),St(()=>{window.addEventListener("mousemove",Z,!1),window.addEventListener("mouseup",c,!1),window.addEventListener("mousemove",z,!1),window.addEventListener("mouseup",B,!1)}),Vt(()=>{window.removeEventListener("mousemove",Z,!1),window.removeEventListener("mouseup",c,!1),window.removeEventListener("mousemove",z,!1),window.removeEventListener("mouseup",B,!1)}),{show:_,color:x,vars:l,state:s,colorRectPointerStart:J,colorVerPointerStart:P,updateHSV:G,updateRGB:A,updateHex:H,onOpen:U,onComfirm:R}}});const xt=o=>(Gt("data-v-27cd0415"),o=o(),It(),o),ue={class:"color-control"},ce={class:"color-picker-layer"},pe={class:"color-picker-view"},de=xt(()=>r("div",{class:"color-picker-view__label"},"HSV",-1)),xe=xt(()=>r("div",{class:"color-picker-view__label"},"RGB",-1)),fe=xt(()=>r("div",{class:"color-picker-view__label"},"Hex",-1));function ve(o,y,_,x,l,s){return E(),V("div",ue,[r("div",{class:"color-preview",style:T({backgroundColor:o.color}),onClick:y[0]||(y[0]=(...a)=>o.onOpen&&o.onOpen(...a))},null,4),(E(),yt(oe,{to:"body"},[D(r("div",{class:"color-picker-mask",onWheel:y[1]||(y[1]=ot(()=>{},["prevent"])),onTouchstart:y[2]||(y[2]=ot(()=>{},["prevent"])),onClick:y[3]||(y[3]=(...a)=>o.onComfirm&&o.onComfirm(...a))},null,544),[[ct,o.show]]),D(r("div",ce,[r("div",{class:"color-picker-rect",style:T(`background-color: hsl(${o.vars.h}deg, 100%, 50%)`),onMousedown:y[4]||(y[4]=ot((...a)=>o.colorRectPointerStart&&o.colorRectPointerStart(...a),["prevent","stop"]))},[r("div",{class:"color-picker-rect-cur",style:T({left:`${o.state.rect_left}px`,bottom:`${o.state.rect_bottom}px`})},null,4)],36),r("div",{class:"color-picker-hue",onMousedown:y[5]||(y[5]=ot((...a)=>o.colorVerPointerStart&&o.colorVerPointerStart(...a),["prevent","stop"]))},[r("div",{class:"color-picker-hue-cur",style:T({bottom:`${o.state.ver_bottom}px`})},null,4)],32),r("div",pe,[r("div",{class:"color-picker-view-color",style:T({background:o.color})},null,4),de,D(r("input",{type:"number",max:"360",min:"0",step:"1","onUpdate:modelValue":y[6]||(y[6]=a=>o.vars.h=a),class:"color-picker-view__input",onInput:y[7]||(y[7]=(...a)=>o.updateHSV&&o.updateHSV(...a))},null,544),[[K,o.vars.h]]),D(r("input",{type:"number",max:"1",min:"0",step:"0.01","onUpdate:modelValue":y[8]||(y[8]=a=>o.vars.s=a),class:"color-picker-view__input",onInput:y[9]||(y[9]=(...a)=>o.updateHSV&&o.updateHSV(...a))},null,544),[[K,o.vars.s]]),D(r("input",{type:"number",max:"1",min:"0",step:"0.01","onUpdate:modelValue":y[10]||(y[10]=a=>o.vars.v=a),class:"color-picker-view__input",onInput:y[11]||(y[11]=(...a)=>o.updateHSV&&o.updateHSV(...a))},null,544),[[K,o.vars.v]]),xe,D(r("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":y[12]||(y[12]=a=>o.vars.r=a),class:"color-picker-view__input",onInput:y[13]||(y[13]=(...a)=>o.updateRGB&&o.updateRGB(...a))},null,544),[[K,o.vars.r]]),D(r("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":y[14]||(y[14]=a=>o.vars.g=a),class:"color-picker-view__input",onInput:y[15]||(y[15]=(...a)=>o.updateRGB&&o.updateRGB(...a))},null,544),[[K,o.vars.g]]),D(r("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":y[16]||(y[16]=a=>o.vars.b=a),class:"color-picker-view__input",onInput:y[17]||(y[17]=(...a)=>o.updateRGB&&o.updateRGB(...a))},null,544),[[K,o.vars.b]]),fe,D(r("input",{type:"text","onUpdate:modelValue":y[18]||(y[18]=a=>o.color=a),class:"color-picker-view__input"},null,512),[[K,o.color]]),r("div",{class:"color-picker-view__enter",onClick:y[19]||(y[19]=(...a)=>o.onComfirm&&o.onComfirm(...a))},"\u786E\u8BA4")])],512),[[ct,o.show]])]))])}const Y=dt(ye,[["render",ve],["__scopeId","data-v-27cd0415"]]);Y.install=function(o){o.component(Y.name,Y)};const me=["title"],be={key:3,class:"tg lt"},ge={key:4,class:"tg rt"},he={key:5,class:"tg rb"},we={class:"overlay-dot"},_e={class:"overlay-selected"},ke=pt({__name:"GridItem",props:{disabled:{type:Boolean},selected:{type:Boolean},dot:{type:Boolean},data:null,terrain:null,overlay:null,unit:null},setup(o){return(y,_)=>{var x,l,s,a,d,g,C,G,A;return E(),V("div",{draggable:!0,class:ne(["grid-item",{disabled:o.disabled}])},[r("div",{class:"grid-item-bg",style:T({backgroundColor:(x=o.data)==null?void 0:x.bgcolor,backgroundImage:(l=o.data)!=null&&l.image?`url(${o.data.image})`:"",opacity:(s=o.data)==null?void 0:s.opacity})},null,4),o.terrain?(E(),V("div",{key:0,class:"grid-terrain",style:T({backgroundImage:o.terrain.image?`url(${o.terrain.image})`:""})},null,4)):X("",!0),o.unit?(E(),V("div",{key:1,class:"grid-unit",title:o.unit.name,style:T({backgroundImage:o.unit.image?`url(${o.unit.image})`:""})},null,12,me)):X("",!0),(a=o.data)!=null&&a.txt?(E(),V("div",{key:2,class:"grid-item-txt",style:T({fontSize:(d=o.data)!=null&&d.size?`${o.data.size}px`:"",color:(g=o.data)==null?void 0:g.color})},lt(o.data.txt),5)):X("",!0),(C=o.unit)!=null&&C.actorId?(E(),V("i",be,lt(o.unit.actorId),1)):X("",!0),(G=o.data)!=null&&G.sup?(E(),V("i",ge,lt(o.data.sup),1)):X("",!0),(A=o.data)!=null&&A.sub?(E(),V("i",he,lt(o.data.sub),1)):X("",!0),D(r("div",we,null,512),[[ct,o.dot]]),D(r("div",_e,null,512),[[ct,o.selected]])],2)}}});const W=dt(ke,[["__scopeId","data-v-9e050d32"]]);var I=(o=>(o[o.NONE=0]="NONE",o[o.GUARD=1]="GUARD",o[o.SHEEP=2]="SHEEP",o[o.ATTACKER=3]="ATTACKER",o))(I||{}),$=(o=>(o[o.NONE=0]="NONE",o[o.BLOCKED=5]="BLOCKED",o[o.CLIFF=6]="CLIFF",o))($||{}),Mt=(o=>(o[o.NONE=0]="NONE",o))(Mt||{});function Ce(){const o=j(15),y=j(15),_=j(0),x=j([]),l=j([]),s=[{color:"#202020",bgcolor:"transparent"},{color:"#f9f9fa",bgcolor:"#ff3333"},{color:"#f9f9fa",bgcolor:"#00d659"},{color:"#f9f9fa",bgcolor:"#369af7"},{color:"#f9f9fa",bgcolor:"#fec02f"},{color:"#f9f9fa",bgcolor:"#a865e7"}],a=()=>({d:0,d1:0,d2:0,q:0}),d=()=>({txt:"",size:14,color:s[0].color,bgcolor:s[0].bgcolor,image:"",opacity:1}),g=()=>({type:$.NONE,image:""}),C=()=>({type:Mt.NONE,image:""}),G=()=>({actorId:0,actorType:I.NONE,name:"",image:""}),A=B=>({x:0,y:0,disabled:!1,data:d(),state:a(),terrain:g(),unit:B});function H(B){B.state=a(),B.data=d(),B.terrain=g(),B.overlay=void 0,B.unit=void 0}function M(){_.value=0,x.value.forEach(B=>{B.forEach(U=>{H(U)})}),l.value=[]}function J(B,U){const R=[];for(let p=0;p<B;p++){const F=[];for(let O=0;O<U;O++){const Q=A();Q.x=O,Q.y=p,F.push(Q)}R.push(F)}x.value=R}function Z(B,U){y.value=B,o.value=U,z()}function c(B,U){var R;return(R=x.value[U])==null?void 0:R[B]}function P(B){for(let U=0;U<o.value;U++)for(let R=0;R<y.value;R++)B(x.value[U][R])}function z(){J(o.value,y.value)}return z(),{rows:o,cols:y,actorId:_,grids:x,selects:l,gridColors:s,defGridState:a,defGridData:d,defGridTerrain:g,defGridOverlay:C,defGridUnit:G,defGrid:A,cleanGrid:H,cleanGrids:M,setSize:Z,getGrid:c,gridForEach:P}}const Bt=""+new URL("../assets/cliff.svg",import.meta.url).href,Dt=""+new URL("../assets/block.svg",import.meta.url).href,Ee=[{name:"\u7A7A\u767D\u573A\u666F",width:15,height:15,data:[]},{name:"\u5316\u8352\u5E7B\u5883",width:17,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:14,y:10,type:5},{x:15,y:10,type:5},{x:16,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:15,y:9,type:5},{x:16,y:9,type:5},{x:0,y:8,type:5},{x:7,y:8,type:6},{x:8,y:8,type:6},{x:9,y:8,type:6},{x:16,y:8,type:5},{x:6,y:7,type:6},{x:7,y:7,type:6},{x:8,y:7,type:6},{x:9,y:7,type:6},{x:10,y:7,type:6},{x:5,y:6,type:6},{x:6,y:6,type:6},{x:10,y:6,type:6},{x:11,y:6,type:6},{x:5,y:4,type:6},{x:6,y:4,type:6},{x:10,y:4,type:6},{x:11,y:4,type:6},{x:6,y:3,type:6},{x:7,y:3,type:6},{x:8,y:3,type:6},{x:9,y:3,type:6},{x:10,y:3,type:6},{x:0,y:2,type:5},{x:7,y:2,type:6},{x:8,y:2,type:6},{x:9,y:2,type:6},{x:16,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:15,y:1,type:5},{x:16,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:14,y:0,type:5},{x:15,y:0,type:5},{x:16,y:0,type:5}]},{name:"\u96EA\u5CAD\u5E7B\u5883",width:15,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:5,y:10,type:6},{x:6,y:10,type:6},{x:7,y:10,type:6},{x:8,y:10,type:6},{x:9,y:10,type:6},{x:12,y:10,type:5},{x:13,y:10,type:5},{x:14,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:2,y:9,type:5},{x:3,y:9,type:6},{x:4,y:9,type:6},{x:5,y:9,type:6},{x:6,y:9,type:6},{x:7,y:9,type:6},{x:8,y:9,type:6},{x:9,y:9,type:6},{x:10,y:9,type:6},{x:11,y:9,type:6},{x:12,y:9,type:5},{x:13,y:9,type:5},{x:14,y:9,type:5},{x:0,y:8,type:5},{x:1,y:8,type:5},{x:2,y:8,type:5},{x:3,y:8,type:6},{x:11,y:8,type:6},{x:12,y:8,type:5},{x:13,y:8,type:5},{x:14,y:8,type:5},{x:6,y:6,type:6},{x:7,y:6,type:6},{x:8,y:6,type:6},{x:3,y:5,type:6},{x:11,y:5,type:6},{x:6,y:4,type:6},{x:7,y:4,type:6},{x:8,y:4,type:6},{x:0,y:2,type:5},{x:1,y:2,type:5},{x:2,y:2,type:5},{x:3,y:2,type:6},{x:11,y:2,type:6},{x:12,y:2,type:5},{x:13,y:2,type:5},{x:14,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:2,y:1,type:5},{x:3,y:1,type:6},{x:4,y:1,type:6},{x:5,y:1,type:6},{x:6,y:1,type:6},{x:7,y:1,type:6},{x:8,y:1,type:6},{x:9,y:1,type:6},{x:10,y:1,type:6},{x:11,y:1,type:6},{x:12,y:1,type:5},{x:13,y:1,type:5},{x:14,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:6},{x:6,y:0,type:6},{x:7,y:0,type:6},{x:8,y:0,type:6},{x:9,y:0,type:6},{x:12,y:0,type:5},{x:13,y:0,type:5},{x:14,y:0,type:5}]},{name:"\u5730\u754C\u5E7B\u5883",width:17,height:13,data:[{x:0,y:12,type:5},{x:1,y:12,type:5},{x:2,y:12,type:5},{x:5,y:12,type:6},{x:6,y:12,type:6},{x:7,y:12,type:6},{x:8,y:12,type:6},{x:9,y:12,type:6},{x:10,y:12,type:6},{x:11,y:12,type:6},{x:14,y:12,type:5},{x:15,y:12,type:5},{x:16,y:12,type:5},{x:0,y:11,type:5},{x:1,y:11,type:5},{x:2,y:11,type:5},{x:6,y:11,type:6},{x:10,y:11,type:6},{x:14,y:11,type:5},{x:15,y:11,type:5},{x:16,y:11,type:5},{x:0,y:10,type:5},{x:1,y:10,type:5},{x:6,y:10,type:6},{x:10,y:10,type:6},{x:15,y:10,type:5},{x:16,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:6,y:9,type:6},{x:7,y:9,type:6},{x:8,y:9,type:6},{x:9,y:9,type:6},{x:10,y:9,type:6},{x:15,y:9,type:5},{x:16,y:9,type:5},{x:7,y:8,type:6},{x:8,y:8,type:6},{x:9,y:8,type:6},{x:7,y:4,type:6},{x:8,y:4,type:6},{x:9,y:4,type:6},{x:0,y:3,type:5},{x:1,y:3,type:5},{x:6,y:3,type:6},{x:7,y:3,type:6},{x:8,y:3,type:6},{x:9,y:3,type:6},{x:10,y:3,type:6},{x:15,y:3,type:5},{x:16,y:3,type:5},{x:0,y:2,type:5},{x:1,y:2,type:5},{x:6,y:2,type:6},{x:10,y:2,type:6},{x:15,y:2,type:5},{x:16,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:2,y:1,type:5},{x:6,y:1,type:6},{x:10,y:1,type:6},{x:14,y:1,type:5},{x:15,y:1,type:5},{x:16,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:6},{x:6,y:0,type:6},{x:7,y:0,type:6},{x:8,y:0,type:6},{x:9,y:0,type:6},{x:10,y:0,type:6},{x:11,y:0,type:6},{x:14,y:0,type:5},{x:15,y:0,type:5},{x:16,y:0,type:5}]},{name:"\u7ED3\u754C\u5E7B\u5883",width:11,height:11,data:[{x:5,y:8,type:5},{x:2,y:5,type:5},{x:5,y:5,type:5},{x:8,y:5,type:5},{x:5,y:2,type:5}]},{name:"\u57CE\u9685\u5E7B\u5883",width:15,height:11,data:[{x:0,y:10,type:5},{x:1,y:10,type:5},{x:2,y:10,type:5},{x:5,y:10,type:5},{x:6,y:10,type:5},{x:7,y:10,type:5},{x:8,y:10,type:5},{x:9,y:10,type:5},{x:12,y:10,type:5},{x:13,y:10,type:5},{x:14,y:10,type:5},{x:0,y:9,type:5},{x:1,y:9,type:5},{x:6,y:9,type:5},{x:8,y:9,type:5},{x:13,y:9,type:5},{x:14,y:9,type:5},{x:0,y:8,type:5},{x:14,y:8,type:5},{x:10,y:6,type:5},{x:5,y:5,type:5},{x:9,y:5,type:5},{x:4,y:4,type:5},{x:0,y:2,type:5},{x:14,y:2,type:5},{x:0,y:1,type:5},{x:1,y:1,type:5},{x:6,y:1,type:5},{x:8,y:1,type:5},{x:13,y:1,type:5},{x:14,y:1,type:5},{x:0,y:0,type:5},{x:1,y:0,type:5},{x:2,y:0,type:5},{x:5,y:0,type:5},{x:6,y:0,type:5},{x:7,y:0,type:5},{x:8,y:0,type:5},{x:9,y:0,type:5},{x:12,y:0,type:5},{x:13,y:0,type:5},{x:14,y:0,type:5}]},{name:"\u6D1E\u7A74\u5E7B\u5883",width:11,height:11,data:[{x:0,y:0,type:5},{x:1,y:0,type:5},{x:0,y:1,type:5},{x:0,y:2,type:5},{x:3,y:2,type:6},{x:4,y:2,type:6},{x:2,y:3,type:6},{x:3,y:3,type:6},{x:4,y:3,type:6},{x:6,y:7,type:6},{x:7,y:7,type:6},{x:8,y:7,type:6},{x:6,y:8,type:6},{x:7,y:8,type:6},{x:10,y:8,type:5},{x:10,y:9,type:5},{x:9,y:10,type:5},{x:10,y:10,type:5}]},{name:"\u5996\u5C71\u5E7B\u5883",width:17,height:11,data:[]}],w=o=>(Gt("data-v-3bc6b0bd"),o=o(),It(),o),Be={class:"wrapper"},De={class:"toolbar"},Fe={class:"setting"},Se={class:"label-control"},Ve=w(()=>r("span",null,"\u7F16\u8F91\u6A21\u5F0F",-1)),Ge=w(()=>r("option",{value:1},"\u7F16\u8F91\u7F51\u683C",-1)),Ie=w(()=>r("option",{value:2},"\u5237\u5B50\u6A21\u5F0F",-1)),$e=w(()=>r("option",{value:3},"\u9009\u62E9\u5F62\u72B6",-1)),Me=w(()=>r("option",{value:4},"\u62A4\u536B\u8BA1\u7B97",-1)),Ue=[Ge,Ie,$e,Me],Ae={class:"label-control"},Re=w(()=>r("span",null,"\u8303\u56F4",-1)),He={class:"label-control"},Le=w(()=>r("span",null,"\u5F62\u72B6",-1)),Ne=w(()=>r("option",{value:1},"\u83F1\u5F62",-1)),Oe=w(()=>r("option",{value:2},"\u5708\u6570",-1)),qe=[Ne,Oe],Te={class:"label-control"},ze=w(()=>r("span",null,"\u6392\u5E8F",-1)),Ke=w(()=>r("option",{value:1},"\u8DDD\u79BBX",-1)),Pe=w(()=>r("option",{value:2},"\u8DDD\u79BBY",-1)),Xe=w(()=>r("option",{value:3},"X\u4F18\u5148",-1)),je=w(()=>r("option",{value:4},"Y\u4F18\u5148",-1)),Je=[Ke,Pe,Xe,je],We=w(()=>r("button",{class:"btn"},"\u9884\u8BBE\u573A\u666F",-1)),Ze=["onClick"],Qe=["onClick"],Ye={class:"color-container"},to={class:"label-control"},eo=w(()=>r("span",null,"\u9884\u89C8",-1)),oo=$t(" E "),no={class:"label-control"},ro=w(()=>r("span",null,"\u6587\u5B57",-1)),ao={class:"label-control"},so=w(()=>r("span",null,"\u80CC\u666F",-1)),lo=w(()=>r("label",{class:"label-control"},[r("span",null,"\u9884\u8BBE")],-1)),io={class:"color-tpls"},yo=$t(" E "),uo={width:"32",height:"32",viewBox:"0 0 24 24",fill:"#a9a9a9",style:{"pointer-events":"none"}},co=w(()=>r("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"},null,-1)),po=[co],xo={class:"props-container"},fo={key:0,class:"props-content"},vo={class:"label-control"},mo=w(()=>r("span",null,"\u9884\u89C8",-1)),bo={class:"label-control"},go=w(()=>r("span",null,"\u6587\u5B57",-1)),ho={class:"label-control"},wo=w(()=>r("span",null,"\u80CC\u666F",-1)),_o={class:"label-control"},ko=w(()=>r("span",null,"\u5927\u5C0F",-1)),Co={class:"label-control"},Eo=w(()=>r("span",null,"\u5185\u5BB9",-1)),Bo={class:"label-control"},Do=w(()=>r("span",null,"\u5730\u5F62",-1)),Fo=["value"],So=["value"],Vo=["value"],Go={class:"label-control"},Io=w(()=>r("span",null,"Id",-1)),$o={class:"label-control"},Mo=w(()=>r("span",null,"\u7C7B\u578B",-1)),Uo=["value"],Ao=["value"],Ro=["value"],Ho=["value"],Lo={class:"label-control"},No=w(()=>r("span",null,"\u98DE\u884C",-1)),Oo={class:"content"},qo={class:"grids"},To={class:"heroes"},zo=pt({__name:"Grids",setup(o){const{rows:y,cols:_,actorId:x,grids:l,selects:s,gridColors:a,defGridUnit:d,defGridState:g,defGrid:C,cleanGrid:G,cleanGrids:A,setSize:H,getGrid:M,gridForEach:J}=Ce(),Z=j(),c=it({editor:1,selectRange:5,shape:1,sortType:1,color:a[0].color,bgcolor:a[0].bgcolor,terrain:void 0}),P=C();P.terrain={image:Dt,type:$.BLOCKED};const z=C();z.terrain={image:Bt,type:$.CLIFF};function B(e){c.color=e.color,c.bgcolor=e.bgcolor,c.terrain=void 0}function U(e){c.color="",c.bgcolor="",c.terrain=e.terrain}const{heroes:R}=le(),p=kt(C(d())),F=kt(R.value.map(e=>{const t=C(),i=d();return i.image=`https://media.zlongame.com/media/news/cn/tdj/info/data/heroicon/${e.hero_icon}.png`,i.name=e.name,t.unit=i,t}));Ft(R,()=>{F.value=R.value.map(e=>{const t=C(),i=d();return i.image=`https://media.zlongame.com/media/news/cn/tdj/info/data/heroicon/${e.hero_icon}.png`,t.unit=i,t})});function O(e,t,i,b){const u=[];return J(m=>{m.state=g()}),J(m=>{const n=Math.abs(e-m.x),f=Math.abs(t-m.y),S=n+f,L=Math.max(n,f),N=n>1?n-1:n+f>1?f-1:f;switch(b){case 1:S<=i&&(m.state.d=S,m.state.q=L,m.state.d1=N,u.push(m));break;case 2:Math.abs(n)<=i&&Math.abs(f)<=i&&(m.state.d=S,m.state.q=L,m.state.d1=N,u.push(m));break}}),u}function Q(e,t,i,b,u,m,n){const f=O(e,t,i,b);switch(f.forEach(S=>{S.data.color=m,S.data.bgcolor=n}),s.value=f,u){case 1:s.value.sort(Ut);break;case 2:s.value.sort(ft);break;case 3:s.value.sort(At);break;case 4:s.value.sort(Rt);break}for(let S=0;S<s.value.length;S++){const L=s.value[S];L.data.txt=String(S+1)}}function Ut(e,t){return e.state.q!==t.state.q?e.state.q-t.state.q:e.state.d!==t.state.d?e.state.d-t.state.d:e.x!==t.x?e.x-t.x:e.y!==t.y?e.y-t.y:0}function ft(e,t){return e.state.q!==t.state.q?e.state.q-t.state.q:e.state.d!==t.state.d?e.state.d-t.state.d:e.y!==t.y?e.y-t.y:e.x!==t.x?e.x-t.x:0}function At(e,t){return e.x!==t.x?e.x-t.x:e.y!==t.y?e.y-t.y:0}function Rt(e,t){return e.y!==t.y?e.y-t.y:e.x!==t.x?e.x-t.x:0}const h=it({enabled:!1});function Ht(){A()}function vt(){h.enabled=!1}function Lt(e,t){var i;switch(c.editor){case 1:case 4:h.current=t,(i=Z.value)==null||i.focus();break;case 3:A(),Q(t.x,t.y,c.selectRange,c.shape,c.sortType,c.color,c.bgcolor);break}}function Nt(e,t){if(e.button===0)switch(c.editor){case 2:{h.enabled=!0,t.data.color=c.color,t.data.bgcolor=c.bgcolor,c.terrain?(t.terrain.type=c.terrain.type,t.terrain.image=c.terrain.image):(t.terrain.type=$.NONE,t.terrain.image="");break}}}function Ot(e,t){e.button===0&&h.enabled&&(t.data.color=c.color,t.data.bgcolor=c.bgcolor,c.terrain?(t.terrain.type=c.terrain.type,t.terrain.image=c.terrain.image):(t.terrain.type=$.NONE,t.terrain.image=""))}function qt(){h.current=void 0}const nt=j({width:15,height:15});function Tt(){try{const e=localStorage.getItem("grids");if(!e)return;const t=JSON.parse(e);nt.value=t}catch{}}function mt(){if(!confirm("\u786E\u5B9A\u8981\u4FDD\u5B58\u5417\uFF1F"))return;let t=l.value.flat().filter(i=>i.terrain.type!==$.NONE||i.unit&&i.unit.actorId>0);t=ut.cloneDeep(t),nt.value={width:_.value,height:y.value,data:t},localStorage.setItem("grids",JSON.stringify(nt.value))}function zt(){const e=nt.value;if(!!e.data){H(e.width,e.height);for(const t of e.data){const i=M(t.x,t.y);!i||(t.data&&(i.data=t.data),t.terrain&&(i.terrain=t.terrain),t.unit&&t.unit.actorId>0&&(i.unit=t.unit))}}}function Kt(e){H(e.width,e.height),e.data.forEach(t=>{const i=M(t.x,t.y);if(!!i)switch(t.type){case $.CLIFF:i.terrain={image:Bt,type:$.CLIFF};break;case $.BLOCKED:i.terrain={image:Dt,type:$.BLOCKED};break}})}function Pt(){const e=h.current;if(!e)return;nt.value||mt();let t,i,b=[];for(t=e.x-2;t<=e.x+2;t++)for(i=e.y-2;i<=e.y+2;i++){const n=M(t,i);!n||(n.x===e.x&&n.y===e.y?(b[0]&&b.push(b[0]),b[0]=n):b.push(n))}b=b.filter(n=>n.unit&&!(n.x===e.x&&n.y===e.y));const u=b.map(n=>({unit:n.unit}));b.forEach(n=>{G(n)});const m=O(e.x,e.y,4,2).filter(n=>n.terrain.type!==$.BLOCKED&&!(n.x===e.x&&n.y===e.y)).sort(ft).map(n=>[n.x,n.y]);for(const n of u)for(const[f,S]of m){const L=M(f,S);if(!!L&&!(L.unit&&L.unit.actorId>0)&&L.terrain.type!==$.BLOCKED&&!(L.terrain.type===$.CLIFF&&!n.unit.fly)){L.unit=n.unit;break}}}const k=it({}),bt=["#ffffff00","#FF3C4132","#0EBEFF32","#48CF7432","#FCD00032","#80008032"],Xt=(e,t)=>{switch(c.editor){case 2:e.preventDefault();break;default:k.grid=t,k.action="swap",e.dataTransfer&&(e.dataTransfer.effectAllowed="move")}},jt=(e,t)=>{const i=C();i.data.color=t.color,i.data.bgcolor=t.bgcolor,i.data.txt="E",k.grid=i,k.action="color"},gt=(e,t)=>{k.grid=ut.cloneDeep(t),k.action="terrain"},ht=(e,t)=>{k.grid=ut.cloneDeep(t),k.action="unit"},Jt=(e,t)=>{if(e.preventDefault(),!k.grid)return;const i=k.grid.data,b=k.grid.unit,u=k.grid.terrain;switch(k.action){case"color":t.unit||(t.unit=d()),t.unit.actorId||(t.unit.actorId=++x.value),t.data=k.grid.data;break;case"unit":if(t.unit||(t.unit=d()),t.unit.actorId||(t.unit.actorId=++x.value),!b)break;t.unit.image=b.image;break;case"swap":k.grid.data=t.data,k.grid.unit=t.unit,t.data=i,t.unit=b,(!b||b.actorId===0)&&(k.grid.terrain=t.terrain,t.terrain=u);break;case"terrain":t.terrain=u;break}k.grid=void 0,k.action=void 0,c.editor===4&&rt()};function Wt(e,t){let i=e[0].state[t];for(let b=1;b<e.length;b++)e[b].state[t]<i&&(i=e[b].state[t]);return i}function wt(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function _t(e,t,i){e.sort((n,f)=>!n.unit||!f.unit?0:+n.unit.actorId-+f.unit.actorId),e.forEach(n=>{n.state.d1=wt(n,i),n.state.d2=wt(n,t),n.unit&&(n.unit.guard=!1)});const b=Wt(e,"d1");if(e=e.filter(n=>n.state.d1===b),e.length===1)return e[0];let u=e[0],m=e.length;for(;m--;)if(e[m].state.d2<u.state.d2){u=e[m];break}return u}function Zt(){H(15,15),x.value=0;const e=[{x:7,y:9,txt:"",type:I.GUARD,bg:"#0ebeff"},{x:9,y:7,txt:"",type:I.GUARD,bg:"#0ebeff"},{x:7,y:5,txt:"",type:I.GUARD,bg:"#0ebeff"},{x:5,y:7,txt:"",type:I.GUARD,bg:"#0ebeff"},{x:8,y:6,txt:"",type:I.ATTACKER,bg:"#ff3c41"},{x:7,y:7,txt:"",type:I.SHEEP,bg:"#fcd000"}];for(const t of e){const i=M(t.x,t.y);!i||(i.unit||(i.unit=d()),i.unit.actorId=++x.value,i.unit.actorType=t.type,i.disabled=!1,i.data.txt=t.txt,i.data.bgcolor=t.bg)}c.editor=4}const rt=()=>{const e=l.value.flat();e.forEach(n=>{n.data.opacity=1});const t=e.filter(n=>n.unit&&!n.disabled),i=t.filter(n=>{var f;return((f=n.unit)==null?void 0:f.actorType)===I.ATTACKER})[0],b=t.filter(n=>{var f;return((f=n.unit)==null?void 0:f.actorType)===I.SHEEP})[0],u=t.filter(n=>{var f;return((f=n.unit)==null?void 0:f.actorType)===I.GUARD});if(!b||u.length===0){alert("\u7F3A\u5C11\u89D2\u8272\uFF0C\u5C06\u81EA\u52A8\u751F\u6210"),Zt(),rt();return}const m=e.filter(n=>!n.unit);for(const n of m){const f=_t(u,n,b);!f.unit||(n.data.image=f.unit.image,n.data.bgcolor=bt[f.unit.actorId]||bt[0],f.data.image?n.data.sup="":n.data.sup=String(f.unit.actorId),n.data.opacity=.6)}if(i){const n=_t(u,i,b);n.unit&&(n.unit.guard=!0)}},Qt=e=>{if(!!e.unit&&c.editor===4){switch(e.unit.actorType){case I.GUARD:e.disabled=!e.disabled;break}rt()}},Yt=e=>{var t;!k.grid||!e.dataTransfer||k.action==="swap"&&(c.editor===4&&((t=k.grid.unit)==null?void 0:t.actorType)===I.SHEEP||e.preventDefault())},te=e=>{if(!!k.grid&&!!e)switch(k.action){case"swap":G(e),k.grid=void 0,k.action=void 0,c.editor===4&&rt()}};return St(()=>{Tt(),window.addEventListener("mouseup",vt,!1)}),Vt(()=>{window.removeEventListener("mouseup",vt,!1)}),(e,t)=>{const i=re("c-space"),b=se("autofocus");return E(),V("div",Be,[r("div",De,[r("div",Fe,[r("label",Se,[Ve,D(r("select",{"onUpdate:modelValue":t[0]||(t[0]=u=>c.editor=u)},Ue,512),[[at,c.editor,void 0,{number:!0}]])]),r("label",Ae,[Re,D(r("input",{type:"number",min:"0","onUpdate:modelValue":t[1]||(t[1]=u=>c.selectRange=u),style:{width:"5em"}},null,512),[[K,c.selectRange]])]),r("label",He,[Le,D(r("select",{"onUpdate:modelValue":t[2]||(t[2]=u=>c.shape=u)},qe,512),[[at,c.shape]])]),r("label",Te,[ze,D(r("select",{"onUpdate:modelValue":t[3]||(t[3]=u=>c.sortType=u)},Je,512),[[at,c.sortType]])]),r("button",{class:"btn",onClick:Ht},"\u6E05\u7A7A"),r("button",{class:"btn",onClick:rt},"\u8BA1\u7B97\u62A4\u536B"),r("button",{class:"btn btn-success",onClick:mt},"\u4FDD\u5B58\u5E03\u5C40"),r("button",{class:"btn btn-success",onClick:zt},"\u8FD8\u539F\u5E03\u5C40"),X("",!0),q(v(ie),null,{popover:tt(({onClose:u})=>[r("div",{class:"list",onClick:m=>u()},[(E(!0),V(et,null,st(v(Ee),(m,n)=>(E(),V("div",{class:"list-item",key:n,onClick:f=>Kt(m)},lt(m.name),9,Qe))),128))],8,Ze)]),default:tt(()=>[We]),_:1})]),r("div",Ye,[q(i,null,{default:tt(()=>{var u,m;return[r("label",to,[eo,q(v(W),{draggable:!1,style:T([`--color:${c.color};--bgcolor:${c.bgcolor}`])},{default:tt(()=>[oo]),_:1},8,["style"])]),r("label",no,[ro,q(v(Y),{modelValue:c.color,"onUpdate:modelValue":t[4]||(t[4]=n=>c.color=n)},null,8,["modelValue"])]),r("label",ao,[so,q(v(Y),{modelValue:c.bgcolor,"onUpdate:modelValue":t[5]||(t[5]=n=>c.bgcolor=n)},null,8,["modelValue"])]),lo,r("div",io,[(E(!0),V(et,null,st(v(a),(n,f)=>(E(),yt(v(W),{key:f,selected:c.bgcolor===n.bgcolor,style:T([`--color:${n.color};--bgcolor:${n.bgcolor}`]),onClick:S=>B(n),onDragstart:S=>jt(S,n)},{default:tt(()=>[yo]),_:2},1032,["selected","style","onClick","onDragstart"]))),128)),q(v(W),{selected:((u=c.terrain)==null?void 0:u.type)===v(z).terrain.type,terrain:v(z).terrain,onClick:t[6]||(t[6]=n=>U(v(z))),onDragstart:t[7]||(t[7]=n=>gt(n,v(z)))},null,8,["selected","terrain"]),q(v(W),{selected:((m=c.terrain)==null?void 0:m.type)===v(P).terrain.type,terrain:v(P).terrain,onClick:t[8]||(t[8]=n=>U(v(P))),onDragstart:t[9]||(t[9]=n=>gt(n,v(P)))},null,8,["selected","terrain"])]),r("div",{class:"trush",onDragover:Yt,onDrop:t[10]||(t[10]=n=>te(k.grid))},[(E(),V("svg",uo,po))],32)]}),_:1})]),r("div",xo,[h.current?(E(),V("div",fo,[q(i,null,{default:tt(()=>[r("label",vo,[mo,q(v(W),{draggable:!1,style:T([`--color:${h.current.data.color};--bgcolor:${h.current.data.bgcolor}`]),item:h.current},null,8,["style","item"])]),r("label",bo,[go,q(v(Y),{modelValue:h.current.data.color,"onUpdate:modelValue":t[11]||(t[11]=u=>h.current.data.color=u)},null,8,["modelValue"])]),r("label",ho,[wo,q(v(Y),{modelValue:h.current.data.bgcolor,"onUpdate:modelValue":t[12]||(t[12]=u=>h.current.data.bgcolor=u)},null,8,["modelValue"])]),r("label",_o,[ko,D(r("input",{type:"number",style:{width:"4em"},min:"12",step:"1","onUpdate:modelValue":t[13]||(t[13]=u=>h.current.data.size=u)},null,512),[[K,h.current.data.size]])]),r("label",Co,[Eo,D(r("input",{type:"text",ref_key:"txtInput",ref:Z,"onUpdate:modelValue":t[14]||(t[14]=u=>h.current.data.txt=u),style:{width:"6em"}},null,512),[[b],[K,h.current.data.txt]])]),r("label",Bo,[Do,D(r("select",{"onUpdate:modelValue":t[15]||(t[15]=u=>h.current.terrain.type=u)},[r("option",{value:v($).NONE},"\u65E0",8,Fo),r("option",{value:v($).BLOCKED},"\u969C\u788D",8,So),r("option",{value:v($).CLIFF},"\u60AC\u5D16",8,Vo)],512),[[at,h.current.terrain.type]])]),h.current.unit?(E(),V(et,{key:0},[r("label",Go,[Io,D(r("input",{type:"number","onUpdate:modelValue":t[16]||(t[16]=u=>h.current.unit.actorId=u),style:{width:"4em"}},null,512),[[K,h.current.unit.actorId]])]),r("label",$o,[Mo,D(r("select",{"onUpdate:modelValue":t[17]||(t[17]=u=>h.current.unit.actorType=u)},[r("option",{value:v(I).NONE},"\u65E0",8,Uo),r("option",{value:v(I).GUARD},"\u62A4\u536B",8,Ao),r("option",{value:v(I).SHEEP},"\u9776\u5B50",8,Ro),r("option",{value:v(I).ATTACKER},"\u653B\u51FB\u8005",8,Ho)],512),[[at,h.current.unit.actorType]])]),r("label",Lo,[No,D(r("input",{type:"checkbox","onUpdate:modelValue":t[18]||(t[18]=u=>h.current.unit.fly=u)},null,512),[[ae,h.current.unit.fly]])])],64)):X("",!0),r("button",{class:"btn",onClick:qt},"\u5B8C\u6210"),r("button",{class:"btn btn-success",onClick:Pt},"\u602A\u529B\u4E71\u795E")]),_:1})])):X("",!0)])]),r("div",Oo,[r("div",qo,[(E(!0),V(et,null,st(v(l),(u,m)=>(E(),V("div",{class:"grids-row",key:m},[(E(!0),V(et,null,st(u,(n,f)=>{var S,L;return E(),yt(v(W),{key:f,draggable:!0,selected:n.x===((S=h.current)==null?void 0:S.x)&&n.y===((L=h.current)==null?void 0:L.y),disabled:n.disabled,dot:n.unit&&n.unit.guard,data:n.data,terrain:n.terrain,overlay:n.overlay,unit:n.unit,onDragstart:N=>Xt(N,n),onDragover:t[19]||(t[19]=ot(()=>{},["prevent"])),onDrop:N=>Jt(N,n),onContextmenu:ot(N=>Qt(n),["prevent"]),onClick:N=>Lt(N,n),onMousedown:N=>Nt(N,n),onMouseenter:N=>Ot(N,n)},null,8,["selected","disabled","dot","data","terrain","overlay","unit","onDragstart","onDrop","onContextmenu","onClick","onMousedown","onMouseenter"])}),128))]))),128))]),r("div",To,[q(v(W),{item:v(p),onDragstart:t[20]||(t[20]=u=>ht(u,v(p)))},null,8,["item"]),(E(!0),V(et,null,st(v(F),(u,m)=>(E(),yt(v(W),{key:m,data:u.data,terrain:u.terrain,overlay:u.overlay,unit:u.unit,onDragstart:n=>ht(n,u)},null,8,["data","terrain","overlay","unit","onDragstart"]))),128))])])])}}});const jo=dt(zo,[["__scopeId","data-v-3bc6b0bd"]]);export{jo as default};
