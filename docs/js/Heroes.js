import{d as q,_ as H,o as c,c as m,a as e,p as j,b as M,t as at,e as J,r as g,f as ut,g as h,h as i,w as U,v as P,F as N,i as V,j as D,n as it,k as K,T as dt,l as rt,m as ct,D as pt,q as O,s as b,u as mt,x as _t,y as vt,z as E,A as R,B as ht}from"./index.js";import{u as ft,a as $t,_ as L}from"./lodash.js";const yt=q({props:{type:String},setup(){return{}}}),bt={key:0,class:"c-sort-desc"},Ct={key:1,class:"c-sort-asc"},wt={key:2,class:"c-sort-none"};function Ft(t,o,_,f,C,A){return t.type==="DESC"?(c(),m("span",bt)):t.type==="ASC"?(c(),m("span",Ct)):(c(),m("span",wt))}var gt=H(yt,[["render",Ft]]),Et=q({props:{hp:Number,patt:Number,pdef:Number,matt:Number,mdef:Number,crit:Number,readonly:Boolean},emits:["update:hp","update:patt","update:pdef","update:matt","update:mdef","update:crit"],setup(t,{emit:o}){return{update:(f,C)=>{o(`update:${f}`,+C.currentTarget.value)}}}});const T=t=>(j("data-v-27ab2e04"),t=t(),M(),t),kt={class:"form"},St={class:"form-item"},Dt=T(()=>e("label",{for:""},"\u6C14\u8840",-1)),Bt=["readonly","value"],At={class:"form-item"},Nt=T(()=>e("label",{for:""},"\u7269\u653B",-1)),Tt=["readonly","value"],It={class:"form-item"},Ut=T(()=>e("label",{for:""},"\u7269\u9632",-1)),Vt=["readonly","value"],qt={class:"form-item"},Ht=T(()=>e("label",{for:""},"\u6CD5\u653B",-1)),zt=["readonly","value"],Ot={class:"form-item"},jt=T(()=>e("label",{for:""},"\u6CD5\u9632",-1)),Mt=["readonly","value"],Pt={class:"form-item"},Rt=T(()=>e("label",{for:""},"\u4F1A\u5FC3",-1)),Lt=["readonly","value"];function Jt(t,o,_,f,C,A){return c(),m("div",kt,[e("div",St,[Dt,e("input",{type:"number",readonly:t.readonly,value:t.hp,onInput:o[0]||(o[0]=u=>t.update("hp",u))},null,40,Bt)]),e("div",At,[Nt,e("input",{type:"number",readonly:t.readonly,value:t.patt,onInput:o[1]||(o[1]=u=>t.update("patt",u))},null,40,Tt)]),e("div",It,[Ut,e("input",{type:"number",readonly:t.readonly,value:t.pdef,onInput:o[2]||(o[2]=u=>t.update("pdef",u))},null,40,Vt)]),e("div",qt,[Ht,e("input",{type:"number",readonly:t.readonly,value:t.matt,onInput:o[3]||(o[3]=u=>t.update("matt",u))},null,40,zt)]),e("div",Ot,[jt,e("input",{type:"number",readonly:t.readonly,value:t.mdef,onInput:o[4]||(o[4]=u=>t.update("mdef",u))},null,40,Mt)]),e("div",Pt,[Rt,e("input",{type:"number",readonly:t.readonly,value:t.crit,onInput:o[5]||(o[5]=u=>t.update("crit",u))},null,40,Lt)])])}var Kt=H(Et,[["render",Jt],["__scopeId","data-v-27ab2e04"]]);const Gt=q({props:{record:Object,width:String,height:String},emits:["update:record","save"],setup(t,{emit:o}){const _=[["qixue","\u6C14\u8840"],["physical_attack","\u7269\u653B"],["physical_defense","\u7269\u9632"],["magic_attack","\u6CD5\u653B"],["magic_defense","\u6CD5\u9632"],["huixin","\u4F1A\u5FC3"]],f=at(t,"record"),C=J(()=>{const d=t.width||600,a=t.height||400;return{width:Number(d)?`${d}px`:d,height:Number(a)?`${a}px`:a}});return{names:_,model:f,dialogStyle:C,onEditorSave:d=>{o("save",d),o("update:record",void 0)},onEditorCanel:()=>{o("update:record",void 0)},prefixNames:(d,a)=>_.map(([v,w])=>[d.replace("$&",v),a.replace("$&",w)])}}}),p=t=>(j("data-v-5c01ac4e"),t=t(),M(),t),Qt={key:0,class:rt(["modal active"])},Wt={class:"modal-body"},Xt={class:"models-container"},Yt={class:"models"},Zt={class:"model-item"},xt=p(()=>e("label",null,"ID",-1)),te={class:"input"},ee={class:"model-item"},oe=p(()=>e("label",null,"\u540D\u79F0",-1)),se={class:"model-item"},ne=p(()=>e("label",null,"\u5C5E\u76F8",-1)),le=p(()=>e("option",{value:"\u708E"},"\u708E",-1)),ae=p(()=>e("option",{value:"\u96F7"},"\u96F7",-1)),ue=p(()=>e("option",{value:"\u51B0"},"\u51B0",-1)),ie=p(()=>e("option",{value:"\u5149"},"\u5149",-1)),de=p(()=>e("option",{value:"\u6697"},"\u6697",-1)),re=[le,ae,ue,ie,de],ce={class:"model-item"},pe=p(()=>e("label",null,"\u804C\u4E1A",-1)),me=p(()=>e("option",{value:"\u94C1\u536B"},"\u94C1\u536B",-1)),_e=p(()=>e("option",{value:"\u4FA0\u5BA2"},"\u4FA0\u5BA2",-1)),ve=p(()=>e("option",{value:"\u5492\u5E08"},"\u5492\u5E08",-1)),he=p(()=>e("option",{value:"\u795D\u7531"},"\u795D\u7531",-1)),fe=p(()=>e("option",{value:"\u5FA1\u98CE"},"\u5FA1\u98CE",-1)),$e=p(()=>e("option",{value:"\u7FBD\u58EB"},"\u7FBD\u58EB",-1)),ye=[me,_e,ve,he,fe,$e],be={class:"modal-footer"};function Ce(t,o,_,f,C,A){const u=g("c-input-text"),S=g("c-input-number"),d=g("c-space");return c(),ut(dt,{to:"body"},[t.model?(c(),m("div",Qt,[e("div",{class:"modal-mask",onClick:o[0]||(o[0]=(...a)=>t.onEditorCanel&&t.onEditorCanel(...a))}),e("div",{class:"modal-dialog",style:it(t.dialogStyle)},[e("div",Wt,[e("div",Xt,[e("div",Yt,[e("div",Zt,[xt,e("div",te,h(t.model.id),1)]),e("div",ee,[oe,i(u,{value:t.model.name,"onUpdate:value":o[1]||(o[1]=a=>t.model.name=a)},null,8,["value"])]),e("div",se,[ne,U(e("select",{class:"input","onUpdate:modelValue":o[2]||(o[2]=a=>t.model.prop=a)},re,512),[[P,t.model.prop]])]),e("div",ce,[pe,U(e("select",{class:"input","onUpdate:modelValue":o[3]||(o[3]=a=>t.model.career=a)},ye,512),[[P,t.model.career]])])]),(c(),m(N,null,V([["panel_$&","\u9762\u677F$&"],["basic_$&","\u57FA\u7840$&"],["equipment1_$&","\u5934\u90E8$&"],["equipment2_$&","\u8EAB\u4F53$&"],["equipment3_$&","\u8170\u90E8$&"],["equipment4_$&","\u624B\u90E8$&"],["wunei0_$&","\u4E3B\u7EBF$&"],["wunei1_$&","\u4E0A\u7EBF$&"],["wunei2_$&","\u4E0B\u7EBF$&"],["huazhen_$&","\u5316\u81FB$&"],["$&","0\u7EA7$&"],["$&_cz","$&\u6210\u957F"]],([a,v])=>e("div",{class:"models",key:a},[(c(!0),m(N,null,V(t.prefixNames(a,v),([w,s])=>(c(),m("div",{class:"model-item",key:w},[e("label",null,h(s),1),i(S,{value:t.model[w],"onUpdate:value":I=>t.model[w]=I},null,8,["value","onUpdate:value"])]))),128))])),64))])]),e("div",be,[i(d,null,{default:D(()=>[e("button",{class:"btn btn-sm btn-primary-outline",onClick:o[4]||(o[4]=a=>t.onEditorSave(t.model))}," \u4FDD\u5B58 "),e("button",{class:"btn btn-sm btn-danger-outline",onClick:o[5]||(o[5]=a=>t.onEditorCanel())}," \u53D6\u6D88 ")]),_:1})])],4)])):K("",!0)])}var we=H(Gt,[["render",Ce],["__scopeId","data-v-5c01ac4e"]]);const Fe=q({components:{SortIcon:gt,PropPanel:Kt,HeroModelVue:we},setup(){const t=ct(pt),o=J(()=>Q(b.value)),_=O(-1),{editor:f,defaultHeroState:C}=ft(),A=n=>{const l=b.value.find(r=>r.id===n);!l||(_.value=n,f.value=L.cloneDeep(l))},u=async n=>{_.value=-1;const l=b.value.find(r=>r.id===n.id);if(!!l){Object.assign(l,n);try{if(!t)return;await t.connect(),await t.put("heroes",L.cloneDeep(l))}catch(r){console.log(r)}}},S=()=>{_.value=-1};function d(n){if(n instanceof Error)switch(n.name){case"ConstraintError":alert("\u6570\u636E\u5DF2\u7ECF\u5B58\u5728");break;default:alert(n.message)}else alert(n)}async function a(){try{await _t()}catch(n){d(n)}}async function v(){try{if(!t)return;const n=C();await t.connect(),delete n.id;const l=await t.add("heroes",n),r=await t.get("heroes",l);if(!r)return;b.value.push(r)}catch(n){d(n)}}async function w(n){try{if(!t||!n.id||!confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F"))return;await t.connect(),await t.delete("heroes",n.id),b.value=b.value.filter(l=>l.id!==n.id)}catch(l){d(l)}}function s(n){return new Promise((l,r)=>{const F=new FileReader;F.onload=()=>{l(JSON.parse(F.result))},F.onerror=()=>{r(F.error)},F.readAsText(n)})}async function I(n){try{const l=n.currentTarget,r=l.files;if(!r||!t)return;await t.connect(),console.log("\u5BFC\u5165\u6570\u636E");for(let F=0;F<r.length;F++){const lt=await s(r[F]);for(const z of lt)z.id=Number(z.weight),await t.put("heroes",z)}l.value="",a()}catch(l){d(l)}}function $(){const n=new Blob([JSON.stringify(b.value)]),l=document.createElement("a");l.href=URL.createObjectURL(n),l.download="heroes.json",l.click(),URL.revokeObjectURL(l.href)}const y=O("name"),k=O("");function G(n){if(y.value===n)switch(k.value){case"DESC":k.value="ASC";break;case"ASC":k.value="";break;default:k.value="DESC"}else y.value=n,k.value="DESC"}function Q(n){return n.slice().sort((l,r)=>{switch(y.value){case"basic_qixue":case"basic_physical_attack":case"basic_physical_defense":case"basic_magic_attack":case"basic_magic_defense":case"basic_huixin":return k.value==="DESC"?r[y.value]-l[y.value]:k.value==="ASC"?l[y.value]-r[y.value]:0;default:return 0}})}function W(){vt()}(!b.value||b.value.length===0)&&a();const{show:X,form:Y,calc:Z,open:x,close:tt,toggle:et,translate:ot,xinyao:st,huazhen:nt}=$t();return{editable:_,editor:f,onEditorOpen:A,onEditorSave:u,onEditorCanel:S,sources:b,list:o,add:v,remove:w,exportData:$,importData:I,sortName:y,sortType:k,switchSort:G,loadDefault:W,toolsShow:X,toolsForm:Y,toolsCalc:Z,toolsOpen:x,toolsClose:tt,toolsToggle:et,toolsTranslate:ot,xinyao:st,huazhen:nt}}}),B=t=>(j("data-v-8ed1684c"),t=t(),M(),t),ge={class:"toolbar"},Ee=E("\u4EBA\u7269\u5217\u8868"),ke={class:"c-label"},Se=E(" \u661F\u8000 "),De={class:"c-label"},Be=E(" \u5316\u81FB "),Ae={class:"c-upload"},Ne={class:"c-upload"},Te=B(()=>e("button",{class:"btn btn-success"},"\u5BFC\u5165",-1)),Ie={key:0,class:"transform-popup"},Ue={class:"row"},Ve={class:"col-auto"},qe={class:"col-auto"},He={class:"content"},ze={class:"table-wrap"},Oe={class:"table table-bordered",style:{"min-width":"100%"}},je=B(()=>e("colgroup",null,[e("col",{width:"60"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"100"})],-1)),Me={style:{position:"sticky",top:"100px"}},Pe=B(()=>e("th",null,"#",-1)),Re=B(()=>e("th",null,"\u540D\u5B57",-1)),Le=E(" \u6C14\u8840 "),Je=E(" \u7269\u653B "),Ke=E(" \u7269\u9632 "),Ge=E(" \u6CD5\u653B "),Qe=E(" \u6CD5\u9632 "),We=E(" \u4F1A\u5FC3 "),Xe=B(()=>e("th",null,"\u5C5E\u6027",-1)),Ye=B(()=>e("th",null,"\u804C\u4E1A",-1)),Ze=B(()=>e("th",null,"\u64CD\u4F5C",-1)),xe={class:"cell-static text-center"},to={class:"cell-static text-center"},eo={class:"cell-static text-center"},oo={class:"cell-static text-center"},so={class:"cell-static text-center"},no={class:"cell-static text-center"},lo={class:"cell-static text-center"},ao={class:"cell-static text-center"},uo={class:"cell-static text-center"},io={class:"cell-static text-center"},ro={class:"cell-static"},co=["onClick"],po=["onClick"];function mo(t,o,_,f,C,A){const u=g("c-col"),S=g("c-space"),d=g("prop-panel"),a=g("c-row"),v=g("SortIcon"),w=g("HeroModelVue");return c(),m(N,null,[e("div",mt({class:"wrapper"},t.$attrs),[e("div",ge,[i(a,{flex:"",middle:"",style:{padding:"4px 16px"}},{default:D(()=>[i(u,{flex:"1 0 auto"},{default:D(()=>[Ee]),_:1}),i(u,{flex:"0 0 auto"},{default:D(()=>[i(S,{size:"8"},{default:D(()=>[e("label",ke,[U(e("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=s=>t.xinyao=s)},null,512),[[R,t.xinyao]]),Se]),e("label",De,[U(e("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=s=>t.huazhen=s)},null,512),[[R,t.huazhen]]),Be])]),_:1}),e("div",Ae,[e("button",{class:"btn btn-danger",onClick:o[2]||(o[2]=(...s)=>t.loadDefault&&t.loadDefault(...s))}," \u8F7D\u5165\u9ED8\u8BA4 ")]),e("div",Ne,[Te,e("input",{type:"file",class:"c-upload-input",accept:"application/json",onInput:o[3]||(o[3]=(...s)=>t.importData&&t.importData(...s))},null,32)]),e("button",{class:"btn btn-success",onClick:o[4]||(o[4]=(...s)=>t.exportData&&t.exportData(...s))},"\u5BFC\u51FA"),e("button",{class:"btn btn-primary",onClick:o[5]||(o[5]=s=>t.add())},"\u6DFB\u52A0"),e("button",{class:"btn btn-primary",onClick:o[6]||(o[6]=(...s)=>t.toolsToggle&&t.toolsToggle(...s))},"\u8F6C\u6362\u5DE5\u5177"),i(ht,{name:"popup"},{default:D(()=>[t.toolsShow?(c(),m("div",Ie,[e("div",Ue,[e("div",Ve,[i(d,{hp:t.toolsForm.hp,"onUpdate:hp":o[7]||(o[7]=s=>t.toolsForm.hp=s),patt:t.toolsForm.patt,"onUpdate:patt":o[8]||(o[8]=s=>t.toolsForm.patt=s),pdef:t.toolsForm.pdef,"onUpdate:pdef":o[9]||(o[9]=s=>t.toolsForm.pdef=s),matt:t.toolsForm.matt,"onUpdate:matt":o[10]||(o[10]=s=>t.toolsForm.matt=s),mdef:t.toolsForm.mdef,"onUpdate:mdef":o[11]||(o[11]=s=>t.toolsForm.mdef=s),crit:t.toolsForm.crit,"onUpdate:crit":o[12]||(o[12]=s=>t.toolsForm.crit=s)},null,8,["hp","patt","pdef","matt","mdef","crit"])]),e("div",qe,[i(d,{hp:t.toolsCalc(t.toolsForm.hp,1.35,1.45),patt:t.toolsCalc(t.toolsForm.patt,1.25,1.35),pdef:t.toolsCalc(t.toolsForm.pdef,1.35,1.55),matt:t.toolsCalc(t.toolsForm.matt,1.25,1.35),mdef:t.toolsCalc(t.toolsForm.mdef,1.35,1.55),crit:t.toolsCalc(t.toolsForm.crit,1.25,1),readonly:""},null,8,["hp","patt","pdef","matt","mdef","crit"])])])])):K("",!0)]),_:1})]),_:1})]),_:1})]),e("div",He,[e("div",ze,[e("table",Oe,[je,e("thead",Me,[e("tr",null,[Pe,Re,e("th",null,[Le,i(v,{type:t.sortName==="basic_qixue"?t.sortType:"",onClick:o[13]||(o[13]=s=>t.switchSort("basic_qixue"))},null,8,["type"])]),e("th",null,[Je,i(v,{type:t.sortName==="basic_physical_attack"?t.sortType:"",onClick:o[14]||(o[14]=s=>t.switchSort("basic_physical_attack"))},null,8,["type"])]),e("th",null,[Ke,i(v,{type:t.sortName==="basic_physical_defense"?t.sortType:"",onClick:o[15]||(o[15]=s=>t.switchSort("basic_physical_defense"))},null,8,["type"])]),e("th",null,[Ge,i(v,{type:t.sortName==="basic_magic_attack"?t.sortType:"",onClick:o[16]||(o[16]=s=>t.switchSort("basic_magic_attack"))},null,8,["type"])]),e("th",null,[Qe,i(v,{type:t.sortName==="basic_magic_defense"?t.sortType:"",onClick:o[17]||(o[17]=s=>t.switchSort("basic_magic_defense"))},null,8,["type"])]),e("th",null,[We,i(v,{type:t.sortName==="basic_huixin"?t.sortType:"",onClick:o[18]||(o[18]=s=>t.switchSort("basic_huixin"))},null,8,["type"])]),Xe,Ye,Ze])]),e("tbody",null,[(c(!0),m(N,null,V(t.list,(s,I)=>(c(),m("tr",{key:s.id,class:"c-user-row"},[e("td",xe,h(I+1),1),e("td",to,h(s.name),1),(c(!0),m(N,null,V([t.toolsTranslate(s)],($,y)=>(c(),m(N,{key:y},[e("td",eo,h($.qixue),1),e("td",oo,h($.patt),1),e("td",so,h($.pdef),1),e("td",no,h($.matt),1),e("td",lo,h($.mdef),1),e("td",ao,h($.huixin),1)],64))),128)),e("td",uo,h(s.prop),1),e("td",io,h(s.career),1),e("td",ro,[i(S,null,{default:D(()=>[e("button",{class:"btn btn-sm btn-primary-outline",onClick:$=>t.onEditorOpen(s.id)}," \u7F16\u8F91 ",8,co),e("button",{class:"btn btn-sm btn-danger-outline",onClick:$=>t.remove(s)}," \u5220\u9664 ",8,po)]),_:2},1024)])]))),128))])])])])],16),i(w,{record:t.editor,"onUpdate:record":o[19]||(o[19]=s=>t.editor=s),width:"800",height:"600",onSave:t.onEditorSave},null,8,["record","onSave"])],64)}var ho=H(Fe,[["render",mo],["__scopeId","data-v-8ed1684c"]]);export{ho as default};
