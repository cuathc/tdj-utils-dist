import{d as H,_ as z,o as _,c as m,t as x,a as M,r as E,b as ee,e,f as v,g as c,w as D,v as U,F as A,h as V,i as S,n as te,j as oe,T as se,k as ne,p as R,l as L,m as le,D as ae,q as ue,s as q,u as f,x as ie,y as ce,z as re,A as w,B as de,C as j}from"./index.js";import{u as pe,a as _e}from"./useTransformTools.js";import{_ as O}from"./lodash.js";const he=H({props:{type:String},setup(){return{}}}),ve={key:0,class:"c-sort-desc"},me={key:1,class:"c-sort-asc"},fe={key:2,class:"c-sort-none"};function be(t,o,B,b,F,N){return t.type==="DESC"?(_(),m("span",ve)):t.type==="ASC"?(_(),m("span",me)):(_(),m("span",fe))}var $e=z(he,[["render",be]]);const ye=H({props:{record:Object,width:String,height:String},emits:["update:record","save"],setup(t,{emit:o}){const B=[["qixue","\u6C14\u8840"],["physical_attack","\u7269\u653B"],["physical_defense","\u7269\u9632"],["magic_attack","\u6CD5\u653B"],["magic_defense","\u6CD5\u9632"],["huixin","\u4F1A\u5FC3"]],b=x(t,"record"),F=M(()=>{const p=t.width||600,a=t.height||400;return{width:Number(p)?`${p}px`:p,height:Number(a)?`${a}px`:a}});return{names:B,model:b,dialogStyle:F,onEditorSave:p=>{o("save",p),o("update:record",void 0)},onEditorCanel:()=>{o("update:record",void 0)},prefixNames:(p,a)=>B.map(([$,s])=>[p.replace("$&",$),a.replace("$&",s)])}}}),r=t=>(R("data-v-5c01ac4e"),t=t(),L(),t),Ce={key:0,class:ne(["modal active"])},Ee={class:"modal-body"},we={class:"models-container"},Be={class:"models"},Fe={class:"model-item"},ge=r(()=>e("label",null,"ID",-1)),ke={class:"input"},De={class:"model-item"},Se=r(()=>e("label",null,"\u540D\u79F0",-1)),Ae={class:"model-item"},Ne=r(()=>e("label",null,"\u5C5E\u76F8",-1)),Te=r(()=>e("option",{value:"\u708E"},"\u708E",-1)),Ue=r(()=>e("option",{value:"\u96F7"},"\u96F7",-1)),Ve=r(()=>e("option",{value:"\u51B0"},"\u51B0",-1)),Ie=r(()=>e("option",{value:"\u5149"},"\u5149",-1)),qe=r(()=>e("option",{value:"\u6697"},"\u6697",-1)),He=[Te,Ue,Ve,Ie,qe],ze={class:"model-item"},je=r(()=>e("label",null,"\u804C\u4E1A",-1)),Oe=r(()=>e("option",{value:"\u94C1\u536B"},"\u94C1\u536B",-1)),Me=r(()=>e("option",{value:"\u4FA0\u5BA2"},"\u4FA0\u5BA2",-1)),Re=r(()=>e("option",{value:"\u5492\u5E08"},"\u5492\u5E08",-1)),Le=r(()=>e("option",{value:"\u795D\u7531"},"\u795D\u7531",-1)),Je=r(()=>e("option",{value:"\u5FA1\u98CE"},"\u5FA1\u98CE",-1)),Pe=r(()=>e("option",{value:"\u7FBD\u58EB"},"\u7FBD\u58EB",-1)),Ke=[Oe,Me,Re,Le,Je,Pe],Ge={class:"modal-footer"};function Qe(t,o,B,b,F,N){const g=E("c-input-text"),k=E("c-input-number"),p=E("c-space");return _(),ee(se,{to:"body"},[t.model?(_(),m("div",Ce,[e("div",{class:"modal-mask",onClick:o[0]||(o[0]=(...a)=>t.onEditorCanel&&t.onEditorCanel(...a))}),e("div",{class:"modal-dialog",style:te(t.dialogStyle)},[e("div",Ee,[e("div",we,[e("div",Be,[e("div",Fe,[ge,e("div",ke,v(t.model.id),1)]),e("div",De,[Se,c(g,{value:t.model.name,"onUpdate:value":o[1]||(o[1]=a=>t.model.name=a)},null,8,["value"])]),e("div",Ae,[Ne,D(e("select",{class:"input","onUpdate:modelValue":o[2]||(o[2]=a=>t.model.prop=a)},He,512),[[U,t.model.prop]])]),e("div",ze,[je,D(e("select",{class:"input","onUpdate:modelValue":o[3]||(o[3]=a=>t.model.career=a)},Ke,512),[[U,t.model.career]])])]),(_(),m(A,null,V([["panel_$&","\u9762\u677F$&"],["basic_$&","\u57FA\u7840$&"],["equipment1_$&","\u5934\u90E8$&"],["equipment2_$&","\u8EAB\u4F53$&"],["equipment3_$&","\u8170\u90E8$&"],["equipment4_$&","\u624B\u90E8$&"],["wunei0_$&","\u4E3B\u7EBF$&"],["wunei1_$&","\u4E0A\u7EBF$&"],["wunei2_$&","\u4E0B\u7EBF$&"],["huazhen_$&","\u5316\u81FB$&"],["$&","0\u7EA7$&"],["$&_cz","$&\u6210\u957F"]],([a,$])=>e("div",{class:"models",key:a},[(_(!0),m(A,null,V(t.prefixNames(a,$),([s,T])=>(_(),m("div",{class:"model-item",key:s},[e("label",null,v(T),1),c(k,{value:t.model[s],"onUpdate:value":h=>t.model[s]=h},null,8,["value","onUpdate:value"])]))),128))])),64))])]),e("div",Ge,[c(p,null,{default:S(()=>[e("button",{class:"btn btn-sm btn-primary-outline",onClick:o[4]||(o[4]=a=>t.onEditorSave(t.model))}," \u4FDD\u5B58 "),e("button",{class:"btn btn-sm btn-danger-outline",onClick:o[5]||(o[5]=a=>t.onEditorCanel())}," \u53D6\u6D88 ")]),_:1})])],4)])):oe("",!0)])}var We=z(ye,[["render",Qe],["__scopeId","data-v-5c01ac4e"]]);const Xe=H({components:{SortIcon:$e,HeroModelVue:We},setup(){const t=le(ae),o=ue({name:"",prop:"",career:""}),B=M(()=>K(f.value)),b=q(-1),{editor:F,defaultHeroState:N}=pe(),g=l=>{const n=f.value.find(u=>u.id===l);!n||(b.value=l,F.value=O.cloneDeep(n))},k=async l=>{b.value=-1;const n=f.value.find(u=>u.id===l.id);if(!!n){Object.assign(n,l);try{if(!t)return;await t.connect(),await t.put("heroes",O.cloneDeep(n))}catch(u){console.log(u)}}},p=()=>{b.value=-1};function a(l){if(l instanceof Error)switch(l.name){case"ConstraintError":alert("\u6570\u636E\u5DF2\u7ECF\u5B58\u5728");break;default:alert(l.message)}else alert(l)}async function $(){try{await ce()}catch(l){a(l)}}async function s(){try{if(!t)return;const l=N();await t.connect(),delete l.id;const n=await t.add("heroes",l),u=await t.get("heroes",n);if(!u)return;f.value.push(u)}catch(l){a(l)}}async function T(l){try{if(!t||!l.id||!confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F"))return;await t.connect(),await t.delete("heroes",l.id),f.value=f.value.filter(n=>n.id!==l.id)}catch(n){a(n)}}function h(l){return new Promise((n,u)=>{const d=new FileReader;d.onload=()=>{n(JSON.parse(d.result))},d.onerror=()=>{u(d.error)},d.readAsText(l)})}async function I(l){try{const n=l.currentTarget,u=n.files;if(!u||!t)return;await t.connect(),console.log("\u5BFC\u5165\u6570\u636E");for(let d=0;d<u.length;d++){const Y=await h(u[d]);for(const Z of Y)await t.put("heroes",Z)}n.value="",$()}catch(n){a(n)}}function J(){const l=new Blob([JSON.stringify(f.value)]),n=document.createElement("a");n.href=URL.createObjectURL(l),n.download="heroes.json",n.click(),URL.revokeObjectURL(n.href)}const y=q("name"),C=q("");function P(l){if(y.value===l)switch(C.value){case"DESC":C.value="ASC";break;case"ASC":C.value="";break;default:C.value="DESC"}else y.value=l,C.value="DESC"}function K(l){let n=l.slice();return o.name&&(n=n.filter(u=>u.name.includes(o.name))),o.prop&&(n=n.filter(u=>u.prop===o.prop)),o.career&&(n=n.filter(u=>u.career===o.career)),n.sort((u,d)=>{switch(y.value){case"basic_qixue":case"basic_physical_attack":case"basic_physical_defense":case"basic_magic_attack":case"basic_magic_defense":case"basic_huixin":return C.value==="DESC"?d[y.value]-u[y.value]:C.value==="ASC"?u[y.value]-d[y.value]:d.weight-u.weight;default:return d.weight-u.weight}}),n}function G(){re()}(!f.value||f.value.length===0)&&$();const{translate:Q,xinyao:W,huazhen:X}=_e();return{filters:o,editable:b,editor:F,onEditorOpen:g,onEditorSave:k,onEditorCanel:p,sources:f,list:B,add:s,remove:T,exportData:J,importData:I,sortName:y,sortType:C,switchSort:P,loadDefault:G,toolsTranslate:Q,xinyao:W,huazhen:X}}}),i=t=>(R("data-v-5821e6e4"),t=t(),L(),t),Ye={class:"toolbar"},Ze=i(()=>e("span",{class:"title"},"\u4EBA\u7269\u5217\u8868",-1)),xe={class:"label-control-inline"},et=i(()=>e("span",null,"\u540D\u5B57",-1)),tt={class:"label-control-inline"},ot=i(()=>e("span",null,"\u5C5E\u6027",-1)),st=i(()=>e("option",{value:""},"\u5168\u90E8",-1)),nt=i(()=>e("option",{value:"\u708E"},"\u708E",-1)),lt=i(()=>e("option",{value:"\u96F7"},"\u96F7",-1)),at=i(()=>e("option",{value:"\u51B0"},"\u51B0",-1)),ut=i(()=>e("option",{value:"\u5149"},"\u5149",-1)),it=i(()=>e("option",{value:"\u6697"},"\u6697",-1)),ct=[st,nt,lt,at,ut,it],rt={class:"label-control-inline"},dt=i(()=>e("span",null,"\u804C\u4E1A",-1)),pt=i(()=>e("option",{value:""},"\u5168\u90E8",-1)),_t=i(()=>e("option",{value:"\u94C1\u536B"},"\u94C1\u536B",-1)),ht=i(()=>e("option",{value:"\u4FA0\u5BA2"},"\u4FA0\u5BA2",-1)),vt=i(()=>e("option",{value:"\u5492\u5E08"},"\u5492\u5E08",-1)),mt=i(()=>e("option",{value:"\u795D\u7531"},"\u795D\u7531",-1)),ft=i(()=>e("option",{value:"\u5FA1\u98CE"},"\u5FA1\u98CE",-1)),bt=i(()=>e("option",{value:"\u7FBD\u58EB"},"\u7FBD\u58EB",-1)),$t=[pt,_t,ht,vt,mt,ft,bt],yt={class:"c-label"},Ct=w(" \u661F\u8000 "),Et={class:"c-label"},wt=w(" \u5316\u81FB "),Bt={class:"c-upload"},Ft={class:"c-upload"},gt=i(()=>e("button",{class:"btn btn-success"},"\u5BFC\u5165",-1)),kt={class:"content"},Dt={class:"table-wrap"},St={class:"table table-bordered",style:{"min-width":"100%"}},At=i(()=>e("colgroup",null,[e("col",{width:"60"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"80"}),e("col",{width:"100"})],-1)),Nt={style:{position:"sticky",top:"100px"}},Tt=i(()=>e("th",null,"#",-1)),Ut=i(()=>e("th",null,"\u540D\u5B57",-1)),Vt=w(" \u6C14\u8840 "),It=w(" \u7269\u653B "),qt=w(" \u7269\u9632 "),Ht=w(" \u6CD5\u653B "),zt=w(" \u6CD5\u9632 "),jt=w(" \u4F1A\u5FC3 "),Ot=i(()=>e("th",null,"\u5C5E\u6027",-1)),Mt=i(()=>e("th",null,"\u804C\u4E1A",-1)),Rt=i(()=>e("th",null,"\u64CD\u4F5C",-1)),Lt={class:"cell-static text-center"},Jt={class:"cell-static text-center"},Pt={class:"cell-static text-center"},Kt={class:"cell-static text-center"},Gt={class:"cell-static text-center"},Qt={class:"cell-static text-center"},Wt={class:"cell-static text-center"},Xt={class:"cell-static text-center"},Yt={class:"cell-static text-center"},Zt={class:"cell-static text-center"},xt={class:"cell-static"},eo=["onClick"],to=["onClick"];function oo(t,o,B,b,F,N){const g=E("c-col"),k=E("c-space"),p=E("c-row"),a=E("SortIcon"),$=E("HeroModelVue");return _(),m(A,null,[e("div",ie({class:"wrapper"},t.$attrs),[e("div",Ye,[c(p,{flex:"",middle:"",style:{padding:"4px 16px"}},{default:S(()=>[c(g,{flex:"1 1 0"},{default:S(()=>[Ze,e("label",xe,[et,D(e("input",{class:"input",type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>t.filters.name=s)},null,512),[[de,t.filters.name]])]),e("label",tt,[ot,D(e("select",{class:"select","onUpdate:modelValue":o[1]||(o[1]=s=>t.filters.prop=s)},ct,512),[[U,t.filters.prop]])]),e("label",rt,[dt,D(e("select",{class:"select","onUpdate:modelValue":o[2]||(o[2]=s=>t.filters.career=s)},$t,512),[[U,t.filters.career]])])]),_:1}),c(g,{flex:"0 0 auto"},{default:S(()=>[c(k,{size:"8"},{default:S(()=>[e("label",yt,[D(e("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":o[3]||(o[3]=s=>t.xinyao=s)},null,512),[[j,t.xinyao]]),Ct]),e("label",Et,[D(e("input",{class:"c-switch",type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=s=>t.huazhen=s)},null,512),[[j,t.huazhen]]),wt])]),_:1}),e("div",Bt,[e("button",{class:"btn btn-danger",onClick:o[5]||(o[5]=(...s)=>t.loadDefault&&t.loadDefault(...s))}," \u8F7D\u5165\u9ED8\u8BA4 ")]),e("div",Ft,[gt,e("input",{type:"file",class:"c-upload-input",accept:"application/json",onInput:o[6]||(o[6]=s=>t.importData(s))},null,32)]),e("button",{class:"btn btn-success",onClick:o[7]||(o[7]=(...s)=>t.exportData&&t.exportData(...s))},"\u5BFC\u51FA"),e("button",{class:"btn btn-primary",onClick:o[8]||(o[8]=s=>t.add())},"\u6DFB\u52A0")]),_:1})]),_:1})]),e("div",kt,[e("div",Dt,[e("table",St,[At,e("thead",Nt,[e("tr",null,[Tt,Ut,e("th",null,[Vt,c(a,{type:t.sortName==="basic_qixue"?t.sortType:"",onClick:o[9]||(o[9]=s=>t.switchSort("basic_qixue"))},null,8,["type"])]),e("th",null,[It,c(a,{type:t.sortName==="basic_physical_attack"?t.sortType:"",onClick:o[10]||(o[10]=s=>t.switchSort("basic_physical_attack"))},null,8,["type"])]),e("th",null,[qt,c(a,{type:t.sortName==="basic_physical_defense"?t.sortType:"",onClick:o[11]||(o[11]=s=>t.switchSort("basic_physical_defense"))},null,8,["type"])]),e("th",null,[Ht,c(a,{type:t.sortName==="basic_magic_attack"?t.sortType:"",onClick:o[12]||(o[12]=s=>t.switchSort("basic_magic_attack"))},null,8,["type"])]),e("th",null,[zt,c(a,{type:t.sortName==="basic_magic_defense"?t.sortType:"",onClick:o[13]||(o[13]=s=>t.switchSort("basic_magic_defense"))},null,8,["type"])]),e("th",null,[jt,c(a,{type:t.sortName==="basic_huixin"?t.sortType:"",onClick:o[14]||(o[14]=s=>t.switchSort("basic_huixin"))},null,8,["type"])]),Ot,Mt,Rt])]),e("tbody",null,[(_(!0),m(A,null,V(t.list,(s,T)=>(_(),m("tr",{key:s.id,class:"c-user-row"},[e("td",Lt,v(T+1),1),e("td",Jt,v(s.name),1),(_(!0),m(A,null,V([t.toolsTranslate(s)],(h,I)=>(_(),m(A,{key:I},[e("td",Pt,v(h.qixue),1),e("td",Kt,v(h.patt),1),e("td",Gt,v(h.pdef),1),e("td",Qt,v(h.matt),1),e("td",Wt,v(h.mdef),1),e("td",Xt,v(h.huixin),1)],64))),128)),e("td",Yt,v(s.prop),1),e("td",Zt,v(s.career),1),e("td",xt,[c(k,null,{default:S(()=>[e("button",{class:"btn btn-sm btn-primary-outline",onClick:h=>t.onEditorOpen(s.id)}," \u7F16\u8F91 ",8,eo),e("button",{class:"btn btn-sm btn-danger-outline",onClick:h=>t.remove(s)}," \u5220\u9664 ",8,to)]),_:2},1024)])]))),128))])])])])],16),c($,{record:t.editor,"onUpdate:record":o[15]||(o[15]=s=>t.editor=s),width:"800",height:"600",onSave:t.onEditorSave},null,8,["record","onSave"])],64)}var ao=z(Xe,[["render",oo],["__scopeId","data-v-5821e6e4"]]);export{ao as default};
