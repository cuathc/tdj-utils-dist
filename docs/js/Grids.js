import{d as dt,h as J,a as It,i as tt,O as $t,Z as Gt,$ as At,_ as yt,o as B,c as $,b as s,n as U,j as ct,p as D,W as it,w as X,G as M,T as se,y as Rt,z as Lt,g as Et,D as pt,m as Z,f as et,r as ne,a0 as Bt,v as lt,l as R,k as P,e as x,F as at,s as rt,x as le,V as ae}from"./index.js";import{_ as Q}from"./lodash.js";import{u as re,D as ce}from"./useHeroes.js";const Dt=(o,a,f)=>{let v=0,r=0,i=0;o%=360;const n=Math.floor(o/60),_=o/60-n,g=f*(1-a),S=f*(1-a*_),I=f*(1-a*(1-_));switch(n){case 0:v=f,r=I,i=g;break;case 1:v=S,r=f,i=g;break;case 2:v=g,r=f,i=I;break;case 3:v=g,r=S,i=f;break;case 4:v=I,r=g,i=f;break;case 5:v=f,r=g,i=S;break}v=Math.floor(v*255),r=Math.floor(r*255),i=Math.floor(i*255);const F=("00"+v.toString(16)).slice(-2),G=("00"+r.toString(16)).slice(-2),d=("00"+i.toString(16)).slice(-2);return[o,a,f,v,r,i,"#"+F+G+d]},St=o=>{let a=0,f=0,v=0,r=0,i=0,n=0;if(/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i.test(o))a=window.parseInt(RegExp.$1,16),f=window.parseInt(RegExp.$2,16),v=window.parseInt(RegExp.$3,16);else if(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i.test(o))a=window.parseInt(RegExp.$1,10),f=window.parseInt(RegExp.$2,10),v=window.parseInt(RegExp.$3,10);else return[0,0,0,0,0,0,"#000000"];r=a/255,i=f/255,n=v/255;let _=r;i>_&&(_=i),n>_&&(_=n);let g=r;i<g&&(g=i),n<g&&(g=n);let S=0,I=0,F=0;_===g?S=0:_===r&&i>=n?S=60*(i-n)/(_-g)+0:_===r&&i<n?S=60*(i-n)/(_-g)+360:_===i?S=60*(n-r)/(_-g)+120:_===n&&(S=60*(r-i)/(_-g)+240),_===0?I=0:I=1-g/_,F=_;const G=("00"+a.toString(16)).slice(-2),d=("00"+f.toString(16)).slice(-2),A=("00"+v.toString(16)).slice(-2);return[Math.floor(S),I,F,a,f,v,"#"+G+d+A]},ie=dt({name:"ColorPicker",emits:["update:modelValue"],props:{modelValue:{type:String,required:!0}},setup(o,{emit:a}){const f=J(!1),v=It({set:p=>{a("update:modelValue",p)},get:()=>o.modelValue}),r=tt({h:0,s:0,v:0,r:0,g:0,b:0}),i=tt({rect_down:!1,rect_left:0,rect_bottom:0,ver_down:!1,ver_bottom:0}),n={rect:{left:0,bottom:0,x:0,y:0},ver:{bottom:0,y:0}},_=J(!1),g=()=>{_.value=!0},S=Q.debounce(()=>{_.value=!1},300),I=()=>{g();const p=Dt(r.h,r.s,r.v);r.r=p[3],r.g=p[4],r.b=p[5],v.value=p[6],i.ver_bottom=r.h,i.rect_left=r.s*360,i.rect_bottom=r.v*360,S()},F=()=>{g();const p=St(`${r.r},${r.g},${r.b}`);r.h=p[0],r.s=p[1],r.v=p[2],v.value=p[6],i.ver_bottom=r.h,i.rect_left=r.s*360,i.rect_bottom=r.v*360,S()},G=p=>{p=p||"#000000";const V=St(p);r.h=V[0],r.s=V[1],r.v=V[2],r.r=V[3],r.g=V[4],r.b=V[5],i.ver_bottom=r.h,i.rect_left=r.s*360,i.rect_bottom=r.v*360},d=()=>{const p=Dt(i.ver_bottom,i.rect_left/360,i.rect_bottom/360);r.h=p[0],r.s=p[1],r.v=p[2],r.r=p[3],r.g=p[4],r.b=p[5],v.value=p[6]},A=p=>{i.rect_down=!0,n.rect.x=p.clientX,n.rect.y=p.clientY;const V=p.currentTarget,K=V.getBoundingClientRect().left,ut=V.getBoundingClientRect().top;n.rect.left=i.rect_left=p.clientX-K,n.rect.bottom=i.rect_bottom=360-(p.clientY-ut),d()},L=p=>{if(!i.rect_down)return;const V=p.clientX-n.rect.x,K=p.clientY-n.rect.y;i.rect_left=Math.max(0,Math.min(360,n.rect.left+V)),i.rect_bottom=Math.max(0,Math.min(360,n.rect.bottom-K)),d()},T=()=>{!i.rect_down||(i.rect_down=!1)},j=p=>{i.ver_down=!0,n.ver.y=p.clientY;const K=p.currentTarget.getBoundingClientRect().top;n.ver.bottom=i.ver_bottom=360-(p.clientY-K),d()},O=p=>{if(!i.ver_down)return;const V=p.clientY-n.ver.y;i.ver_bottom=Math.max(0,Math.min(360,n.ver.bottom-V)),d()},ot=()=>{!i.ver_down||(i.ver_down=!1)},W=()=>{f.value=!0},st=()=>{f.value=!1};return $t(()=>o.modelValue,p=>{i.ver_down||i.rect_down||_.value||G(p)}),G(o.modelValue),Gt(()=>{window.addEventListener("mousemove",L,!1),window.addEventListener("mouseup",T,!1),window.addEventListener("mousemove",O,!1),window.addEventListener("mouseup",ot,!1)}),At(()=>{window.removeEventListener("mousemove",L,!1),window.removeEventListener("mouseup",T,!1),window.removeEventListener("mousemove",O,!1),window.removeEventListener("mouseup",ot,!1)}),{show:f,color:v,vars:r,state:i,colorRectPointerStart:A,colorVerPointerStart:j,updateHSV:I,updateRGB:F,updateHex:G,onOpen:W,onComfirm:st}}});const ft=o=>(Rt("data-v-27cd0415"),o=o(),Lt(),o),ue={class:"color-control"},de={class:"color-picker-layer"},ye={class:"color-picker-view"},pe=ft(()=>s("div",{class:"color-picker-view__label"},"HSV",-1)),fe=ft(()=>s("div",{class:"color-picker-view__label"},"RGB",-1)),ve=ft(()=>s("div",{class:"color-picker-view__label"},"Hex",-1));function me(o,a,f,v,r,i){return B(),$("div",ue,[s("div",{class:"color-preview",style:U({backgroundColor:o.color}),onClick:a[0]||(a[0]=(...n)=>o.onOpen&&o.onOpen(...n))},null,4),(B(),ct(se,{to:"body"},[D(s("div",{class:"color-picker-mask",onWheel:a[1]||(a[1]=X(()=>{},["prevent"])),onTouchstart:a[2]||(a[2]=X(()=>{},["prevent"])),onClick:a[3]||(a[3]=(...n)=>o.onComfirm&&o.onComfirm(...n))},null,544),[[it,o.show]]),D(s("div",de,[s("div",{class:"color-picker-rect",style:U(`background-color: hsl(${o.vars.h}deg, 100%, 50%)`),onMousedown:a[4]||(a[4]=X((...n)=>o.colorRectPointerStart&&o.colorRectPointerStart(...n),["prevent","stop"]))},[s("div",{class:"color-picker-rect-cur",style:U({left:`${o.state.rect_left}px`,bottom:`${o.state.rect_bottom}px`})},null,4)],36),s("div",{class:"color-picker-hue",onMousedown:a[5]||(a[5]=X((...n)=>o.colorVerPointerStart&&o.colorVerPointerStart(...n),["prevent","stop"]))},[s("div",{class:"color-picker-hue-cur",style:U({bottom:`${o.state.ver_bottom}px`})},null,4)],32),s("div",ye,[s("div",{class:"color-picker-view-color",style:U({background:o.color})},null,4),pe,D(s("input",{type:"number",max:"360",min:"0",step:"1","onUpdate:modelValue":a[6]||(a[6]=n=>o.vars.h=n),class:"color-picker-view__input",onInput:a[7]||(a[7]=(...n)=>o.updateHSV&&o.updateHSV(...n))},null,544),[[M,o.vars.h]]),D(s("input",{type:"number",max:"1",min:"0",step:"0.01","onUpdate:modelValue":a[8]||(a[8]=n=>o.vars.s=n),class:"color-picker-view__input",onInput:a[9]||(a[9]=(...n)=>o.updateHSV&&o.updateHSV(...n))},null,544),[[M,o.vars.s]]),D(s("input",{type:"number",max:"1",min:"0",step:"0.01","onUpdate:modelValue":a[10]||(a[10]=n=>o.vars.v=n),class:"color-picker-view__input",onInput:a[11]||(a[11]=(...n)=>o.updateHSV&&o.updateHSV(...n))},null,544),[[M,o.vars.v]]),fe,D(s("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":a[12]||(a[12]=n=>o.vars.r=n),class:"color-picker-view__input",onInput:a[13]||(a[13]=(...n)=>o.updateRGB&&o.updateRGB(...n))},null,544),[[M,o.vars.r]]),D(s("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":a[14]||(a[14]=n=>o.vars.g=n),class:"color-picker-view__input",onInput:a[15]||(a[15]=(...n)=>o.updateRGB&&o.updateRGB(...n))},null,544),[[M,o.vars.g]]),D(s("input",{type:"number",max:"255",min:"0",step:"1","onUpdate:modelValue":a[16]||(a[16]=n=>o.vars.b=n),class:"color-picker-view__input",onInput:a[17]||(a[17]=(...n)=>o.updateRGB&&o.updateRGB(...n))},null,544),[[M,o.vars.b]]),ve,D(s("input",{type:"text","onUpdate:modelValue":a[18]||(a[18]=n=>o.color=n),class:"color-picker-view__input"},null,512),[[M,o.color]]),s("div",{class:"color-picker-view__enter",onClick:a[19]||(a[19]=(...n)=>o.onComfirm&&o.onComfirm(...n))},"\u786E\u8BA4")])],512),[[it,o.show]])]))])}const q=yt(ie,[["render",me],["__scopeId","data-v-27cd0415"]]);q.install=function(o){o.component(q.name,q)};const be={draggable:!0,class:"grid-item"},xe={key:0,class:"tg lt"},ge={key:1,class:"tg rt"},_e={key:2,class:"tg rb"},he={class:"overlay-dot"},we={class:"overlay-selected"},ke=dt({__name:"GridItem",props:{disabled:{type:Boolean},selected:{type:Boolean},dot:{type:Boolean},item:null},setup(o){return(a,f)=>(B(),$("div",be,[o.item?(B(),$("div",{key:0,class:Et(["color-unit",{disabled:o.disabled}]),style:U({fontSize:`${o.item.data.size}px`,color:o.item.style.color,backgroundColor:o.item.style.bgcolor,backgroundImage:o.item.style.image?`url(${o.item.style.image})`:"",opacity:o.item.style.opacity})},[pt(Z(o.item.data.txt)+" ",1),o.item.data.actorId?(B(),$("i",xe,Z(o.item.data.actorId),1)):et("",!0),o.item.data.sup?(B(),$("i",ge,Z(o.item.data.sup),1)):et("",!0),o.item.data.sub?(B(),$("i",_e,Z(o.item.data.sub),1)):et("",!0)],6)):(B(),$("div",{key:1,class:Et(["color-unit",{disabled:o.disabled}])},[ne(a.$slots,"default",{},void 0,!0)],2)),D(s("div",he,null,512),[[it,o.dot]]),D(s("div",we,null,512),[[it,o.selected]])]))}});const N=yt(ke,[["__scopeId","data-v-6c3c6c6f"]]);var b=(o=>(o[o.NONE=0]="NONE",o[o.GUARD=1]="GUARD",o[o.SHEEP=2]="SHEEP",o[o.ATTACKER=3]="ATTACKER",o[o.FLY=4]="FLY",o[o.BLOCKED=5]="BLOCKED",o[o.CLIFF=6]="CLIFF",o))(b||{});function Ce(){const o=J(0),a=J([]),f=J([]),v=[{color:"#202020",bgcolor:"#f5fff0"},{color:"#f9f9fa",bgcolor:"#ff3333"},{color:"#f9f9fa",bgcolor:"#00d659"},{color:"#f9f9fa",bgcolor:"#369af7"},{color:"#f9f9fa",bgcolor:"#fec02f"},{color:"#f9f9fa",bgcolor:"#a865e7"}],r=()=>({actorId:0,actorType:b.NONE,size:14,txt:"",disabled:!1}),i=()=>({color:v[0].color,bgcolor:v[0].bgcolor,image:"",opacity:1}),n=()=>({d:0,d1:0,d2:0,q:0}),_=()=>({x:0,y:0,data:r(),style:i(),state:n()});function g(F){F.data=r(),F.style=i(),F.state=n()}function S(){o.value=0,a.value.forEach(F=>{g(F)}),f.value=[]}function I(F,G){const d=[];for(let A=0;A<F;A++)for(let L=0;L<G;L++){const T=_();T.x=L,T.y=F-A-1,d.push(T)}a.value=d}return{actorId:o,grids:a,selects:f,gridColors:v,defGridData:r,defGridStyle:i,defGridState:n,defGrid:_,cleanGrid:g,cleanGrids:S,generateGrids:I}}const Ft=""+new URL("../assets/cliff.svg",import.meta.url).href,Vt=""+new URL("../assets/block.svg",import.meta.url).href,Ee=[{name:"\u4E00\u7EBF\u5929",data:[{x:6,y:10,type:6},{x:7,y:10,type:6},{x:8,y:10,type:6},{x:5,y:9,type:6},{x:6,y:9,type:6},{x:7,y:9,type:6},{x:8,y:9,type:6},{x:9,y:9,type:6},{x:4,y:8,type:6},{x:5,y:8,type:6},{x:9,y:8,type:6},{x:10,y:8,type:6},{x:4,y:6,type:6},{x:5,y:6,type:6},{x:9,y:6,type:6},{x:10,y:6,type:6},{x:5,y:5,type:6},{x:6,y:5,type:6},{x:7,y:5,type:6},{x:8,y:5,type:6},{x:9,y:5,type:6},{x:6,y:4,type:6},{x:7,y:4,type:6},{x:8,y:4,type:6}]},{name:"\u51B0\u5929\u5E7B\u5883",data:[{x:6,y:8,type:6},{x:7,y:8,type:6},{x:8,y:8,type:6},{x:4,y:7,type:6},{x:10,y:7,type:6},{x:6,y:6,type:6},{x:7,y:6,type:6},{x:8,y:6,type:6}]},{name:"\u4E24\u6CB3\u5E7B\u5883",data:[{x:4,y:12,type:6},{x:5,y:12,type:6},{x:9,y:12,type:6},{x:10,y:12,type:6},{x:4,y:11,type:6},{x:5,y:11,type:6},{x:9,y:11,type:6},{x:10,y:11,type:6},{x:5,y:10,type:6},{x:6,y:10,type:6},{x:7,y:10,type:6},{x:8,y:10,type:6},{x:9,y:10,type:6},{x:6,y:9,type:6},{x:7,y:9,type:6},{x:8,y:9,type:6},{x:6,y:5,type:6},{x:7,y:5,type:6},{x:8,y:5,type:6},{x:5,y:4,type:6},{x:6,y:4,type:6},{x:7,y:4,type:6},{x:8,y:4,type:6},{x:9,y:4,type:6},{x:4,y:3,type:6},{x:5,y:3,type:6},{x:9,y:3,type:6},{x:10,y:3,type:6},{x:4,y:2,type:6},{x:5,y:2,type:6},{x:9,y:2,type:6},{x:10,y:2,type:6}]},{name:"\u77F3\u5934\u5E7B\u5883",data:[{x:7,y:10,type:5},{x:4,y:7,type:5},{x:7,y:7,type:5},{x:10,y:7,type:5},{x:7,y:4,type:5}]},{name:"\u57CE\u9685\u5E7B\u5883",data:[{x:5,y:12,type:5},{x:6,y:12,type:5},{x:7,y:12,type:5},{x:8,y:12,type:5},{x:9,y:12,type:5},{x:6,y:11,type:5},{x:8,y:11,type:5},{x:10,y:8,type:5},{x:5,y:7,type:5},{x:9,y:7,type:5},{x:4,y:6,type:5},{x:6,y:3,type:5},{x:8,y:3,type:5},{x:5,y:2,type:5},{x:6,y:2,type:5},{x:7,y:2,type:5},{x:8,y:2,type:5},{x:9,y:2,type:5}]}],h=o=>(Rt("data-v-7e715a55"),o=o(),Lt(),o),Be={class:"wrapper"},De={class:"toolbar"},Se={class:"setting"},Fe={class:"label-control"},Ve=h(()=>s("span",null,"\u7F16\u8F91\u6A21\u5F0F\xA0",-1)),Ie=h(()=>s("option",{value:1},"\u7F16\u8F91\u7F51\u683C",-1)),$e=h(()=>s("option",{value:2},"\u7F51\u683C\u4E0A\u8272",-1)),Ge=h(()=>s("option",{value:3},"\u9009\u62E9\u5F62\u72B6",-1)),Ae=h(()=>s("option",{value:4},"\u62A4\u536B\u8BA1\u7B97",-1)),Re=[Ie,$e,Ge,Ae],Le={class:"label-control"},Me=h(()=>s("span",null,"\u8303\u56F4\xA0",-1)),Ue={class:"label-control"},He=h(()=>s("span",null,"\u5F62\u72B6\xA0",-1)),Te=h(()=>s("option",{value:1},"\u83F1\u5F62",-1)),Ne=h(()=>s("option",{value:2},"\u5708\u6570",-1)),Ke=[Te,Ne],qe={class:"label-control"},Oe=h(()=>s("span",null,"\u6392\u5E8F\xA0",-1)),ze=h(()=>s("option",{value:1},"\u8DDD\u79BBX",-1)),Pe=h(()=>s("option",{value:2},"\u8DDD\u79BBY",-1)),Xe=h(()=>s("option",{value:3},"X\u4F18\u5148",-1)),Je=h(()=>s("option",{value:4},"Y\u4F18\u5148",-1)),je=[ze,Pe,Xe,Je],We=h(()=>s("button",{class:"btn"},"\u9884\u8BBE\u573A\u666F",-1)),Ye=["onClick"],Ze=["onClick"],Qe={class:"color-container"},to={class:"label-control"},eo=h(()=>s("span",null,"\u9884\u89C8\xA0",-1)),oo=pt(" E "),so={class:"label-control"},no=h(()=>s("span",null,"\u6587\u5B57\xA0",-1)),lo={class:"label-control"},ao=h(()=>s("span",null,"\u80CC\u666F\xA0",-1)),ro=h(()=>s("label",{class:"label-control"},[s("span",null,"\u9884\u8BBE\xA0")],-1)),co={class:"color-tpls"},io=pt(" E "),uo={width:"32",height:"32",viewBox:"0 0 24 24",fill:"#a9a9a9",style:{"pointer-events":"none"}},yo=h(()=>s("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"},null,-1)),po=[yo],fo={class:"props-container"},vo={key:0,class:"props-content"},mo={class:"label-control"},bo=h(()=>s("span",null,"\u9884\u89C8\xA0",-1)),xo={class:"label-control"},go=h(()=>s("span",null,"\u6587\u5B57\xA0",-1)),_o={class:"label-control"},ho=h(()=>s("span",null,"\u80CC\u666F\xA0",-1)),wo={class:"label-control"},ko=h(()=>s("span",null,"\u5927\u5C0F\xA0",-1)),Co={class:"label-control"},Eo=h(()=>s("span",null,"Id\xA0",-1)),Bo={class:"label-control"},Do=h(()=>s("span",null,"\u7C7B\u578B\xA0",-1)),So=["value"],Fo=["value"],Vo=["value"],Io=["value"],$o=["value"],Go=["value"],Ao=["value"],Ro={class:"label-control"},Lo=h(()=>s("span",null,"\u5185\u5BB9\xA0",-1)),Mo={class:"content"},Uo={class:"heroes"},Ho=dt({__name:"Grids",setup(o){const{actorId:a,grids:f,selects:v,gridColors:r,defGridData:i,defGridStyle:n,defGridState:_,defGrid:g,cleanGrid:S,cleanGrids:I,generateGrids:F}=Ce(),G=J(),d=tt({editor:1,selectRange:5,shape:1,sortType:1,color:r[0].color,bgcolor:r[0].bgcolor}),A=g();A.style.image=Vt,A.data.actorType=b.BLOCKED;const L=g();L.style.image=Ft,L.data.actorType=b.CLIFF;function T(e){d.color=e.color,d.bgcolor=e.bgcolor}const j=15,O=15,ot=It(()=>`--rows:${O};--cols:${j}`),{heroes:W}=re(),st=Bt(g()),p=Bt(W.value.map(e=>{const t=g();return t.style.image=`https://media.zlongame.com/media/news/cn/tdj/info/data/heroicon/${e.hero_icon}.png`,t}));$t(W,()=>{p.value=W.value.map(e=>{const t=g();return t.style.image=`https://media.zlongame.com/media/news/cn/tdj/info/data/heroicon/${e.hero_icon}.png`,t})});function V(e,t,y,m){const l=[];return f.value.forEach(u=>{u.state=_()}),f.value.forEach(u=>{const c=Math.abs(e-u.x),E=Math.abs(t-u.y),C=c+E,H=Math.max(c,E),Ct=c>1?c-1:c+E>1?E-1:E;switch(m){case 1:C<=y&&(u.state.d=C,u.state.q=H,u.state.d1=Ct,l.push(u));break;case 2:Math.abs(c)<=y&&Math.abs(E)<=y&&(u.state.d=C,u.state.q=H,u.state.d1=Ct,l.push(u));break}}),l}function K(e,t,y,m,l,u,c){const E=V(e,t,y,m);switch(E.forEach(C=>{C.style.color=u,C.style.bgcolor=c}),v.value=E,l){case 1:m===1?v.value.sort(ut):m===2&&v.value.sort(Ut);break;case 2:m===1?v.value.sort(Mt):m===2&&v.value.sort(vt);break;case 3:v.value.sort(Ht);break;case 4:v.value.sort(Tt);break}for(let C=0;C<v.value.length;C++)v.value[C].data.txt=String(C+1)}function ut(e,t){return e.state.d!==t.state.d?e.state.d-t.state.d:e.x!==t.x?e.x-t.x:e.y!==t.y?e.y-t.y:0}function Mt(e,t){return e.state.d!==t.state.d?e.state.d-t.state.d:e.y!==t.y?e.y-t.y:e.x!==t.x?e.x-t.x:0}function Ut(e,t){return e.state.q!==t.state.q?e.state.q-t.state.q:e.state.d!==t.state.d?e.state.d-t.state.d:e.x!==t.x?e.x-t.x:e.y!==t.y?e.y-t.y:0}function vt(e,t){return e.state.q!==t.state.q?e.state.q-t.state.q:e.state.d!==t.state.d?e.state.d-t.state.d:e.y!==t.y?e.y-t.y:e.x!==t.x?e.x-t.x:0}function Ht(e,t){return e.x!==t.x?e.x-t.x:e.y!==t.y?e.y-t.y:0}function Tt(e,t){return e.y!==t.y?e.y-t.y:e.x!==t.x?e.x-t.x:0}const w=tt({enabled:!1});function mt(){I()}function bt(){w.enabled=!1}function Nt(e,t){var y;switch(d.editor){case 1:case 4:w.current=t,(y=G.value)==null||y.focus();break;case 3:I(),K(t.x,t.y,d.selectRange,d.shape,d.sortType,d.color,d.bgcolor);break}}function Kt(e,t){if(e.button===0)switch(d.editor){case 2:{w.enabled=!0,t.style.color=d.color,t.style.bgcolor=d.bgcolor;break}}}function qt(e,t){e.button===0&&w.enabled&&(t.style.color=d.color,t.style.bgcolor=d.bgcolor)}function Ot(){w.current=void 0}const z={};function zt(){try{const e=localStorage.getItem("grids");e&&(z.value=JSON.parse(e))}catch{}}function xt(){z.value=f.value.map(e=>Q.cloneDeep(e)),localStorage.setItem("grids",JSON.stringify(z.value))}function Pt(){!z.value||(f.value=Q.cloneDeep(z.value))}function Xt(e){mt(),e.data.forEach(t=>{const y=f.value[nt(t.x,t.y)];if(!!y)switch(t.type){case b.CLIFF:y.style.image=Ft,y.data.actorType=b.CLIFF;break;case b.BLOCKED:y.style.image=Vt,y.data.actorType=b.BLOCKED;break}})}function Jt(){const e=w.current;if(!e)return;z.value||xt();let t,y,m=[];for(t=e.x-2;t<=e.x+2;t++)for(y=e.y-2;y<=e.y+2;y++){const c=f.value[nt(t,y)];if(c.x===e.x&&c.y===e.y){const E=m[0];E&&(m.push(E),m[0]=c)}else m.push(c)}m=m.filter(c=>c.data.actorId>0&&c.data.actorType!==b.BLOCKED&&c.data.actorType!==b.CLIFF&&!(c.x===e.x&&c.y===e.y));const l=m.map(c=>({data:c.data,style:c.style}));m.forEach(c=>{S(c)}),console.log(JSON.parse(JSON.stringify(l)));const u=V(e.x,e.y,4,2).filter(c=>c.data.actorType!==b.BLOCKED&&!(c.x===e.x&&c.y===e.y)).sort(vt).map(c=>[c.x,c.y]);for(const c of l)for(const[E,C]of u){const H=f.value[nt(E,C)];if(!!H&&!(H.data.actorId>0)&&H.data.actorType!==b.BLOCKED&&!(H.data.actorType===b.CLIFF&&c.data.actorType!==b.FLY)){H.data=c.data,H.style=c.style;break}}}const k=tt({}),gt=["#ffffff00","#FF3C4132","#0EBEFF32","#48CF7432","#FCD00032","#80008032"],jt=(e,t)=>{switch(d.editor){case 2:e.preventDefault();break;default:k.grid=t,k.action="swap",e.dataTransfer&&(e.dataTransfer.effectAllowed="move")}},Wt=(e,t)=>{const y=g();y.style.color=t.color,y.style.bgcolor=t.bgcolor,y.data.txt="E",k.grid=y,k.action="color"},_t=(e,t)=>{k.grid=Q.cloneDeep(t),k.action="other"},ht=(e,t)=>{k.grid=Q.cloneDeep(t),k.action="image"},Yt=(e,t)=>{if(e.preventDefault(),!k.grid)return;const y=k.grid.data,m=k.grid.style;switch(k.action){case"color":t.data.actorId||(t.data.actorId=++a.value),t.style.color=m.color,t.style.bgcolor=m.bgcolor;break;case"image":t.data.actorId||(t.data.actorId=++a.value),t.style.image=m.image;break;case"swap":k.grid.data=t.data,k.grid.style=t.style,t.data=y,t.style=m;break;case"other":t.style=m,t.data=y;break}k.grid=void 0,k.action=void 0,d.editor===4&&Y()};function Zt(e,t){let y=e[0].state[t];for(let m=1;m<e.length;m++)e[m].state[t]<y&&(y=e[m].state[t]);return y}function wt(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function kt(e,t,y){e.sort((c,E)=>+c.data.actorId-+E.data.actorId),e.forEach(c=>{c.state.d1=wt(c,y),c.state.d2=wt(c,t),c.data.guard=!1});const m=Zt(e,"d1");if(e=e.filter(c=>c.state.d1===m),e.length===1)return e[0];let l=e[0],u=e.length;for(;u--;)if(e[u].state.d2<l.state.d2){l=e[u];break}return l}function nt(e,t){return(O-t-1)*j+e}function Qt(){I(),a.value=0;const e=[{x:7,y:9,txt:"",type:b.GUARD,bg:"#0ebeff"},{x:9,y:7,txt:"",type:b.GUARD,bg:"#0ebeff"},{x:7,y:5,txt:"",type:b.GUARD,bg:"#0ebeff"},{x:5,y:7,txt:"",type:b.GUARD,bg:"#0ebeff"},{x:8,y:6,txt:"",type:b.ATTACKER,bg:"#ff3c41"},{x:7,y:7,txt:"",type:b.SHEEP,bg:"#fcd000"}];for(const t of e){const y=f.value[nt(t.x,t.y)];y.data.actorId=++a.value,y.data.actorType=t.type,y.data.txt=t.txt,y.data.disabled=!1,y.style.bgcolor=t.bg}d.editor=4}const Y=()=>{f.value.forEach(u=>u.style.opacity=1);const e=f.value.filter(u=>!u.data.disabled),t=e.filter(u=>u.data.actorType===b.ATTACKER)[0],y=e.filter(u=>u.data.actorType===b.SHEEP)[0],m=e.filter(u=>u.data.actorType===b.GUARD);if(!y||m.length===0){alert("\u7F3A\u5C11\u89D2\u8272\uFF0C\u5C06\u81EA\u52A8\u751F\u6210"),Qt(),Y();return}const l=f.value.filter(u=>!u.data.disabled).filter(u=>u.data.actorType===b.NONE);for(const u of l){const c=kt(m,u,y);u.style.image=c.style.image,u.style.bgcolor=gt[c.data.actorId]||gt[0],c.style.image?u.data.sup="":u.data.sup=String(c.data.actorId),u.style.opacity=.6}if(t){const u=kt(m,t,y);u.data.guard=!0}},te=e=>{if(e.data.disabled=!e.data.disabled,d.editor===4){switch(e.data.actorType){case b.ATTACKER:case b.SHEEP:e.data.disabled=!1;break}Y()}},ee=e=>{!k.grid||!e.dataTransfer||k.action==="swap"&&(d.editor===4&&k.grid.data.actorType===b.SHEEP||e.preventDefault())},oe=e=>{if(!!k.grid&&!!e)switch(k.action){case"swap":e.data=i(),e.style=n(),e.state=_(),k.grid=void 0,k.action=void 0,d.editor===4&&Y()}};return F(O,j),Gt(()=>{zt(),window.addEventListener("mouseup",bt,!1)}),At(()=>{window.removeEventListener("mouseup",bt,!1)}),(e,t)=>{const y=le("c-space"),m=ae("autofocus");return B(),$("div",Be,[s("div",De,[s("div",Se,[s("label",Fe,[Ve,D(s("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>d.editor=l)},Re,512),[[lt,d.editor,void 0,{number:!0}]])]),s("label",Le,[Me,D(s("input",{type:"number",min:"0","onUpdate:modelValue":t[1]||(t[1]=l=>d.selectRange=l),style:{width:"5em"}},null,512),[[M,d.selectRange]])]),s("label",Ue,[He,D(s("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>d.shape=l)},Ke,512),[[lt,d.shape]])]),s("label",qe,[Oe,D(s("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>d.sortType=l)},je,512),[[lt,d.sortType]])]),s("button",{class:"btn",onClick:mt},"\u6E05\u7A7A"),s("button",{class:"btn",onClick:Y},"\u8BA1\u7B97\u62A4\u536B"),s("button",{class:"btn btn-success",onClick:xt},"\u4FDD\u5B58\u5E03\u5C40"),s("button",{class:"btn btn-success",onClick:Pt},"\u8FD8\u539F\u5E03\u5C40"),et("",!0),R(x(ce),null,{popover:P(({onClose:l})=>[s("div",{class:"list",onClick:u=>l()},[(B(!0),$(at,null,rt(x(Ee),(u,c)=>(B(),$("div",{class:"list-item",key:c,onClick:E=>Xt(u)},Z(u.name),9,Ze))),128))],8,Ye)]),default:P(()=>[We]),_:1})]),s("div",Qe,[R(y,null,{default:P(()=>[s("label",to,[eo,R(x(N),{draggable:!1,style:U([`--color:${d.color};--bgcolor:${d.bgcolor}`])},{default:P(()=>[oo]),_:1},8,["style"])]),s("label",so,[no,R(x(q),{modelValue:d.color,"onUpdate:modelValue":t[4]||(t[4]=l=>d.color=l)},null,8,["modelValue"])]),s("label",lo,[ao,R(x(q),{modelValue:d.bgcolor,"onUpdate:modelValue":t[5]||(t[5]=l=>d.bgcolor=l)},null,8,["modelValue"])]),ro,s("div",co,[(B(!0),$(at,null,rt(x(r),(l,u)=>(B(),ct(x(N),{key:u,selected:d.bgcolor===l.bgcolor,style:U([`--color:${l.color};--bgcolor:${l.bgcolor}`]),onClick:c=>T(l),onDragstart:c=>Wt(c,l)},{default:P(()=>[io]),_:2},1032,["selected","style","onClick","onDragstart"]))),128)),R(x(N),{item:x(L),onDragstart:t[6]||(t[6]=l=>_t(l,x(L)))},null,8,["item"]),R(x(N),{item:x(A),onDragstart:t[7]||(t[7]=l=>_t(l,x(A)))},null,8,["item"])]),s("div",{class:"trush",onDragover:ee,onDrop:t[8]||(t[8]=l=>oe(k.grid))},[(B(),$("svg",uo,po))],32)]),_:1})]),s("div",fo,[w.current?(B(),$("div",vo,[R(y,null,{default:P(()=>[s("label",mo,[bo,R(x(N),{draggable:!1,style:U([`--color:${w.current.style.color};--bgcolor:${w.current.style.bgcolor}`]),item:w.current},null,8,["style","item"])]),s("label",xo,[go,R(x(q),{modelValue:w.current.style.color,"onUpdate:modelValue":t[9]||(t[9]=l=>w.current.style.color=l)},null,8,["modelValue"])]),s("label",_o,[ho,R(x(q),{modelValue:w.current.style.bgcolor,"onUpdate:modelValue":t[10]||(t[10]=l=>w.current.style.bgcolor=l)},null,8,["modelValue"])]),s("label",wo,[ko,D(s("input",{type:"number",style:{width:"4em"},min:"12",step:"1","onUpdate:modelValue":t[11]||(t[11]=l=>w.current.data.size=l)},null,512),[[M,w.current.data.size]])]),s("label",Co,[Eo,D(s("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=l=>w.current.data.actorId=l),style:{width:"4em"}},null,512),[[M,w.current.data.actorId]])]),s("label",Bo,[Do,D(s("select",{"onUpdate:modelValue":t[13]||(t[13]=l=>w.current.data.actorType=l)},[s("option",{value:x(b).NONE},"\u65E0",8,So),s("option",{value:x(b).GUARD},"\u62A4\u536B",8,Fo),s("option",{value:x(b).SHEEP},"\u9776\u5B50",8,Vo),s("option",{value:x(b).ATTACKER},"\u653B\u51FB\u8005",8,Io),s("option",{value:x(b).FLY},"\u98DE\u884C",8,$o),s("option",{value:x(b).BLOCKED},"\u969C\u788D",8,Go),s("option",{value:x(b).CLIFF},"\u60AC\u5D16",8,Ao)],512),[[lt,w.current.data.actorType]])]),s("label",Ro,[Lo,D(s("input",{type:"text",ref_key:"txtInput",ref:G,"onUpdate:modelValue":t[14]||(t[14]=l=>w.current.data.txt=l)},null,512),[[m],[M,w.current.data.txt]])]),s("button",{class:"btn",onClick:Ot},"\u5B8C\u6210"),s("button",{class:"btn btn-success",onClick:Jt},"\u602A\u529B\u4E71\u795E")]),_:1})])):et("",!0)])]),s("div",Mo,[s("div",{class:"grids",style:U(x(ot))},[(B(!0),$(at,null,rt(x(f),(l,u)=>{var c,E;return B(),ct(x(N),{key:u,draggable:!0,selected:l.x===((c=w.current)==null?void 0:c.x)&&l.y===((E=w.current)==null?void 0:E.y),disabled:l.data.disabled,dot:l.data.guard,item:l,onDragstart:C=>jt(C,l),onDragover:t[15]||(t[15]=X(()=>{},["prevent"])),onDrop:C=>Yt(C,l),onContextmenu:X(C=>te(l),["prevent"]),onClick:C=>Nt(C,l),onMousedown:C=>Kt(C,l),onMouseenter:C=>qt(C,l)},null,8,["selected","disabled","dot","item","onDragstart","onDrop","onContextmenu","onClick","onMousedown","onMouseenter"])}),128))],4),s("div",Uo,[R(x(N),{item:x(st),onDragstart:t[16]||(t[16]=l=>ht(l,x(st)))},null,8,["item"]),(B(!0),$(at,null,rt(x(p),(l,u)=>(B(),ct(x(N),{key:u,item:l,onDragstart:c=>ht(c,l)},null,8,["item","onDragstart"]))),128))])])])}}});const qo=yt(Ho,[["__scopeId","data-v-7e715a55"]]);export{qo as default};
